"use strict";(self.webpackChunkanime=self.webpackChunkanime||[]).push([[404],{7404:(Jy,Ka,D)=>{D.r(Ka),D.d(Ka,{ContentModule:()=>Yy});var et=D(8583),bn=D(5987),$=D(3679),qs=D(9765),Ga=D(6782);const yd=[1,2,3,4,5],Qa="FORM_RESET";var tt=(()=>{return(n=tt||(tt={})).Watched="Watched",n.WatchLater="WatchLater",n.Inprogress="WatchingNow",tt;var n})(),ie=D(8002),vd=D(8939),u=D(3018),za=D(2340),wd=D(1841);let Us=(()=>{class n{constructor(t){this.http=t}getAnime(t){return this.http.get(`${za.N.animeAPI}${t}`)}getQuotes(t){return this.http.get(`${za.N.animeQuotes}${t}`)}getAnimeByMal_id(t){return this.http.get(`https://api.jikan.moe/v3/anime/${t}`)}}return n.\u0275fac=function(t){return new(t||n)(u.LFG(wd.eN))},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac}),n})(),_d=(()=>{class n{get(t){const r=localStorage.getItem(t);if(r)return JSON.parse(r)}set(t,r){localStorage.setItem(t,JSON.stringify(r))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ha=(()=>{class n{constructor(t){this.storage=t,this.lastThreeSearchs=[]}addLastSearchs(t){if(this.lastThreeSearchs.length<3)return this.lastThreeSearchs.unshift(t),void this.storage.set("lastThreeSearchs",this.lastThreeSearchs);this.lastThreeSearchs=[t,...this.lastThreeSearchs.slice(0,2)],this.storage.set("lastThreeSearchs",this.lastThreeSearchs)}retoreState(){const t=this.storage.get("lastThreeSearchs");t&&(null==t?void 0:t.length)>0&&(this.lastThreeSearchs=t)}}return n.\u0275fac=function(t){return new(t||n)(u.LFG(_d))},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac}),n})();var Cn=D(4402),Td=D(3637),Id=D(8891),Wa=D(5917),ke=D(5117),Vs=D(9761),Ed=D(7393);function Bs(){return n=>n.lift(new xd)}class xd{call(e,t){return t.subscribe(new Sd(e))}}class Sd extends Ed.L{constructor(e){super(e),this.hasPrev=!1}_next(e){let t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}var I,js=D(2145),Ad=D(7519),Zs=D(5435),Sr=D(8747),bd=(D(941),D(3394)),g=D(8239),Ar=D(8026),Ya=D(3910),vt=D(5422),F=D(3854),Cd="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},$e={},$s=$s||{},b=Cd||self;function br(){}function Ks(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Nn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Gs="closure_uid_"+(1e9*Math.random()>>>0),Dd=0;function kd(n,e,t){return n.call.apply(n.bind,arguments)}function Rd(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function oe(n,e,t){return(oe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?kd:Rd).apply(null,arguments)}function Cr(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ae(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function nt(){this.s=this.s,this.o=this.o}var Fd={};nt.prototype.s=!1,nt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function(n){return Object.prototype.hasOwnProperty.call(n,Gs)&&n[Gs]||(n[Gs]=++Dd)}(this);delete Fd[n]}},nt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ja=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},Xa=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,s="string"==typeof n?n.split(""):n;for(let i=0;i<r;i++)i in s&&e.call(t,s[i],i,n)};function eu(n){return Array.prototype.concat.apply([],arguments)}function Qs(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Nr(n){return/^[\s\xa0]*$/.test(n)}var we,tu=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ve(n,e){return-1!=n.indexOf(e)}function zs(n,e){return n<e?-1:n>e?1:0}e:{var nu=b.navigator;if(nu){var ru=nu.userAgent;if(ru){we=ru;break e}}we=""}function Hs(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function su(n){const e={};for(const t in n)e[t]=n[t];return e}var iu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ou(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<iu.length;i++)t=iu[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Ws(n){return Ws[" "](n),n}Ws[" "]=br;var Dr,n,Pd=ve(we,"Opera"),jt=ve(we,"Trident")||ve(we,"MSIE"),au=ve(we,"Edge"),Ys=au||jt,uu=ve(we,"Gecko")&&!(ve(we.toLowerCase(),"webkit")&&!ve(we,"Edge"))&&!(ve(we,"Trident")||ve(we,"MSIE"))&&!ve(we,"Edge"),qd=ve(we.toLowerCase(),"webkit")&&!ve(we,"Edge");function cu(){var n=b.document;return n?n.documentMode:void 0}e:{var Js="",Xs=(n=we,uu?/rv:([^\);]+)(\)|;)/.exec(n):au?/Edge\/([\d\.]+)/.exec(n):jt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):qd?/WebKit\/(\S+)/.exec(n):Pd?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Xs&&(Js=Xs?Xs[1]:""),jt){var ei=cu();if(null!=ei&&ei>parseFloat(Js)){Dr=String(ei);break e}}Dr=Js}var Ud={};function Vd(){return e=Ud,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let n=0;const e=tu(String(Dr)).split("."),t=tu("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=zs(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||zs(0==s[2].length,0==i[2].length)||zs(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n}();var e}var Bd=b.document&&jt&&(cu()||parseInt(Dr,10))||void 0,jd=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{b.addEventListener("test",br,e),b.removeEventListener("test",br,e)}catch(t){}return n}();function fe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function Dn(n,e){if(fe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(uu){e:{try{Ws(e.nodeName);var s=!0;break e}catch(i){}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Zd[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Dn.Z.h.call(this)}}fe.prototype.h=function(){this.defaultPrevented=!0},ae(Dn,fe);var Zd={2:"touch",3:"pen",4:"mouse"};Dn.prototype.h=function(){Dn.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var kn="closure_listenable_"+(1e6*Math.random()|0),$d=0;function Kd(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=s,this.key=++$d,this.ca=this.fa=!1}function kr(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function Rr(n){this.src=n,this.g={},this.h=0}function ni(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=Ja(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(kr(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function ri(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ca&&i.listener==e&&i.capture==!!t&&i.ia==r)return s}return-1}Rr.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=ri(n,e,r,s);return-1<o?(e=n[o],t||(e.fa=!1)):((e=new Kd(e,this.src,i,!!r,s)).fa=t,n.push(e)),e};var si="closure_lm_"+(1e6*Math.random()|0),ii={};function lu(n,e,t,r,s){if(r&&r.once)return fu(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)lu(n,e[i],t,r,s);return null}return t=ci(t),n&&n[kn]?n.N(e,t,Nn(r)?!!r.capture:!!r,s):du(n,e,t,!1,r,s)}function du(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=Nn(s)?!!s.capture:!!s,a=ai(n);if(a||(n[si]=a=new Rr(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function(){var e=Qd;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)jd||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(gu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function fu(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)fu(n,e[i],t,r,s);return null}return t=ci(t),n&&n[kn]?n.O(e,t,Nn(r)?!!r.capture:!!r,s):du(n,e,t,!0,r,s)}function mu(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)mu(n,e[i],t,r,s);else r=Nn(r)?!!r.capture:!!r,t=ci(t),n&&n[kn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=ri(i=n.g[e],t,r,s))&&(kr(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=ai(n))&&(e=n.g[e.toString()],n=-1,e&&(n=ri(e,t,r,s)),(t=-1<n?e[n]:null)&&oi(t))}function oi(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[kn])ni(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(gu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=ai(e))?(ni(t,n),0==t.h&&(t.src=null,e[si]=null)):kr(n)}}}function gu(n){return n in ii?ii[n]:ii[n]="on"+n}function Qd(n,e){if(n.ca)n=!0;else{e=new Dn(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&oi(n),n=t.call(r,e)}return n}function ai(n){return(n=n[si])instanceof Rr?n:null}var ui="__closure_events_fn_"+(1e9*Math.random()>>>0);function ci(n){return"function"==typeof n?n:(n[ui]||(n[ui]=function(e){return n.handleEvent(e)}),n[ui])}function X(){nt.call(this),this.i=new Rr(this),this.P=this,this.I=null}function ue(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new fe(e,n);else if(e instanceof fe)e.target=e.target||n;else{var s=e;ou(e=new fe(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=Lr(o,r,!0,e)&&s}if(s=Lr(o=e.g=n,r,!0,e)&&s,s=Lr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=Lr(o=e.g=t[i],r,!1,e)&&s}function Lr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==t){var a=o.listener,c=o.ia||o.src;o.fa&&ni(n.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}ae(X,nt),X.prototype[kn]=!0,X.prototype.removeEventListener=function(n,e,t,r){mu(this,n,e,t,r)},X.prototype.M=function(){if(X.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)kr(t[r]);delete n.g[e],n.h--}}this.I=null},X.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},X.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var hi=b.JSON.stringify;function zd(){var n=yu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var di,pu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new Wd,n=>n.reset());class Wd{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Yd(n){b.setTimeout(()=>{throw n},0)}function li(n,e){di||function(){var n=b.Promise.resolve(void 0);di=function(){n.then(Xd)}}(),fi||(di(),fi=!0),yu.add(n,e)}var fi=!1,yu=new class{constructor(){this.h=this.g=null}add(e,t){const r=pu.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function Xd(){for(var n;n=zd();){try{n.h.call(n.g)}catch(t){Yd(t)}var e=pu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}fi=!1}function Fr(n,e){X.call(this),this.h=n||1,this.g=e||b,this.j=oe(this.kb,this),this.l=Date.now()}function mi(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function gi(n,e,t){if("function"==typeof n)t&&(n=oe(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=oe(n.handleEvent,n)}return 2147483647<Number(e)?-1:b.setTimeout(n,e||0)}function vu(n){n.g=gi(()=>{n.g=null,n.i&&(n.i=!1,vu(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ae(Fr,X),(I=Fr.prototype).da=!1,I.S=null,I.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ue(this,"tick"),this.da&&(mi(this),this.start()))}},I.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},I.M=function(){Fr.Z.M.call(this),mi(this),delete this.g};class ef extends nt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:vu(this)}M(){super.M(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Rn(n){nt.call(this),this.h=n,this.g={}}ae(Rn,nt);var wu=[];function _u(n,e,t,r){Array.isArray(t)||(t&&(wu[0]=t.toString()),t=wu);for(var s=0;s<t.length;s++){var i=lu(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function Tu(n){Hs(n.g,function(e,t){this.g.hasOwnProperty(t)&&oi(e)},n),n.g={}}function Or(){this.g=!0}function Zt(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return hi(t)}catch(a){return e}}(n,t)+(r?" "+r:"")})}Rn.prototype.M=function(){Rn.Z.M.call(this),Tu(this)},Rn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Or.prototype.Aa=function(){this.g=!1},Or.prototype.info=function(){};var wt={},Iu=null;function Mr(){return Iu=Iu||new X}function Eu(n){fe.call(this,wt.Ma,n)}function Ln(n){const e=Mr();ue(e,new Eu(e,n))}function xu(n,e){fe.call(this,wt.STAT_EVENT,n),this.stat=e}function _e(n){const e=Mr();ue(e,new xu(e,n))}function Su(n,e){fe.call(this,wt.Na,n),this.size=e}function Fn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){n()},e)}wt.Ma="serverreachability",ae(Eu,fe),wt.STAT_EVENT="statevent",ae(xu,fe),wt.Na="timingevent",ae(Su,fe);var Pr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Au={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function pi(){}function Cu(){}pi.prototype.h=null;var wi,On={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function yi(){fe.call(this,"d")}function vi(){fe.call(this,"c")}function qr(){}function Mn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new Rn(this),this.P=of,this.W=new Fr(n=Ys?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Nu}function Nu(){this.i=null,this.g="",this.h=!1}ae(yi,fe),ae(vi,fe),ae(qr,pi),qr.prototype.g=function(){return new XMLHttpRequest},qr.prototype.i=function(){return{}},wi=new qr;var of=45e3,_i={},Ur={};function Ti(n,e,t){n.K=1,n.v=$r(Ke(e)),n.s=t,n.U=!0,Du(n,null)}function Du(n,e){n.F=Date.now(),Pn(n),n.A=Ke(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),Uu(t.h,"t",r),n.C=0,t=n.l.H,n.h=new Nu,n.g=uc(n.l,t?e:null,!n.s),0<n.O&&(n.L=new ef(oe(n.Ia,n,n.g),n.O)),_u(n.V,n.g,"readystatechange",n.gb),e=n.H?su(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),Ln(1),function(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var l=h[0];h=h[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.X,n.s)}function ku(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function Ru(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=af(n,t),s==Ur){4==e&&(n.o=4,_e(14),r=!1),Zt(n.j,n.m,null,"[Incomplete Response]");break}if(s==_i){n.o=4,_e(15),Zt(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Zt(n.j,n.m,s,null),Ii(n,s)}ku(n)&&s!=Ur&&s!=_i&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,_e(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Li(e),e.L=!0,_e(11))):(Zt(n.j,n.m,t,"[Invalid Chunked Response]"),_t(n),qn(n))}function af(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Ur:(t=Number(e.substring(t,r)),isNaN(t)?_i:(r+=1)+t>e.length?Ur:(e=e.substr(r,t),n.C=r+t,e))}function Pn(n){n.Y=Date.now()+n.P,Lu(n,n.P)}function Lu(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Fn(oe(n.eb,n),e)}function Vr(n){n.B&&(b.clearTimeout(n.B),n.B=null)}function qn(n){0==n.l.G||n.I||sc(n.l,n)}function _t(n){Vr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,mi(n.W),Tu(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Ii(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Si(t.i,n)))if(t.I=n.N,!n.J&&Si(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch(h){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0])e:if(t.u)t.ta=s[1],0<t.ta-t.U&&37500>s[2]&&t.N&&0==t.A&&!t.v&&(t.v=Fn(oe(t.ab,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Wr(t),zr(t)}Ri(t),_e(18)}if(1>=ju(t.i)&&t.ka){try{t.ka()}catch(h){}t.ka=void 0}}else Et(t,11)}else if((n.J||t.g==n)&&Wr(t),!Nr(e))for(s=t.Ca.g.parse(e),e=0;e<s.length;e++){let h=s[e];if(t.U=h[0],h=h[1],2==t.G)if("c"==h[0]){t.J=h[1],t.la=h[2];const l=h[3];null!=l&&(t.ma=l,t.h.info("VER="+t.ma));const d=h[4];null!=d&&(t.za=d,t.h.info("SVER="+t.za));const m=h[5];null!=m&&"number"==typeof m&&0<m&&(t.K=r=1.5*m,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const w=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(w){var i=r.i;!i.g&&(ve(w,"spdy")||ve(w,"quic")||ve(w,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(Ai(i,i.h),i.h=null))}if(r.D){const S=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.sa=S,U(r.F,r.D,S))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=n;if((r=t).oa=ac(r,r.H?r.la:null,r.W),o.J){Zu(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(Vr(a),Pn(a)),r.g=o}else nc(r);0<t.l.length&&Hr(t)}else"stop"!=h[0]&&"close"!=h[0]||Et(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?Et(t,7):Di(t):"noop"!=h[0]&&t.j&&t.j.wa(h),t.A=0)}Ln(4)}catch(h){}}function Ei(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Ks(n)||"string"==typeof n)Xa(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(Ks(n)||"string"==typeof n){t=[];for(var r=n.length,s=0;s<r;s++)t.push(s)}else for(s in t=[],r=0,n)t[r++]=s;s=(r=function(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(Ks(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n)).length;for(var i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}}function $t(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof $t)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function xi(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];Tt(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var s={};for(t=e=0;e<n.g.length;)Tt(s,r=n.g[e])||(n.g[t++]=r,s[r]=1),e++;n.g.length=t}}function Tt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(I=Mn.prototype).setTimeout=function(n){this.P=n},I.gb=function(n){n=n.target;const e=this.L;e&&3==Ge(n)?e.l():this.Ia(n)},I.Ia=function(n){try{if(n==this.g)e:{const l=Ge(this.g);var e=this.g.Da();const d=this.g.ba();if(!(3>l)&&(3!=l||Ys||this.g&&(this.h.h||this.g.ga()||Yu(this.g)))){this.I||4!=l||7==e||Ln(8==e||0>=d?3:2),Vr(this);var t=this.g.ba();this.N=t;t:if(ku(this)){var r=Yu(this.g);n="";var s=r.length,i=4==Ge(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){_t(this),qn(this);var o="";break t}this.h.i=new b.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.X,l,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Nr(a)){var h=a;break t}}h=null}if(!(t=h)){this.i=!1,this.o=3,_e(12),_t(this),qn(this);break e}Zt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ii(this,t)}this.U?(Ru(this,l,o),Ys&&this.i&&3==l&&(_u(this.V,this.W,"tick",this.fb),this.W.start())):(Zt(this.j,this.m,o,null),Ii(this,o)),4==l&&_t(this),this.i&&!this.I&&(4==l?sc(this.l,this):(this.i=!1,Pn(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,_e(12)):(this.o=0,_e(13)),_t(this),qn(this)}}}catch(l){}},I.fb=function(){if(this.g){var n=Ge(this.g),e=this.g.ga();this.C<e.length&&(Vr(this),Ru(this,n,e),this.i&&4!=n&&Pn(this))}},I.cancel=function(){this.I=!0,_t(this)},I.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Ln(3),_e(17)),_t(this),this.o=2,qn(this)):Lu(this,this.Y-n)},(I=$t.prototype).R=function(){xi(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},I.T=function(){return xi(this),this.g.concat()},I.get=function(n,e){return Tt(this.h,n)?this.h[n]:e},I.set=function(n,e){Tt(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},I.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var s=t[r],i=this.get(s);n.call(e,i,s,this)}};var Fu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function It(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof It){this.g=void 0!==e?e:n.g,Br(this,n.j),this.s=n.s,jr(this,n.i),Zr(this,n.m),this.l=n.l,e=n.h;var t=new Bn;t.i=e.i,e.g&&(t.g=new $t(e.g),t.h=e.h),Ou(this,t),this.o=n.o}else n&&(t=String(n).match(Fu))?(this.g=!!e,Br(this,t[1]||"",!0),this.s=Un(t[2]||""),jr(this,t[3]||"",!0),Zr(this,t[4]),this.l=Un(t[5]||"",!0),Ou(this,t[6]||"",!0),this.o=Un(t[7]||"")):(this.g=!!e,this.h=new Bn(null,this.g))}function Ke(n){return new It(n)}function Br(n,e,t){n.j=t?Un(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function jr(n,e,t){n.i=t?Un(e,!0):e}function Zr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ou(n,e,t){e instanceof Bn?(n.h=e,function(n,e){e&&!n.j&&(rt(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(Pu(this,r),Uu(this,s,t))},n)),n.j=e}(n.h,n.g)):(t||(e=Vn(e,gf)),n.h=new Bn(e,n.g))}function U(n,e,t){n.h.set(e,t)}function $r(n){return U(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Un(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Vn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,df),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function df(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}It.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Vn(e,Mu,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Vn(e,Mu,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(Vn(t,"/"==t.charAt(0)?mf:ff,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Vn(t,pf)),n.join("")};var Mu=/[#\/\?@]/g,ff=/[#\?:]/g,mf=/[#\?]/g,gf=/[#\?@]/g,pf=/#/g;function Bn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function rt(n){n.g||(n.g=new $t,n.h=0,n.i&&function(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Pu(n,e){rt(n),e=Kt(n,e),Tt(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,Tt((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&xi(n)))}function qu(n,e){return rt(n),e=Kt(n,e),Tt(n.g.h,e)}function Uu(n,e,t){Pu(n,e),0<t.length&&(n.i=null,n.g.set(Kt(n,e),Qs(t)),n.h+=t.length)}function Kt(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Vu(n){this.l=n||wf,n=b.PerformanceNavigationTiming?0<(n=b.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(b.g&&b.g.Ea&&b.g.Ea()&&b.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(I=Bn.prototype).add=function(n,e){rt(this),this.i=null,n=Kt(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},I.forEach=function(n,e){rt(this),this.g.forEach(function(t,r){Xa(t,function(s){n.call(e,s,r,this)},this)},this)},I.T=function(){rt(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var s=n[r],i=0;i<s.length;i++)t.push(e[r]);return t},I.R=function(n){rt(this);var e=[];if("string"==typeof n)qu(this,n)&&(e=eu(e,this.g.get(Kt(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=eu(e,n[t])}return e},I.set=function(n,e){return rt(this),this.i=null,qu(this,n=Kt(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},I.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},I.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),n.push(o)}}return this.i=n.join("&")};var wf=10;function Bu(n){return!!n.h||!!n.g&&n.g.size>=n.j}function ju(n){return n.h?1:n.g?n.g.size:0}function Si(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Ai(n,e){n.g?n.g.add(e):n.h=e}function Zu(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function $u(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Qs(n.i)}function bi(){}function _f(){this.g=new bi}function Tf(n,e,t){const r=t||"";try{Ei(n,function(s,i){let o=s;Nn(s)&&(o=hi(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Kr(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function jn(n){this.l=n.$b||null,this.j=n.ib||!1}function Gr(n,e){X.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Ci,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Vu.prototype.cancel=function(){if(this.i=$u(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},bi.prototype.stringify=function(n){return b.JSON.stringify(n,void 0)},bi.prototype.parse=function(n){return b.JSON.parse(n,void 0)},ae(jn,pi),jn.prototype.g=function(){return new Gr(this.l,this.j)},jn.prototype.i=function(n){return function(){return n}}({}),ae(Gr,X);var Ci=0;function Ku(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function Zn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,$n(n)}function $n(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(I=Gr.prototype).open=function(n,e){if(this.readyState!=Ci)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,$n(this)},I.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||b).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Zn(this)),this.readyState=Ci},I.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,$n(this)),this.g&&(this.readyState=3,$n(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==b.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ku(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},I.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Zn(this):$n(this),3==this.readyState&&Ku(this)}},I.Ua=function(n){this.g&&(this.response=this.responseText=n,Zn(this))},I.Ta=function(n){this.g&&(this.response=n,Zn(this))},I.ha=function(){this.g&&Zn(this)},I.setRequestHeader=function(n,e){this.v.append(n,e)},I.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},I.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Gr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Ef=b.JSON.parse;function K(n){X.call(this),this.headers=new $t,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Gu,this.K=this.L=!1}ae(K,X);var Gu="",xf=/^https?$/i,Sf=["POST","PUT"];function bf(n){return"content-type"==n.toLowerCase()}function Qu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,zu(n),Qr(n)}function zu(n){n.D||(n.D=!0,ue(n,"complete"),ue(n,"error"))}function Hu(n){if(n.h&&void 0!==$s&&(!n.C[1]||4!=Ge(n)||2!=n.ba()))if(n.v&&4==Ge(n))gi(n.Fa,0,n);else if(ue(n,"readystatechange"),4==Ge(n)){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Fu)[1]||null;if(!s&&b.self&&b.self.location){var i=b.self.location.protocol;s=i.substr(0,i.length-1)}r=!xf.test(s?s.toLowerCase():"")}t=r}if(t)ue(n,"complete"),ue(n,"success");else{n.m=6;try{var o=2<Ge(n)?n.g.statusText:""}catch(c){o=""}n.j=o+" ["+n.ba()+"]",zu(n)}}finally{Qr(n)}}}function Qr(n,e){if(n.g){Wu(n);const t=n.g,r=n.C[0]?br:null;n.g=null,n.C=null,e||ue(n,"ready");try{t.onreadystatechange=r}catch(s){}}}function Wu(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(b.clearTimeout(n.A),n.A=null)}function Ge(n){return n.g?n.g.readyState:0}function Yu(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Gu:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ni(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function(n){let e="";return Hs(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):U(n,e,t))}function Kn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Ju(n){this.za=0,this.l=[],this.h=new Or,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Kn("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Kn("baseRetryDelayMs",5e3,n),this.$a=Kn("retryDelaySeedMs",1e4,n),this.Ya=Kn("forwardChannelMaxRetries",2,n),this.ra=Kn("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new Vu(n&&n.concurrentRequestLimit),this.Ca=new _f,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function Di(n){if(Xu(n),3==n.G){var e=n.V++,t=Ke(n.F);U(t,"SID",n.J),U(t,"RID",e),U(t,"TYPE","terminate"),Gn(n,t),(e=new Mn(n,n.h,e,void 0)).K=2,e.v=$r(Ke(t)),t=!1,b.navigator&&b.navigator.sendBeacon&&(t=b.navigator.sendBeacon(e.v.toString(),"")),!t&&b.Image&&((new Image).src=e.v,t=!0),t||(e.g=uc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Pn(e)}oc(n)}function zr(n){n.g&&(Li(n),n.g.cancel(),n.g=null)}function Xu(n){zr(n),n.u&&(b.clearTimeout(n.u),n.u=null),Wr(n),n.i.cancel(),n.m&&("number"==typeof n.m&&b.clearTimeout(n.m),n.m=null)}function ki(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&Hr(n)}function Hr(n){Bu(n.i)||n.m||(n.m=!0,li(n.Ha,n),n.C=0)}function ec(n,e){var t;t=e?e.m:n.V++;const r=Ke(n.F);U(r,"SID",n.J),U(r,"RID",t),U(r,"AID",n.U),Gn(n,r),n.o&&n.s&&Ni(r,n.o,n.s),t=new Mn(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=tc(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),Ai(n.i,t),Ti(t,r,e)}function Gn(n,e){n.j&&Ei({},function(t,r){U(e,r,t)})}function tc(n,e,t){t=Math.min(n.l.length,t);var r=n.j?oe(n.j.Oa,n.j,n):null;e:{var s=n.l;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let c=0;c<t;c++){let h=s[c].h;const l=s[c].g;if(h-=i,0>h)i=Math.max(0,s[c].h-100),a=!1;else try{Tf(l,o,"req"+h+"_")}catch(d){r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function nc(n){n.g||n.u||(n.Y=1,li(n.Ga,n),n.A=0)}function Ri(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=Fn(oe(n.Ga,n),ic(n,n.A)),n.A++,0))}function Li(n){null!=n.B&&(b.clearTimeout(n.B),n.B=null)}function rc(n){n.g=new Mn(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=Ke(n.oa);U(e,"RID","rpc"),U(e,"SID",n.J),U(e,"CI",n.N?"0":"1"),U(e,"AID",n.U),Gn(n,e),U(e,"TYPE","xmlhttp"),n.o&&n.s&&Ni(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=$r(Ke(e)),t.s=null,t.U=!0,Du(t,n)}function Wr(n){null!=n.v&&(b.clearTimeout(n.v),n.v=null)}function sc(n,e){var t=null;if(n.g==e){Wr(n),Li(n),n.g=null;var r=2}else{if(!Si(n.i,e))return;t=e.D,Zu(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;ue(r=Mr(),new Su(r,t,e,s)),Hr(n)}else nc(n);else if(3==(s=e.o)||0==s&&0<n.I||!(1==r&&function(n,e){return!(ju(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=Fn(oe(n.Ha,n,e),ic(n,n.C)),n.C++,0)))}(n,e)||2==r&&Ri(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Et(n,5);break;case 4:Et(n,10);break;case 3:Et(n,6);break;default:Et(n,2)}}function ic(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function Et(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=oe(n.jb,n);t||(t=new It("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||Br(t,"https"),$r(t)),function(n,e){const t=new Or;if(b.Image){const r=new Image;r.onload=Cr(Kr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Cr(Kr,t,r,"TestLoadImage: error",!1,e),r.onabort=Cr(Kr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Cr(Kr,t,r,"TestLoadImage: timeout",!1,e),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else _e(2);n.G=0,n.j&&n.j.va(e),oc(n),Xu(n)}function oc(n){n.G=0,n.I=-1,n.j&&((0!=$u(n.i).length||0!=n.l.length)&&(n.i.i.length=0,Qs(n.l),n.l.length=0),n.j.ua())}function ac(n,e,t){let r=function(n){return n instanceof It?Ke(n):new It(n,void 0)}(t);if(""!=r.i)e&&jr(r,e+"."+r.i),Zr(r,r.m);else{const s=b.location;r=function(n,e,t,r){var s=new It(null,void 0);return n&&Br(s,n),e&&jr(s,e),t&&Zr(s,t),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,t)}return n.aa&&Hs(n.aa,function(s,i){U(r,i,s)}),t=n.sa,(e=n.D)&&t&&U(r,e,t),U(r,"VER",n.ma),Gn(n,r),r}function uc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new K(t&&n.Ba&&!n.qa?new jn({ib:!0}):n.qa)).L=n.H,e}function cc(){}function Yr(){if(jt&&!(10<=Number(Bd)))throw Error("Environmental error: no available transport.")}function be(n,e){X.call(this),this.g=new Ju(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!Nr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Nr(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Gt(this)}function hc(n){yi.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function lc(){vi.call(this),this.status=1}function Gt(n){this.g=n}(I=K.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():wi.g(),this.C=function(n){return n.h||(n.h=n.i())}(this.u?this.u:wi),this.g.onreadystatechange=oe(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void Qu(this,i)}n=t||"";const s=new $t(this.headers);r&&Ei(r,function(i,o){s.set(o,i)}),r=function(n){e:{var e=bf;const t=n.length,r="string"==typeof n?n.split(""):n;for(let s=0;s<t;s++)if(s in r&&e.call(void 0,r[s],s,n)){e=s;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(s.T()),t=b.FormData&&n instanceof b.FormData,!(0<=Ja(Sf,e))||r||t||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(i,o){this.g.setRequestHeader(o,i)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Wu(this),0<this.B&&((this.K=function(n){return jt&&Vd()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=oe(this.pa,this)):this.A=gi(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Qu(this,i)}},I.pa=function(){void 0!==$s&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ue(this,"timeout"),this.abort(8))},I.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ue(this,"complete"),ue(this,"abort"),Qr(this))},I.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Qr(this,!0)),K.Z.M.call(this)},I.Fa=function(){this.s||(this.F||this.v||this.l?Hu(this):this.cb())},I.cb=function(){Hu(this)},I.ba=function(){try{return 2<Ge(this)?this.g.status:-1}catch(n){return-1}},I.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},I.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Ef(e)}},I.Da=function(){return this.m},I.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(I=Ju.prototype).ma=8,I.G=1,I.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(e){}},I.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const s=new Mn(this,this.h,n,void 0);let i=this.s;if(this.P&&(i?(i=su(i),ou(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=tc(this,s,e),U(t=Ke(this.F),"RID",n),U(t,"CVER",22),this.D&&U(t,"X-HTTP-Session-Id",this.D),Gn(this,t),this.o&&i&&Ni(t,this.o,i),Ai(this.i,s),this.Ra&&U(t,"TYPE","init"),this.ja?(U(t,"$req",e),U(t,"SID","null"),s.$=!0,Ti(s,t,null)):Ti(s,t,e),this.G=2}}else 3==this.G&&(n?ec(this,n):0==this.l.length||Bu(this.i)||ec(this))},I.Ga=function(){if(this.u=null,rc(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Fn(oe(this.bb,this),n)}},I.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,_e(10),zr(this),rc(this))},I.ab=function(){null!=this.v&&(this.v=null,zr(this),Ri(this),_e(19))},I.jb=function(n){n?(this.h.info("Successfully pinged google.com"),_e(2)):(this.h.info("Failed to ping google.com"),_e(1))},(I=cc.prototype).xa=function(){},I.wa=function(){},I.va=function(){},I.ua=function(){},I.Oa=function(){},Yr.prototype.g=function(n,e){return new be(n,e)},ae(be,X),be.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),li(oe(n.hb,n,e))),_e(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=ac(n,null,n.W),Hr(n)},be.prototype.close=function(){Di(this.g)},be.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,ki(this.g,e)}else this.v?((e={}).__data__=hi(n),ki(this.g,e)):ki(this.g,n)},be.prototype.M=function(){this.g.j=null,delete this.j,Di(this.g),delete this.g,be.Z.M.call(this)},ae(hc,yi),ae(lc,vi),ae(Gt,cc),Gt.prototype.xa=function(){ue(this.g,"a")},Gt.prototype.wa=function(n){ue(this.g,new hc(n))},Gt.prototype.va=function(n){ue(this.g,new lc(n))},Gt.prototype.ua=function(){ue(this.g,"b")},Yr.prototype.createWebChannel=Yr.prototype.g,be.prototype.send=be.prototype.u,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,Pr.NO_ERROR=0,Pr.TIMEOUT=8,Pr.HTTP_ERROR=6,Au.COMPLETE="complete",Cu.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",X.prototype.listen=X.prototype.N,K.prototype.listenOnce=K.prototype.O,K.prototype.getLastError=K.prototype.La,K.prototype.getLastErrorCode=K.prototype.Da,K.prototype.getStatus=K.prototype.ba,K.prototype.getResponseJson=K.prototype.Qa,K.prototype.getResponseText=K.prototype.ga,K.prototype.send=K.prototype.ea;var Df=$e.createWebChannelTransport=function(){return new Yr},kf=$e.getStatEventTarget=function(){return Mr()},Fi=$e.ErrorCode=Pr,Rf=$e.EventType=Au,Lf=$e.Event=wt,dc=$e.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Ff=$e.FetchXmlHttpFactory=jn,Jr=$e.WebChannel=Cu,Of=$e.XhrIo=K;const fc="@firebase/firestore";class ce{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ce.UNAUTHENTICATED=new ce(null),ce.GOOGLE_CREDENTIALS=new ce("google-credentials-uid"),ce.FIRST_PARTY=new ce("first-party-uid"),ce.MOCK_USER=new ce("mock-user");let Qt="9.6.0";const st=new vt.Yd("@firebase/firestore");function Oi(){return st.logLevel}function _(n,...e){if(st.logLevel<=vt.in.DEBUG){const t=e.map(Mi);st.debug(`Firestore (${Qt}): ${n}`,...t)}}function G(n,...e){if(st.logLevel<=vt.in.ERROR){const t=e.map(Mi);st.error(`Firestore (${Qt}): ${n}`,...t)}}function Qn(n,...e){if(st.logLevel<=vt.in.WARN){const t=e.map(Mi);st.warn(`Firestore (${Qt}): ${n}`,...t)}}function Mi(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function x(n="Unexpected state"){const e=`FIRESTORE (${Qt}) INTERNAL ASSERTION FAILED: `+n;throw G(e),new Error(e)}function A(n,e){n||x()}function T(n,e){return n}const f={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ee{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class mc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ce.UNAUTHENTICATED))}shutdown(){}}class Uf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Vf{constructor(e){this.t=e,this.currentUser=ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=h=>this.i!==s?(s=this.i,t(h)):Promise.resolve();let o=new ee;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ee,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const h=o;e.enqueueRetryable((0,g.Z)(function*(){yield h.promise,yield i(r.currentUser)}))},c=h=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ee)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(A("string"==typeof r.accessToken),new mc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return A(null===e||"string"==typeof e),new ce(e)}}class Bf{constructor(e,t,r){this.type="FirstParty",this.user=ce.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const s=e.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class jf{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Bf(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class gc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zf{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=s=>{e.enqueueRetryable(()=>{return null!=(i=s).error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`),t(i.token);var i})};const r=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.g.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.g.getImmediate({optional:!0});s?r(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(A("string"==typeof t.token),new gc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Ce{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.p(r),this.T=r=>t.writeSequenceNumber(r))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function $f(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}Ce.I=-1;class pc{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=$f(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function k(n,e){return n<e?-1:n>e?1:0}function zt(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function yc(n){return n+"\0"}class te{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return te.fromMillis(Date.now())}static fromDate(e){return te.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new te(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k(this.nanoseconds,e.nanoseconds):k(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class N{constructor(e){this.timestamp=e}static fromTimestamp(e){return new N(e)}static min(){return new N(new te(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function vc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function xt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function wc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class zn{constructor(e,t,r){void 0===t?t=0:t>e.length&&x(),void 0===r?r=e.length-t:r>e.length-t&&x(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===zn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof zn?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class O extends zn{construct(e,t,r){return new O(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new v(f.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new O(t)}static emptyPath(){return new O([])}}const Kf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class he extends zn{construct(e,t,r){return new he(e,t,r)}static isValidIdentifier(e){return Kf.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),he.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new he(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new v(f.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new v(f.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new v(f.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new v(f.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new he(t)}static emptyPath(){return new he([])}}class Ht{constructor(e){this.fields=e,e.sort(he.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zt(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class ne{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ne(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new ne(t)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ne.EMPTY_BYTE_STRING=new ne("");const Qf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function it(n){if(A(!!n),"string"==typeof n){let e=0;const t=Qf.exec(n);if(A(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Q(n.seconds),nanos:Q(n.nanos)}}function Q(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Wt(n){return"string"==typeof n?ne.fromBase64String(n):ne.fromUint8Array(n)}function Pi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function _c(n){const e=n.mapValue.fields.__previous_value__;return Pi(e)?_c(e):e}function Hn(n){const e=it(n.mapValue.fields.__local_write_time__.timestampValue);return new te(e.seconds,e.nanos)}function St(n){return null==n}function Xr(n){return 0===n&&1/n==-1/0}function Tc(n){return"number"==typeof n&&Number.isInteger(n)&&!Xr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class E{constructor(e){this.path=e}static fromPath(e){return new E(O.fromString(e))}static fromName(e){return new E(O.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===O.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return O.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new E(new O(e.slice()))}}function At(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Pi(n)?4:10:x()}function Pe(n,e){const t=At(n);if(t!==At(e))return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Hn(n).isEqual(Hn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=it(r.timestampValue),o=it(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Wt(n.bytesValue).isEqual(Wt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return Q(r.geoPointValue.latitude)===Q(s.geoPointValue.latitude)&&Q(r.geoPointValue.longitude)===Q(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return Q(r.integerValue)===Q(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=Q(r.doubleValue),o=Q(s.doubleValue);return i===o?Xr(i)===Xr(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return zt(n.arrayValue.values||[],e.arrayValue.values||[],Pe);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(vc(i)!==vc(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!Pe(i[a],o[a])))return!1;return!0}(n,e);default:return x()}var s}function Wn(n,e){return void 0!==(n.values||[]).find(t=>Pe(t,e))}function Yt(n,e){const t=At(n),r=At(e);if(t!==r)return k(t,r);switch(t){case 0:return 0;case 1:return k(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=Q(s.integerValue||s.doubleValue),a=Q(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return Ic(n.timestampValue,e.timestampValue);case 4:return Ic(Hn(n),Hn(e));case 5:return k(n.stringValue,e.stringValue);case 6:return function(s,i){const o=Wt(s),a=Wt(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let c=0;c<o.length&&c<a.length;c++){const h=k(o[c],a[c]);if(0!==h)return h}return k(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=k(Q(s.latitude),Q(i.latitude));return 0!==o?o:k(Q(s.longitude),Q(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let c=0;c<o.length&&c<a.length;++c){const h=Yt(o[c],a[c]);if(h)return h}return k(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){const o=s.fields||{},a=Object.keys(o),c=i.fields||{},h=Object.keys(c);a.sort(),h.sort();for(let l=0;l<a.length&&l<h.length;++l){const d=k(a[l],h[l]);if(0!==d)return d;const m=Yt(o[a[l]],c[h[l]]);if(0!==m)return m}return k(a.length,h.length)}(n.mapValue,e.mapValue);default:throw x()}}function Ic(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return k(n,e);const t=it(n),r=it(e),s=k(t.seconds,r.seconds);return 0!==s?s:k(t.nanos,r.nanos)}function qi(n){return Ui(n)}function Ui(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=it(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Wt(n.bytesValue).toBase64():"referenceValue"in n?E.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=Ui(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${Ui(r.fields[a])}`;return i+"}"}(n.mapValue):x();var e}function es(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Vi(n){return!!n&&"integerValue"in n}function Bi(n){return!!n&&"arrayValue"in n}function Ec(n){return!!n&&"nullValue"in n}function xc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ts(n){return!!n&&"mapValue"in n}function Yn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return xt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Yn(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Yn(n.arrayValue.values[t]);return e}return Object.assign({},n)}class me{constructor(e){this.value=e}static empty(){return new me({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ts(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Yn(t)}setAll(e){let t=he.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Yn(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ts(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Pe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ts(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){xt(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new me(Yn(this.value))}}function Sc(n){const e=[];return xt(n.fields,(t,r)=>{const s=new he([t]);if(ts(r)){const i=Sc(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ht(e)}class V{constructor(e,t,r,s,i){this.key=e,this.documentType=t,this.version=r,this.data=s,this.documentState=i}static newInvalidDocument(e){return new V(e,0,N.min(),me.empty(),0)}static newFoundDocument(e,t,r){return new V(e,1,t,r,0)}static newNoDocument(e,t){return new V(e,2,t,me.empty(),0)}static newUnknownDocument(e,t){return new V(e,3,t,me.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=me.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=me.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof V&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new V(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zf{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.R=null}}function Ac(n,e=null,t=[],r=[],s=null,i=null,o=null){return new zf(n,e,t,r,s,i,o)}function Jn(n){const e=T(n);if(null===e.R){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>function(n){return n.field.canonicalString()+n.op.toString()+qi(n.value)}(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),St(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ss(e.startAt)),e.endAt&&(t+="|ub:",t+=ss(e.endAt)),e.R=t}return e.R}function ns(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!sm(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if((t=n.filters[s]).op!==(r=e.filters[s]).op||!t.field.isEqual(r.field)||!Pe(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Nc(n.startAt,e.startAt)&&Nc(n.endAt,e.endAt)}function rs(n){return E.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class Te extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,r):new Yf(e,t,r):"array-contains"===t?new em(e,r):"in"===t?new tm(e,r):"not-in"===t?new nm(e,r):"array-contains-any"===t?new rm(e,r):new Te(e,t,r)}static P(e,t,r){return"in"===t?new Jf(e,r):new Xf(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Yt(t,this.value)):null!==t&&At(this.value)===At(t)&&this.v(Yt(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return x()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Yf extends Te{constructor(e,t,r){super(e,t,r),this.key=E.fromName(r.referenceValue)}matches(e){const t=E.comparator(e.key,this.key);return this.v(t)}}class Jf extends Te{constructor(e,t){super(e,"in",t),this.keys=bc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Xf extends Te{constructor(e,t){super(e,"not-in",t),this.keys=bc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function bc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>E.fromName(r.referenceValue))}class em extends Te{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Bi(t)&&Wn(t.arrayValue,this.value)}}class tm extends Te{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Wn(this.value.arrayValue,t)}}class nm extends Te{constructor(e,t){super(e,"not-in",t)}matches(e){if(Wn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Wn(this.value.arrayValue,t)}}class rm extends Te{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Bi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Wn(this.value.arrayValue,r))}}class Xn{constructor(e,t){this.position=e,this.before=t}}function ss(n){return`${n.before?"b":"a"}:${n.position.map(e=>qi(e)).join(",")}`}class Jt{constructor(e,t="asc"){this.field=e,this.dir=t}}function sm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function Cc(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?E.comparator(E.fromName(o.referenceValue),t.key):Yt(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return n.before?r<=0:r<0}function Nc(n,e){if(null===n)return null===e;if(null===e||n.before!==e.before||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Pe(n.position[t],e.position[t]))return!1;return!0}class Qe{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.S=null,this.D=null}}function Dc(n,e,t,r,s,i,o,a){return new Qe(n,e,t,r,s,i,o,a)}function Xt(n){return new Qe(n)}function is(n){return!St(n.limit)&&"F"===n.limitType}function os(n){return!St(n.limit)&&"L"===n.limitType}function ji(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Zi(n){for(const e of n.filters)if(e.V())return e.field;return null}function $i(n){return null!==n.collectionGroup}function en(n){const e=T(n);if(null===e.S){e.S=[];const t=Zi(e),r=ji(e);if(null!==t&&null===r)t.isKeyField()||e.S.push(new Jt(t)),e.S.push(new Jt(he.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.S.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.S.push(new Jt(he.keyField(),i))}}}return e.S}function Re(n){const e=T(n);if(!e.D)if("F"===e.limitType)e.D=Ac(e.path,e.collectionGroup,en(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of en(e))t.push(new Jt(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new Xn(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Xn(e.startAt.position,!e.startAt.before):null;e.D=Ac(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e.D}function kc(n,e,t){return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function er(n,e){return ns(Re(n),Re(e))&&n.limitType===e.limitType}function Rc(n){return`${Jn(Re(n))}|lt:${n.limitType}`}function Ki(n){return`Query(target=${function(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${qi(r.value)}`;var r}).join(", ")}]`),St(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: "+ss(n.startAt)),n.endAt&&(e+=", endAt: "+ss(n.endAt)),`Target(${e})`}(Re(n))}; limitType=${n.limitType})`}function tr(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):E.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!Cc(t.startAt,en(t),r)||t.endAt&&Cc(t.endAt,en(t),r)));var t,r}function Lc(n){return(e,t)=>{let r=!1;for(const s of en(n)){const i=im(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function im(n,e,t){const r=n.field.isKeyField()?E.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),c=o.data.field(s);return null!==a&&null!==c?Yt(a,c):x()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return x()}}function Fc(n,e){if(n.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xr(e)?"-0":e}}function Oc(n){return{integerValue:""+n}}function Mc(n,e){return Tc(e)?Oc(e):Fc(n,e)}class as{constructor(){this._=void 0}}function om(n,e,t){return n instanceof tn?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof bt?qc(n,e):n instanceof Ct?Uc(n,e):function(r,s){const i=Pc(r,s),o=Vc(i)+Vc(r.N);return Vi(i)&&Vi(r.N)?Oc(o):Fc(r.k,o)}(n,e)}function am(n,e,t){return n instanceof bt?qc(n,e):n instanceof Ct?Uc(n,e):t}function Pc(n,e){return n instanceof nn?Vi(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class tn extends as{}class bt extends as{constructor(e){super(),this.elements=e}}function qc(n,e){const t=Bc(e);for(const r of n.elements)t.some(s=>Pe(s,r))||t.push(r);return{arrayValue:{values:t}}}class Ct extends as{constructor(e){super(),this.elements=e}}function Uc(n,e){let t=Bc(e);for(const r of n.elements)t=t.filter(s=>!Pe(s,r));return{arrayValue:{values:t}}}class nn extends as{constructor(e,t){super(),this.k=e,this.N=t}}function Vc(n){return Q(n.integerValue||n.doubleValue)}function Bc(n){return Bi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class nr{constructor(e,t){this.field=e,this.transform=t}}class cm{constructor(e,t){this.version=e,this.transformResults=t}}class z{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new z}static exists(e){return new z(void 0,e)}static updateTime(e){return new z(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function us(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class cs{}function hm(n,e,t){n instanceof rr?function(r,s,i){const o=r.value.clone(),a=Kc(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof ot?function(r,s,i){if(!us(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=Kc(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll($c(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Gi(n,e,t){var s;n instanceof rr?function(r,s,i){if(!us(r.precondition,s))return;const o=r.value.clone(),a=Gc(r.fieldTransforms,i,s);o.setAll(a),s.convertToFoundDocument(Zc(s),o).setHasLocalMutations()}(n,e,t):n instanceof ot?function(r,s,i){if(!us(r.precondition,s))return;const o=Gc(r.fieldTransforms,i,s),a=s.data;a.setAll($c(r)),a.setAll(o),s.convertToFoundDocument(Zc(s),a).setHasLocalMutations()}(n,e,t):us(n.precondition,s=e)&&s.convertToNoDocument(N.min())}function lm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Pc(r.transform,s||null);null!=i&&(null==t&&(t=me.empty()),t.set(r.field,i))}return t||null}function jc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&zt(t,r,(s,i)=>function(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof bt&&r instanceof bt||t instanceof Ct&&r instanceof Ct?zt(t.elements,r.elements,Pe):t instanceof nn&&r instanceof nn?Pe(t.N,r.N):t instanceof tn&&r instanceof tn);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}function Zc(n){return n.isFoundDocument()?n.version:N.min()}class rr extends cs{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}}class ot extends cs{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}}function $c(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Kc(n,e,t){const r=new Map;A(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,am(o,a,t[s]))}return r}function Gc(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,om(i,o,e))}return r}class sr extends cs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Qi extends cs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class dm{constructor(e){this.count=e}}var H,R;function Qc(n){switch(n){default:return x();case f.CANCELLED:case f.UNKNOWN:case f.DEADLINE_EXCEEDED:case f.RESOURCE_EXHAUSTED:case f.INTERNAL:case f.UNAVAILABLE:case f.UNAUTHENTICATED:return!1;case f.INVALID_ARGUMENT:case f.NOT_FOUND:case f.ALREADY_EXISTS:case f.PERMISSION_DENIED:case f.FAILED_PRECONDITION:case f.ABORTED:case f.OUT_OF_RANGE:case f.UNIMPLEMENTED:case f.DATA_LOSS:return!0}}function zc(n){if(void 0===n)return G("GRPC error has no .code"),f.UNKNOWN;switch(n){case H.OK:return f.OK;case H.CANCELLED:return f.CANCELLED;case H.UNKNOWN:return f.UNKNOWN;case H.DEADLINE_EXCEEDED:return f.DEADLINE_EXCEEDED;case H.RESOURCE_EXHAUSTED:return f.RESOURCE_EXHAUSTED;case H.INTERNAL:return f.INTERNAL;case H.UNAVAILABLE:return f.UNAVAILABLE;case H.UNAUTHENTICATED:return f.UNAUTHENTICATED;case H.INVALID_ARGUMENT:return f.INVALID_ARGUMENT;case H.NOT_FOUND:return f.NOT_FOUND;case H.ALREADY_EXISTS:return f.ALREADY_EXISTS;case H.PERMISSION_DENIED:return f.PERMISSION_DENIED;case H.FAILED_PRECONDITION:return f.FAILED_PRECONDITION;case H.ABORTED:return f.ABORTED;case H.OUT_OF_RANGE:return f.OUT_OF_RANGE;case H.UNIMPLEMENTED:return f.UNIMPLEMENTED;case H.DATA_LOSS:return f.DATA_LOSS;default:return x()}}(R=H||(H={}))[R.OK=0]="OK",R[R.CANCELLED=1]="CANCELLED",R[R.UNKNOWN=2]="UNKNOWN",R[R.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",R[R.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",R[R.NOT_FOUND=5]="NOT_FOUND",R[R.ALREADY_EXISTS=6]="ALREADY_EXISTS",R[R.PERMISSION_DENIED=7]="PERMISSION_DENIED",R[R.UNAUTHENTICATED=16]="UNAUTHENTICATED",R[R.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",R[R.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",R[R.ABORTED=10]="ABORTED",R[R.OUT_OF_RANGE=11]="OUT_OF_RANGE",R[R.UNIMPLEMENTED=12]="UNIMPLEMENTED",R[R.INTERNAL=13]="INTERNAL",R[R.UNAVAILABLE=14]="UNAVAILABLE",R[R.DATA_LOSS=15]="DATA_LOSS";class W{constructor(e,t){this.comparator=e,this.root=t||le.EMPTY}insert(e,t){return new W(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,le.BLACK,null,null))}remove(e){return new W(this.comparator,this.root.remove(e,this.comparator).copy(null,null,le.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hs(this.root,e,this.comparator,!1)}getReverseIterator(){return new hs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hs(this.root,e,this.comparator,!0)}}class hs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class le{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:le.RED,this.left=null!=s?s:le.EMPTY,this.right=null!=i?i:le.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new le(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return le.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return le.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,le.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,le.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw x();const e=this.left.check();if(e!==this.right.check())throw x();return e+(this.isRed()?0:1)}}le.EMPTY=null,le.RED=!0,le.BLACK=!1,le.EMPTY=new class{constructor(){this.size=0}get key(){throw x()}get value(){throw x()}get color(){throw x()}get left(){throw x()}get right(){throw x()}copy(n,e,t,r,s){return this}insert(n,e,t){return new le(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class j{constructor(e){this.comparator=e,this.data=new W(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Hc(this.data.getIterator())}getIteratorFrom(e){return new Hc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof j)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new j(this.comparator);return t.data=e,t}}class Hc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const fm=new W(E.comparator);function Le(){return fm}const mm=new W(E.comparator);function zi(){return mm}const gm=new W(E.comparator);function Wc(){return gm}const pm=new j(E.comparator);function M(...n){let e=pm;for(const t of n)e=e.add(t);return e}const ym=new j(k);function ls(){return ym}class ir{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,or.createSynthesizedTargetChangeForCurrentChange(e,t)),new ir(N.min(),r,ls(),Le(),M())}}class or{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new or(ne.EMPTY_BYTE_STRING,t,M(),M(),M())}}class ds{constructor(e,t,r,s){this.$=e,this.removedTargetIds=t,this.key=r,this.F=s}}class Yc{constructor(e,t){this.targetId=e,this.O=t}}class Jc{constructor(e,t,r=ne.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Xc{constructor(){this.M=0,this.L=th(),this.B=ne.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.M}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=M(),t=M(),r=M();return this.L.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:x()}}),new or(this.B,this.U,e,t,r)}H(){this.q=!1,this.L=th()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.M+=1}Z(){this.M-=1}tt(){this.q=!0,this.U=!0}}class vm{constructor(e){this.et=e,this.nt=new Map,this.st=Le(),this.it=eh(),this.rt=new j(k)}ot(e){for(const t of e.$)e.F&&e.F.isFoundDocument()?this.at(t,e.F):this.ct(t,e.key,e.F);for(const t of e.removedTargetIds)this.ct(t,e.key,e.F)}ut(e){this.forEachTarget(e,t=>{const r=this.ht(t);switch(e.state){case 0:this.lt(t)&&r.W(e.resumeToken);break;case 1:r.Z(),r.K||r.H(),r.W(e.resumeToken);break;case 2:r.Z(),r.K||this.removeTarget(t);break;case 3:this.lt(t)&&(r.tt(),r.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),r.W(e.resumeToken));break;default:x()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((r,s)=>{this.lt(s)&&t(s)})}dt(e){const t=e.targetId,r=e.O.count,s=this.wt(t);if(s){const i=s.target;if(rs(i))if(0===r){const o=new E(i.path);this.ct(t,o,V.newNoDocument(o,N.min()))}else A(1===r);else this._t(t)!==r&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach((i,o)=>{const a=this.wt(o);if(a){if(i.current&&rs(a.target)){const c=new E(a.target.path);null!==this.st.get(c)||this.yt(o,c)||this.ct(o,c,V.newNoDocument(c,e))}i.j&&(t.set(o,i.G()),i.H())}});let r=M();this.it.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{const h=this.wt(c);return!h||2===h.purpose||(a=!1,!1)}),a&&(r=r.add(i))});const s=new ir(e,t,this.rt,this.st,r);return this.st=Le(),this.it=eh(),this.rt=new j(k),s}at(e,t){if(!this.lt(e))return;const r=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,r),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}ct(e,t,r){if(!this.lt(e))return;const s=this.ht(e);this.yt(e,t)?s.J(t,1):s.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),r&&(this.st=this.st.insert(t,r))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new Xc,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new j(k),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||_("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new Xc),this.et.getRemoteKeysForTarget(e).forEach(t=>{this.ct(e,t,null)})}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function eh(){return new W(E.comparator)}function th(){return new W(E.comparator)}const wm={asc:"ASCENDING",desc:"DESCENDING"},_m={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Tm{constructor(e,t){this.databaseId=e,this.C=t}}function ar(n,e){return n.C?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function nh(n,e){return n.C?e.toBase64():e.toUint8Array()}function Im(n,e){return ar(n,e.toTimestamp())}function re(n){return A(!!n),N.fromTimestamp(function(e){const t=it(e);return new te(t.seconds,t.nanos)}(n))}function Hi(n,e){return(t=n,new O(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function rh(n){const e=O.fromString(n);return A(gh(e)),e}function ur(n,e){return Hi(n.databaseId,e.path)}function qe(n,e){const t=rh(e);if(t.get(1)!==n.databaseId.projectId)throw new v(f.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new v(f.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new E(ih(t))}function Wi(n,e){return Hi(n.databaseId,e)}function sh(n){const e=rh(n);return 4===e.length?O.emptyPath():ih(e)}function cr(n){return new O(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ih(n){return A(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function oh(n,e,t){return{name:ur(n,e),fields:t.value.mapValue.fields}}function ah(n,e,t){const r=qe(n,e.name),s=re(e.updateTime),i=new me({mapValue:{fields:e.fields}}),o=V.newFoundDocument(r,s,i);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function fs(n,e){let t;if(e instanceof rr)t={update:oh(n,e.key,e.value)};else if(e instanceof sr)t={delete:ur(n,e.key)};else if(e instanceof ot)t={update:oh(n,e.key,e.data),updateMask:km(e.fieldMask)};else{if(!(e instanceof Qi))return x();t={verify:ur(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof tn)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof bt)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Ct)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof nn)return{fieldPath:i.field.canonicalString(),increment:o.N};throw x()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Im(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:x()),t;var s}function uh(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?z.updateTime(re(s.updateTime)):void 0!==s.exists?z.exists(s.exists):z.none():z.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(A("REQUEST_TIME"===o.setToServerValue),a=new tn):"appendMissingElements"in o?a=new bt(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new Ct(o.removeAllFromArray.values||[]):"increment"in o?a=new nn(i,o.increment):x();const c=he.fromServerFormat(o.fieldPath);return new nr(c,a)}(n,s)):[];var s;if(e.update){const s=qe(n,e.update.name),i=new me({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ht((e.updateMask.fieldPaths||[]).map(h=>he.fromServerFormat(h)));return new ot(s,i,o,t,r)}return new rr(s,i,t,r)}if(e.delete){const s=qe(n,e.delete);return new sr(s,t)}if(e.verify){const s=qe(n,e.verify);return new Qi(s,t)}return x()}function ch(n,e){return{documents:[Wi(n,e.path)]}}function hh(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Wi(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Wi(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(a){if(0===a.length)return;const c=a.map(h=>function(l){if("=="===l.op){if(xc(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NAN"}};if(Ec(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NULL"}}}else if("!="===l.op){if(xc(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NOT_NAN"}};if(Ec(l.value))return{unaryFilter:{field:rn(l.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rn(l.field),op:Cm(l.op),value:l.value}}}(h));return 1===c.length?c[0]:{compositeFilter:{op:"AND",filters:c}}}(e.filters);s&&(t.structuredQuery.where=s);const i=function(a){if(0!==a.length)return a.map(c=>{return{field:rn((h=c).field),direction:bm(h.dir)};var h})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(c=e.limit,n.C||St(c)?c:{value:c});var c;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=fh(e.startAt)),e.endAt&&(t.structuredQuery.endAt=fh(e.endAt)),t}function lh(n){let e=sh(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){A(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=dh(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new Jt(sn((d=l).field),function(m){switch(m){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(d.direction));var d}));let a=null;t.limit&&(a=function(l){let d;return d="object"==typeof l?l.value:l,St(d)?null:d}(t.limit));let c=null;t.startAt&&(c=mh(t.startAt));let h=null;return t.endAt&&(h=mh(t.endAt)),Dc(e,s,o,i,a,"F",c,h)}function dh(n){return n?void 0!==n.unaryFilter?[Dm(n)]:void 0!==n.fieldFilter?[Nm(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>dh(e)).reduce((e,t)=>e.concat(t)):x():[]}function fh(n){return{before:n.before,values:n.position}}function mh(n){return new Xn(n.values||[],!!n.before)}function bm(n){return wm[n]}function Cm(n){return _m[n]}function rn(n){return{fieldPath:n.canonicalString()}}function sn(n){return he.fromServerFormat(n.fieldPath)}function Nm(n){return Te.create(sn(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return x()}}(n.fieldFilter.op),n.fieldFilter.value)}function Dm(n){switch(n.unaryFilter.op){case"IS_NAN":const e=sn(n.unaryFilter.field);return Te.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=sn(n.unaryFilter.field);return Te.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=sn(n.unaryFilter.field);return Te.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=sn(n.unaryFilter.field);return Te.create(s,"!=",{nullValue:"NULL_VALUE"});default:return x()}}function km(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function gh(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Oe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ph(e)),e=Rm(n.get(t),e);return ph(e)}function Rm(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function ph(n){return n+"\x01\x01"}function ze(n){const e=n.length;if(A(e>=2),2===e)return A("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),O.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&x(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let c;0===s.length?c=a:(s+=a,c=s,s=""),r.push(c);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:x()}i=o+2}return new O(r)}class Lm{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Ne{constructor(e,t,r){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=r}}Ne.store="owner",Ne.key="owner";class at{constructor(e,t,r){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=r}}at.store="mutationQueues",at.keyPath="userId";class P{constructor(e,t,r,s,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=r,this.baseMutations=s,this.mutations=i}}P.store="mutations",P.keyPath="batchId",P.userMutationsIndex="userMutationsIndex",P.userMutationsKeyPath=["userId","batchId"];class ge{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Oe(t)]}static key(e,t,r){return[e,Oe(t),r]}}ge.store="documentMutations",ge.PLACEHOLDER=new ge;class Fm{constructor(e,t){this.path=e,this.readTime=t}}class Om{constructor(e,t){this.path=e,this.version=t}}class Z{constructor(e,t,r,s,i,o){this.unknownDocument=e,this.noDocument=t,this.document=r,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=o}}Z.store="remoteDocuments",Z.readTimeIndex="readTimeIndex",Z.readTimeIndexPath="readTime",Z.collectionReadTimeIndex="collectionReadTimeIndex",Z.collectionReadTimeIndexPath=["parentPath","readTime"];class Ue{constructor(e){this.byteSize=e}}Ue.store="remoteDocumentGlobal",Ue.key="remoteDocumentGlobalKey";class xe{constructor(e,t,r,s,i,o,a){this.targetId=e,this.canonicalId=t,this.readTime=r,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}}xe.store="targets",xe.keyPath="targetId",xe.queryTargetsIndexName="queryTargetsIndex",xe.queryTargetsKeyPath=["canonicalId","targetId"];class de{constructor(e,t,r){this.targetId=e,this.path=t,this.sequenceNumber=r}}de.store="targetDocuments",de.keyPath=["targetId","path"],de.documentTargetsIndex="documentTargetsIndex",de.documentTargetsKeyPath=["path","targetId"];class De{constructor(e,t,r,s){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=r,this.targetCount=s}}De.key="targetGlobalKey",De.store="targetGlobal";class Nt{constructor(e,t){this.collectionId=e,this.parent=t}}Nt.store="collectionParents",Nt.keyPath=["collectionId","parent"];class He{constructor(e,t,r,s){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=r,this.inForeground=s}}He.store="clientMetadata",He.keyPath="clientId";class on{constructor(e,t,r){this.bundleId=e,this.createTime=t,this.version=r}}on.store="bundles",on.keyPath="bundleId";class an{constructor(e,t,r){this.name=e,this.readTime=t,this.bundledQuery=r}}an.store="namedQueries",an.keyPath="name";const Mm=[at.store,P.store,ge.store,Z.store,xe.store,Ne.store,De.store,de.store,He.store,Ue.store,Nt.store,on.store,an.store],yh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class y{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&x(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new y((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof y?t:y.resolve(t)}catch(t){return y.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):y.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):y.reject(t)}static resolve(e){return new y((t,r)=>{t(e)})}static reject(e){return new y((t,r)=>{r(e)})}static waitFor(e){return new y((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},c=>r(c))}),o=!0,i===s&&t()})}static or(e){let t=y.resolve(!1);for(const r of e)t=t.next(s=>s?y.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}}class ms{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.It=new ee,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{t.error?this.It.reject(new hr(e,t.error)):this.It.resolve()},this.transaction.onerror=r=>{const s=Yi(r.target.error);this.It.reject(new hr(e,s))}}static open(e,t,r,s){try{return new ms(t,e.transaction(s,r))}catch(i){throw new hr(t,i)}}get At(){return this.It.promise}abort(e){e&&this.It.reject(e),this.aborted||(_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new qm(t)}}class Me{constructor(e,t,r){this.name=e,this.version=t,this.Rt=r,12.2===Me.Pt((0,F.z$)())&&G("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return _("SimpleDb","Removing database:",e),kt(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if(!(0,F.hl)())return!1;if(Me.vt())return!0;const e=(0,F.z$)(),t=Me.Pt(e),r=0<t&&t<10,s=Me.Vt(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static vt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.St)}static Dt(e,t){return e.store(t)}static Pt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static Vt(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}Ct(e){var t=this;return(0,g.Z)(function*(){return t.db||(_("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new hr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new v(f.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new v(f.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new hr(e,a))},i.onupgradeneeded=o=>{_("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.Rt.Nt(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{_("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.kt&&(t.db.onversionchange=r=>t.kt(r)),t.db})()}xt(e){this.kt=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,g.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.Ct(e);const c=ms.open(i.db,e,o?"readonly":"readwrite",r),h=s(c).catch(l=>(c.abort(l),y.reject(l))).toPromise();return h.catch(()=>{}),yield c.At,h}catch(c){const h="FirebaseError"!==c.name&&a<3;if(_("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),i.close(),!h)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Pm{constructor(e){this.$t=e,this.Ft=!1,this.Ot=null}get isDone(){return this.Ft}get Mt(){return this.Ot}set cursor(e){this.$t=e}done(){this.Ft=!0}Lt(e){this.Ot=e}delete(){return kt(this.$t.delete())}}class hr extends v{constructor(e,t){super(f.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Dt(n){return"IndexedDbTransactionError"===n.name}class qm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(_("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),kt(r)}add(e){return _("SimpleDb","ADD",this.store.name,e,e),kt(this.store.add(e))}get(e){return kt(this.store.get(e)).next(t=>(void 0===t&&(t=null),_("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return _("SimpleDb","DELETE",this.store.name,e),kt(this.store.delete(e))}count(){return _("SimpleDb","COUNT",this.store.name),kt(this.store.count())}Bt(e,t){const r=this.cursor(this.options(e,t)),s=[];return this.Ut(r,(i,o)=>{s.push(o)}).next(()=>s)}qt(e,t){_("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Kt=!1;const s=this.cursor(r);return this.Ut(s,(i,o,a)=>a.delete())}jt(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.Ut(s,t)}Qt(e){const t=this.cursor({});return new y((r,s)=>{t.onerror=i=>{const o=Yi(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}Ut(e,t){const r=[];return new y((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new Pm(a),h=t(a.primaryKey,a.value,c);if(h instanceof y){const l=h.catch(d=>(c.done(),y.reject(d)));r.push(l)}c.isDone?s():null===c.Mt?a.continue():a.continue(c.Mt)}}).next(()=>y.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Kt?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function kt(n){return new y((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=Yi(r.target.error);t(s)}})}let wh=!1;function Yi(n){const e=Me.Pt((0,F.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wh||(wh=!0,setTimeout(()=>{throw r},0)),r}}return n}class _h extends vh{constructor(e,t){super(),this.Wt=e,this.currentSequenceNumber=t}}function Se(n,e){const t=T(n);return Me.Dt(t.Wt,e)}class Ji{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&hm(i,e,r[s])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Gi(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Gi(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const r=e.get(t.key),s=r;this.applyToLocalView(s),r.isValidDocument()||s.convertToNoDocument(N.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),M())}isEqual(e){return this.batchId===e.batchId&&zt(this.mutations,e.mutations,(t,r)=>jc(t,r))&&zt(this.baseMutations,e.baseMutations,(t,r)=>jc(t,r))}}class Xi{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){A(e.mutations.length===r.length);let s=Wc();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Xi(e,t,r,s)}}class ut{constructor(e,t,r,s,i=N.min(),o=N.min(),a=ne.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new ut(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ut(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ut(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Th{constructor(e){this.Gt=e}}function eo(n,e){if(e.document)return ah(n.Gt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=E.fromSegments(e.noDocument.path),r=cn(e.noDocument.readTime),s=V.newNoDocument(t,r);return e.hasCommittedMutations?s.setHasCommittedMutations():s}if(e.unknownDocument){const t=E.fromSegments(e.unknownDocument.path),r=cn(e.unknownDocument.version);return V.newUnknownDocument(t,r)}return x()}function Ih(n,e,t){const r=to(t),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const i={name:ur(a=n.Gt,(c=e).key),fields:c.data.value.mapValue.fields,updateTime:ar(a,c.version.toTimestamp())};return new Z(null,null,i,e.hasCommittedMutations,r,s)}var a,c;if(e.isNoDocument()){const i=e.key.path.toArray(),o=un(e.version),a=e.hasCommittedMutations;return new Z(null,new Fm(i,o),null,a,r,s)}if(e.isUnknownDocument()){const i=e.key.path.toArray(),o=un(e.version);return new Z(new Om(i,o),null,null,!0,r,s)}return x()}function to(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Eh(n){const e=new te(n[0],n[1]);return N.fromTimestamp(e)}function un(n){const e=n.toTimestamp();return new Lm(e.seconds,e.nanoseconds)}function cn(n){const e=new te(n.seconds,n.nanoseconds);return N.fromTimestamp(e)}function hn(n,e){const t=(e.baseMutations||[]).map(i=>uh(n.Gt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>uh(n.Gt,i)),s=te.fromMillis(e.localWriteTimeMs);return new Ji(e.batchId,s,t,r)}function lr(n){const e=cn(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?cn(n.lastLimboFreeSnapshotVersion):N.min();let r;var s;return void 0!==n.query.documents?(A(1===(s=n.query).documents.length),r=Re(Xt(sh(s.documents[0])))):r=Re(lh(n.query)),new ut(r,n.targetId,0,n.lastListenSequenceNumber,e,t,ne.fromBase64String(n.resumeToken))}function xh(n,e){const t=un(e.snapshotVersion),r=un(e.lastLimboFreeSnapshotVersion);let s;s=rs(e.target)?ch(n.Gt,e.target):hh(n.Gt,e.target);const i=e.resumeToken.toBase64();return new xe(e.targetId,Jn(e.target),t,i,e.sequenceNumber,r,s)}function no(n){const e=lh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?kc(e,e.limit,"L"):e}class Um{getBundleMetadata(e,t){return Sh(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:cn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Sh(e).put({bundleId:(r=t).id,createTime:un(re(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Ah(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:no(s.bundledQuery),readTime:cn(s.readTime)};var s})}saveNamedQuery(e,t){return Ah(e).put({name:(r=t).name,readTime:un(re(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Sh(n){return Se(n,on.store)}function Ah(n){return Se(n,an.store)}class Vm{constructor(){this.zt=new ro}addToCollectionParentIndex(e,t){return this.zt.add(t),y.resolve()}getCollectionParents(e,t){return y.resolve(this.zt.getEntries(t))}}class ro{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new j(O.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new j(O.comparator)).toArray()}}class Bm{constructor(){this.Ht=new ro}addToCollectionParentIndex(e,t){if(!this.Ht.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.Ht.add(t)});const i={collectionId:r,parent:Oe(s)};return bh(e).put(i)}return y.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[yc(t),""],!1,!0);return bh(e).Bt(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ze(o.parent))}return r})}}function bh(n){return Se(n,Nt.store)}const Ch={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ae{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ae(e,Ae.DEFAULT_COLLECTION_PERCENTILE,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Nh(n,e,t){const r=n.store(P.store),s=n.store(ge.store),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=r.jt({range:o},(l,d,m)=>(a++,m.delete()));i.push(c.next(()=>{A(1===a)}));const h=[];for(const l of t.mutations){const d=ge.key(e,l.key.path,t.batchId);i.push(s.delete(d)),h.push(l.key)}return y.waitFor(i).next(()=>h)}function gs(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw x();e=n.noDocument}return JSON.stringify(e).length}Ae.DEFAULT_COLLECTION_PERCENTILE=10,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ae.DEFAULT=new Ae(41943040,Ae.DEFAULT_COLLECTION_PERCENTILE,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ae.DISABLED=new Ae(-1,0,0);class so{constructor(e,t,r,s){this.userId=e,this.k=t,this.Jt=r,this.referenceDelegate=s,this.Yt={}}static Xt(e,t,r,s){A(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new so(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ct(e).jt({index:P.userMutationsIndex,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=ln(e),o=ct(e);return o.add({}).next(a=>{A("number"==typeof a);const c=new Ji(a,t,r,s),h=function(m,p,w){const S=w.baseMutations.map(J=>fs(m.Gt,J)),C=w.mutations.map(J=>fs(m.Gt,J));return new P(p,w.batchId,w.localWriteTime.toMillis(),S,C)}(this.k,this.userId,c),l=[];let d=new j((m,p)=>k(m.canonicalString(),p.canonicalString()));for(const m of s){const p=ge.key(this.userId,m.key.path,a);d=d.add(m.key.path.popLast()),l.push(o.put(h)),l.push(i.put(p,ge.PLACEHOLDER))}return d.forEach(m=>{l.push(this.Jt.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Yt[a]=c.keys()}),y.waitFor(l).next(()=>c)})}lookupMutationBatch(e,t){return ct(e).get(t).next(r=>r?(A(r.userId===this.userId),hn(this.k,r)):null)}Zt(e,t){return this.Yt[t]?y.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Yt[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ct(e).jt({index:P.userMutationsIndex,range:s},(o,a,c)=>{a.userId===this.userId&&(A(a.batchId>=r),i=hn(this.k,a)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ct(e).jt({index:P.userMutationsIndex,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ct(e).Bt(P.userMutationsIndex,t).next(r=>r.map(s=>hn(this.k,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=ge.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return ln(e).jt({range:s},(o,a,c)=>{const[h,l,d]=o,m=ze(l);if(h===this.userId&&t.path.isEqual(m))return ct(e).get(d).next(p=>{if(!p)throw x();A(p.userId===this.userId),i.push(hn(this.k,p))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(k);const s=[];return t.forEach(i=>{const o=ge.prefixForPath(this.userId,i.path),a=IDBKeyRange.lowerBound(o),c=ln(e).jt({range:a},(h,l,d)=>{const[m,p,w]=h,S=ze(p);m===this.userId&&i.path.isEqual(S)?r=r.add(w):d.done()});s.push(c)}),y.waitFor(s).next(()=>this.te(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=ge.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new j(k);return ln(e).jt({range:o},(c,h,l)=>{const[d,m,p]=c,w=ze(m);d===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(p)):l.done()}).next(()=>this.te(e,a))}te(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ct(e).get(i).next(o=>{if(null===o)throw x();A(o.userId===this.userId),r.push(hn(this.k,o))}))}),y.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Nh(e.Wt,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ee(t.batchId)}),y.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ee(e){delete this.Yt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return y.resolve();const r=IDBKeyRange.lowerBound(ge.prefixForUser(this.userId)),s=[];return ln(e).jt({range:r},(i,o,a)=>{if(i[0]===this.userId){const c=ze(i[1]);s.push(c)}else a.done()}).next(()=>{A(0===s.length)})})}containsKey(e,t){return Dh(e,this.userId,t)}ne(e){return kh(e).get(this.userId).next(t=>t||new at(this.userId,-1,""))}}function Dh(n,e,t){const r=ge.prefixForPath(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return ln(n).jt({range:i,Kt:!0},(a,c,h)=>{const[l,d,m]=a;l===e&&d===s&&(o=!0),h.done()}).next(()=>o)}function ct(n){return Se(n,P.store)}function ln(n){return Se(n,ge.store)}function kh(n){return Se(n,at.store)}class Rt{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new Rt(0)}static re(){return new Rt(-1)}}class jm{constructor(e,t){this.referenceDelegate=e,this.k=t}allocateTargetId(e){return this.oe(e).next(t=>{const r=new Rt(t.highestTargetId);return t.highestTargetId=r.next(),this.ae(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.oe(e).next(t=>N.fromTimestamp(new te(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.oe(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.oe(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.ae(e,s)))}addTargetData(e,t){return this.ce(e,t).next(()=>this.oe(e).next(r=>(r.targetCount+=1,this.ue(t,r),this.ae(e,r))))}updateTargetData(e,t){return this.ce(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>dn(e).delete(t.targetId)).next(()=>this.oe(e)).next(r=>(A(r.targetCount>0),r.targetCount-=1,this.ae(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return dn(e).jt((o,a)=>{const c=lr(a);c.sequenceNumber<=t&&null===r.get(c.targetId)&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>y.waitFor(i)).next(()=>s)}forEachTarget(e,t){return dn(e).jt((r,s)=>{const i=lr(s);t(i)})}oe(e){return Rh(e).get(De.key).next(t=>(A(null!==t),t))}ae(e,t){return Rh(e).put(De.key,t)}ce(e,t){return dn(e).put(xh(this.k,t))}ue(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.oe(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Jn(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return dn(e).jt({range:s,index:xe.queryTargetsIndexName},(o,a,c)=>{const h=lr(a);ns(t,h.target)&&(i=h,c.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ht(e);return t.forEach(o=>{const a=Oe(o.path);s.push(i.put(new de(r,a))),s.push(this.referenceDelegate.addReference(e,r,o))}),y.waitFor(s)}removeMatchingKeys(e,t,r){const s=ht(e);return y.forEach(t,i=>{const o=Oe(i.path);return y.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ht(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ht(e);let i=M();return s.jt({range:r,Kt:!0},(o,a,c)=>{const h=ze(o[1]),l=new E(h);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=Oe(t.path),s=IDBKeyRange.bound([r],[yc(r)],!1,!0);let i=0;return ht(e).jt({index:de.documentTargetsIndex,Kt:!0,range:s},([o,a],c,h)=>{0!==o&&(i++,h.done())}).next(()=>i>0)}Et(e,t){return dn(e).get(t).next(r=>r?lr(r):null)}}function dn(n){return Se(n,xe.store)}function Rh(n){return Se(n,De.store)}function ht(n){return Se(n,de.store)}function Lt(n){return io.apply(this,arguments)}function io(){return(io=(0,g.Z)(function*(n){if(n.code!==f.FAILED_PRECONDITION||n.message!==yh)throw n;_("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}function Lh([n,e],[t,r]){const s=k(n,t);return 0===s?k(e,r):s}class Zm{constructor(e){this.he=e,this.buffer=new j(Lh),this.le=0}fe(){return++this.le}de(e){const t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Lh(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class $m{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.we=!1,this._e=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(e){var t=this;const r=this.we?3e5:6e4;_("LruGarbageCollector",`Garbage collection scheduled in ${r}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,(0,g.Z)(function*(){t._e=null,t.we=!0;try{yield e.collectGarbage(t.garbageCollector)}catch(s){Dt(s)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s):yield Lt(s)}yield t.me(e)}))}}class Km{constructor(e,t){this.ge=e,this.params=t}calculateTargetCount(e,t){return this.ge.ye(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return y.resolve(Ce.I);const r=new Zm(t);return this.ge.forEachTarget(e,s=>r.de(s.sequenceNumber)).next(()=>this.ge.pe(e,s=>r.de(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.ge.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.ge.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector","Garbage collection skipped; disabled"),y.resolve(Ch)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ch):this.Te(e,t))}getCacheSize(e){return this.ge.getCacheSize(e)}Te(e,t){let r,s,i,o,a,c,h;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),s=this.params.maximumSequenceNumbersToCollect):s=d,o=Date.now(),this.nthSequenceNumber(e,s))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(i=d,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(h=Date.now(),Oi()<=vt.in.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(c-a)+`ms\n\tRemoved ${d} documents in `+(h-c)+`ms\nTotal Duration: ${h-l}ms`),y.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:d})))}}class Gm{constructor(e,t){this.db=e,this.garbageCollector=new Km(this,t)}ye(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Ee(e){let t=0;return this.pe(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pe(e,t){return this.Ie(e,(r,s)=>t(s))}addReference(e,t,r){return ps(e,r)}removeReference(e,t,r){return ps(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ps(e,t)}Ae(e,t){return function(r,s){let i=!1;return kh(r).Qt(o=>Dh(r,o,s).next(a=>(a&&(i=!0),y.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ie(e,(o,a)=>{if(a<=t){const c=this.Ae(e,o).next(h=>{if(!h)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o),ht(e).delete([0,Oe(o.path)])))});s.push(c)}}).next(()=>y.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ps(e,t)}Ie(e,t){const r=ht(e);let s,i=Ce.I;return r.jt({index:de.documentTargetsIndex},([o,a],{path:c,sequenceNumber:h})=>{0===o?(i!==Ce.I&&t(new E(ze(s)),i),i=h,s=c):i=Ce.I}).next(()=>{i!==Ce.I&&t(new E(ze(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ps(n,e){return ht(n).put((r=n.currentSequenceNumber,new de(0,Oe(e.path),r)));var r}class fn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0!==s){for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t])}else this.inner[r]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),!0;return!1}forEach(e){xt(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return wc(this.inner)}}class Fh{constructor(){this.changes=new fn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:N.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:V.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?y.resolve(r.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Qm{constructor(e,t){this.k=e,this.Jt=t}addEntry(e,t,r){return lt(e).put(ys(t),r)}removeEntry(e,t){const r=lt(e),s=ys(t);return r.delete(s)}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Re(e,r)))}getEntry(e,t){return lt(e).get(ys(t)).next(r=>this.Pe(t,r))}be(e,t){return lt(e).get(ys(t)).next(r=>({document:this.Pe(t,r),size:gs(r)}))}getEntries(e,t){let r=Le();return this.ve(e,t,(s,i)=>{const o=this.Pe(s,i);r=r.insert(s,o)}).next(()=>r)}Ve(e,t){let r=Le(),s=new W(E.comparator);return this.ve(e,t,(i,o)=>{const a=this.Pe(i,o);r=r.insert(i,a),s=s.insert(i,gs(o))}).next(()=>({documents:r,Se:s}))}ve(e,t,r){if(t.isEmpty())return y.resolve();const s=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return lt(e).jt({range:s},(a,c,h)=>{const l=E.fromSegments(a);for(;o&&E.comparator(o,l)<0;)r(o,null),o=i.getNext();o&&o.isEqual(l)&&(r(o,c),o=i.hasNext()?i.getNext():null),o?h.Lt(o.path.toArray()):h.done()}).next(()=>{for(;o;)r(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,r){let s=Le();const i=t.path.length+1,o={};if(r.isEqual(N.min())){const a=t.path.toArray();o.range=IDBKeyRange.lowerBound(a)}else{const a=t.path.toArray(),c=to(r);o.range=IDBKeyRange.lowerBound([a,c],!0),o.index=Z.collectionReadTimeIndex}return lt(e).jt(o,(a,c,h)=>{if(a.length!==i)return;const l=eo(this.k,c);t.path.isPrefixOf(l.key.path)?tr(t,l)&&(s=s.insert(l.key,l)):h.done()}).next(()=>s)}newChangeBuffer(e){return new zm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Oh(e).get(Ue.key).next(t=>(A(!!t),t))}Re(e,t){return Oh(e).put(Ue.key,t)}Pe(e,t){if(t){const r=eo(this.k,t);if(!r.isNoDocument()||!r.version.isEqual(N.min()))return r}return V.newInvalidDocument(e)}}class zm extends Fh{constructor(e,t){super(),this.De=e,this.trackRemovals=t,this.Ce=new fn(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new j((i,o)=>k(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Ce.get(i);if(o.document.isValidDocument()){const c=Ih(this.De.k,o.document,this.getReadTime(i));s=s.add(i.path.popLast()),r+=gs(c)-a,t.push(this.De.addEntry(e,i,c))}else if(r-=a,this.trackRemovals){const c=Ih(this.De.k,V.newNoDocument(i,N.min()),this.getReadTime(i));t.push(this.De.addEntry(e,i,c))}else t.push(this.De.removeEntry(e,i))}),s.forEach(i=>{t.push(this.De.Jt.addToCollectionParentIndex(e,i))}),t.push(this.De.updateMetadata(e,r)),y.waitFor(t)}getFromCache(e,t){return this.De.be(e,t).next(r=>(this.Ce.set(t,r.size),r.document))}getAllFromCache(e,t){return this.De.Ve(e,t).next(({documents:r,Se:s})=>(s.forEach((i,o)=>{this.Ce.set(i,o)}),r))}}function Oh(n){return Se(n,Ue.store)}function lt(n){return Se(n,Z.store)}function ys(n){return n.path.toArray()}class Hm{constructor(e){this.k=e}Nt(e,t,r,s){A(r<s&&r>=0&&s<=11);const i=new ms("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore(Ne.store),(a=e).createObjectStore(at.store,{keyPath:at.keyPath}),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0}),a.createObjectStore(ge.store),Mh(e),function(a){a.createObjectStore(Z.store)}(e));let o=y.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore(de.store),a.deleteObjectStore(xe.store),a.deleteObjectStore(De.store)}(e),Mh(e)),o=o.next(()=>function(a){const c=a.store(De.store),h=new De(0,0,N.min().toTimestamp(),0);return c.put(De.key,h)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,c){return c.store(P.store).Bt().next(h=>{a.deleteObjectStore(P.store),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0});const l=c.store(P.store),d=h.map(m=>l.put(m));return y.waitFor(d)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore(He.store,{keyPath:He.keyPath})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Ne(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore(Ue.store)}(e),this.ke(i)))),r<7&&s>=7&&(o=o.next(()=>this.xe(i))),r<8&&s>=8&&(o=o.next(()=>this.$e(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e),function(a){const c=a.objectStore(Z.store);c.createIndex(Z.readTimeIndex,Z.readTimeIndexPath,{unique:!1}),c.createIndex(Z.collectionReadTimeIndex,Z.collectionReadTimeIndexPath,{unique:!1})}(t)})),r<10&&s>=10&&(o=o.next(()=>this.Fe(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore(on.store,{keyPath:on.keyPath})})(e),function(a){a.createObjectStore(an.store,{keyPath:an.keyPath})}(e)})),o}ke(e){let t=0;return e.store(Z.store).jt((r,s)=>{t+=gs(s)}).next(()=>{const r=new Ue(t);return e.store(Ue.store).put(Ue.key,r)})}Ne(e){const t=e.store(at.store),r=e.store(P.store);return t.Bt().next(s=>y.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.Bt(P.userMutationsIndex,o).next(a=>y.forEach(a,c=>{A(c.userId===i.userId);const h=hn(this.k,c);return Nh(e,i.userId,h).next(()=>{})}))}))}xe(e){const t=e.store(de.store),r=e.store(Z.store);return e.store(De.store).get(De.key).next(s=>{const i=[];return r.jt((o,a)=>{const c=new O(o),h=[0,Oe(c)];i.push(t.get(h).next(l=>l?y.resolve():t.put(new de(0,Oe(c),s.highestListenSequenceNumber))))}).next(()=>y.waitFor(i))})}$e(e,t){e.createObjectStore(Nt.store,{keyPath:Nt.keyPath});const r=t.store(Nt.store),s=new ro,i=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:Oe(c)})}};return t.store(Z.store).jt({Kt:!0},(o,a)=>{const c=new O(o);return i(c.popLast())}).next(()=>t.store(ge.store).jt({Kt:!0},([o,a,c],h)=>{const l=ze(a);return i(l.popLast())}))}Fe(e){const t=e.store(xe.store);return t.jt((r,s)=>{const i=lr(s),o=xh(this.k,i);return t.put(o)})}}function Mh(n){n.createObjectStore(de.store,{keyPath:de.keyPath}).createIndex(de.documentTargetsIndex,de.documentTargetsKeyPath,{unique:!0}),n.createObjectStore(xe.store,{keyPath:xe.keyPath}).createIndex(xe.queryTargetsIndexName,xe.queryTargetsKeyPath,{unique:!0}),n.createObjectStore(De.store)}const oo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ao{constructor(e,t,r,s,i,o,a,c,h,l){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Oe=i,this.window=o,this.document=a,this.Me=h,this.Le=l,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=d=>Promise.resolve(),!ao.bt())throw new v(f.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gm(this,s),this.Ge=t+"main",this.k=new Th(c),this.ze=new Me(this.Ge,11,new Hm(this.k)),this.He=new jm(this.referenceDelegate,this.k),this.Jt=new Bm,this.Je=new Qm(this.k,this.Jt),this.Ye=new Um,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===l&&G("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new v(f.FAILED_PRECONDITION,oo);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.He.getHighestSequenceNumber(e))}).then(e=>{this.Be=new Ce(e,this.Me)}).then(()=>{this.Ue=!0}).catch(e=>(this.ze&&this.ze.close(),Promise.reject(e)))}sn(e){var t=this;return this.We=function(){var r=(0,g.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ze.xt(function(){var t=(0,g.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,g.Z)(function*(){t.started&&(yield t.Ze())})))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>vs(e).put(new He(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.rn(e).next(t=>{t||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.We(!1)))})}).next(()=>this.on(e)).next(t=>this.isPrimary&&!t?this.an(e).next(()=>!1):!!t&&this.cn(e).next(()=>!0))).catch(e=>{if(Dt(e))return _("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.We(e)),this.isPrimary=e})}rn(e){return dr(e).get(Ne.key).next(t=>y.resolve(this.un(t)))}hn(e){return vs(e).delete(this.clientId)}ln(){var e=this;return(0,g.Z)(function*(){if(e.isPrimary&&!e.fn(e.Qe,18e5)){e.Qe=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=Se(r,He.store);return s.Bt().next(i=>{const o=e.dn(i,18e5),a=i.filter(c=>-1===o.indexOf(c));return y.forEach(a,c=>s.delete(c.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Xe)for(const r of t)e.Xe.removeItem(e.wn(r.clientId))}})()}nn(){this.je=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ze().then(()=>this.ln()).then(()=>this.nn()))}un(e){return!!e&&e.ownerId===this.clientId}on(e){return this.Le?y.resolve(!0):dr(e).get(Ne.key).next(t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)){if(this.un(t)&&this.networkEnabled)return!0;if(!this.un(t)){if(!t.allowTabSynchronization)throw new v(f.FAILED_PRECONDITION,oo);return!1}}return!(!this.networkEnabled||!this.inForeground)||vs(e).Bt().next(r=>void 0===this.dn(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&_("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,g.Z)(function*(){e.Ue=!1,e.mn(),e.je&&(e.je.cancel(),e.je=null),e.gn(),e.yn(),yield e.ze.runTransaction("shutdown","readwrite",[Ne.store,He.store],t=>{const r=new _h(t,Ce.I);return e.an(r).next(()=>e.hn(r))}),e.ze.close(),e.pn()})()}dn(e,t){return e.filter(r=>this.fn(r.updateTimeMs,t)&&!this._n(r.clientId))}Tn(){return this.runTransaction("getActiveClients","readonly",e=>vs(e).Bt().next(t=>this.dn(t,18e5).map(r=>r.clientId)))}get started(){return this.Ue}getMutationQueue(e){return so.Xt(e,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,t,r){let i;return _("IndexedDbPersistence","Starting transaction:",e),this.ze.runTransaction(e,"readonly"===t?"readonly":"readwrite",Mm,o=>(i=new _h(o,this.Be?this.Be.next():Ce.I),"readwrite-primary"===t?this.rn(i).next(a=>!!a||this.on(i)).next(a=>{if(!a)throw G(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.We(!1)),new v(f.FAILED_PRECONDITION,yh);return r(i)}).next(a=>this.cn(i).next(()=>a)):this.En(i).next(()=>r(i)))).then(o=>(i.raiseOnCommittedEvent(),o))}En(e){return dr(e).get(Ne.key).next(t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)&&!this.un(t)&&!(this.Le||this.allowTabSynchronization&&t.allowTabSynchronization))throw new v(f.FAILED_PRECONDITION,oo)})}cn(e){const t=new Ne(this.clientId,this.allowTabSynchronization,Date.now());return dr(e).put(Ne.key,t)}static bt(){return Me.bt()}an(e){const t=dr(e);return t.get(Ne.key).next(r=>this.un(r)?(_("IndexedDbPersistence","Releasing primary lease."),t.delete(Ne.key)):y.resolve())}fn(e,t){const r=Date.now();return!(e<r-t||e>r&&(G(`Detected an update time that is in the future: ${e} > ${r}`),1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze()))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=()=>{this.mn(),(0,F.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(e){var t;try{const r=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return _("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return G("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(e){G("Failed to set zombie client id.",e)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(e){}}wn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function dr(n){return Se(n,Ne.store)}function vs(n){return Se(n,He.store)}function uo(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Wm{constructor(e,t){this.progress=e,this.In=t}}class Ph{constructor(e,t,r){this.Je=e,this.An=t,this.Jt=r}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next(r=>this.Pn(e,t,r))}Pn(e,t,r){return this.Je.getEntry(e,t).next(s=>{for(const i of r)i.applyToLocalView(s);return s})}bn(e,t){e.forEach((r,s)=>{for(const i of t)i.applyToLocalView(s)})}vn(e,t){return this.Je.getEntries(e,t).next(r=>this.Vn(e,r).next(()=>r))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next(r=>this.bn(t,r))}getDocumentsMatchingQuery(e,t,r){return E.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.Sn(e,t.path):$i(t)?this.Dn(e,t,r):this.Cn(e,t,r);var s}Sn(e,t){return this.Rn(e,new E(t)).next(r=>{let s=zi();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}Dn(e,t,r){const s=t.collectionGroup;let i=zi();return this.Jt.getCollectionParents(e,s).next(o=>y.forEach(o,a=>{const c=(h=t,l=a.child(s),new Qe(l,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,l;return this.Cn(e,c,r).next(h=>{h.forEach((l,d)=>{i=i.insert(l,d)})})}).next(()=>i))}Cn(e,t,r){let s,i;return this.Je.getDocumentsMatchingQuery(e,t,r).next(o=>(s=o,this.An.getAllMutationBatchesAffectingQuery(e,t))).next(o=>(i=o,this.Nn(e,i,s).next(a=>{s=a;for(const c of i)for(const h of c.mutations){const l=h.key;let d=s.get(l);null==d&&(d=V.newInvalidDocument(l),s=s.insert(l,d)),Gi(h,d,c.localWriteTime),d.isFoundDocument()||(s=s.remove(l))}}))).next(()=>(s.forEach((o,a)=>{tr(t,a)||(s=s.remove(o))}),s))}Nn(e,t,r){let s=M();for(const o of t)for(const a of o.mutations)a instanceof ot&&null===r.get(a.key)&&(s=s.add(a.key));let i=r;return this.Je.getEntries(e,s).next(o=>(o.forEach((a,c)=>{c.isFoundDocument()&&(i=i.insert(a,c))}),i))}}class co{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.kn=r,this.xn=s}static $n(e,t){let r=M(),s=M();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new co(e,t.fromCache,r,s)}}class qh{Fn(e){this.On=e}getDocumentsMatchingQuery(e,t,r,s){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||r.isEqual(N.min())?this.Mn(e,t):this.On.vn(e,s).next(i=>{const o=this.Ln(t,i);return(is(t)||os(t))&&this.Bn(t.limitType,o,s,r)?this.Mn(e,t):(Oi()<=vt.in.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ki(t)),this.On.getDocumentsMatchingQuery(e,t,r).next(a=>(o.forEach(c=>{a=a.insert(c.key,c)}),a)))});var i}Ln(e,t){let r=new j(Lc(e));return t.forEach((s,i)=>{tr(e,i)&&(r=r.add(i))}),r}Bn(e,t,r,s){if(r.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Mn(e,t){return Oi()<=vt.in.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",Ki(t)),this.On.getDocumentsMatchingQuery(e,t,N.min())}}class Ym{constructor(e,t,r,s){this.persistence=e,this.Un=t,this.k=s,this.qn=new W(k),this.Kn=new fn(i=>Jn(i),ns),this.jn=N.min(),this.An=e.getMutationQueue(r),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new Ph(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.Fn(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qn))}}function Uh(n,e,t,r){return new Ym(n,e,t,r)}function Vh(n,e){return ho.apply(this,arguments)}function ho(){return(ho=(0,g.Z)(function*(n,e){const t=T(n);let r=t.An,s=t.Wn;const i=yield t.persistence.runTransaction("Handle user change","readonly",o=>{let a;return t.An.getAllMutationBatches(o).next(c=>(a=c,r=t.persistence.getMutationQueue(e),s=new Ph(t.Qn,r,t.persistence.getIndexManager()),r.getAllMutationBatches(o))).next(c=>{const h=[],l=[];let d=M();for(const m of a){h.push(m.batchId);for(const p of m.mutations)d=d.add(p.key)}for(const m of c){l.push(m.batchId);for(const p of m.mutations)d=d.add(p.key)}return s.vn(o,d).next(m=>({Gn:m,removedBatchIds:h,addedBatchIds:l}))})});return t.An=r,t.Wn=s,t.Un.Fn(t.Wn),i})).apply(this,arguments)}function Jm(n,e){const t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Qn.newChangeBuffer({trackRemovals:!0});return function(o,a,c,h){const l=c.batch,d=l.keys();let m=y.resolve();return d.forEach(p=>{m=m.next(()=>h.getEntry(a,p)).next(w=>{const S=c.docVersions.get(p);A(null!==S),w.version.compareTo(S)<0&&(l.applyToRemoteDocument(w,c),w.isValidDocument()&&h.addEntry(w,c.commitVersion))})}),m.next(()=>o.An.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.An.performConsistencyCheck(r)).next(()=>t.Wn.vn(r,s))})}function Bh(n){const e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.He.getLastRemoteSnapshotVersion(t))}function Xm(n,e){const t=T(n),r=e.snapshotVersion;let s=t.qn;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Qn.newChangeBuffer({trackRemovals:!0});s=t.qn;const a=[];e.targetChanges.forEach((h,l)=>{const d=s.get(l);if(!d)return;a.push(t.He.removeMatchingKeys(i,h.removedDocuments,l).next(()=>t.He.addMatchingKeys(i,h.addedDocuments,l)));const m=h.resumeToken;if(m.approximateByteSize()>0){const p=d.withResumeToken(m,r).withSequenceNumber(i.currentSequenceNumber);s=s.insert(l,p),w=d,C=h,A((S=p).resumeToken.approximateByteSize()>0),(0===w.resumeToken.approximateByteSize()||S.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8||C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0)&&a.push(t.He.updateTargetData(i,p))}var w,S,C});let c=Le();if(e.documentUpdates.forEach((h,l)=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(jh(i,o,e.documentUpdates,r,void 0).next(h=>{c=h})),!r.isEqual(N.min())){const h=t.He.getLastRemoteSnapshotVersion(i).next(l=>t.He.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return y.waitFor(a).next(()=>o.apply(i)).next(()=>t.Wn.Vn(i,c)).next(()=>c)}).then(i=>(t.qn=s,i))}function jh(n,e,t,r,s){let i=M();return t.forEach(o=>i=i.add(o)),e.getEntries(n,i).next(o=>{let a=Le();return t.forEach((c,h)=>{const l=o.get(c),d=(null==s?void 0:s.get(c))||r;h.isNoDocument()&&h.version.isEqual(N.min())?(e.removeEntry(c,d),a=a.insert(c,h)):!l.isValidDocument()||h.version.compareTo(l.version)>0||0===h.version.compareTo(l.version)&&l.hasPendingWrites?(e.addEntry(h,d),a=a.insert(c,h)):_("LocalStore","Ignoring outdated watch update for ",c,". Current version:",l.version," Watch version:",h.version)}),a})}function eg(n,e){const t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.An.getNextMutationBatchAfterBatchId(r,e)))}function mn(n,e){const t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.He.getTargetData(r,e).next(i=>i?(s=i,y.resolve(s)):t.He.allocateTargetId(r).next(o=>(s=new ut(e,o,0,r.currentSequenceNumber),t.He.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.qn.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.qn=t.qn.insert(r.targetId,r),t.Kn.set(e,r.targetId)),r})}function gn(n,e,t){return lo.apply(this,arguments)}function lo(){return(lo=(0,g.Z)(function*(n,e,t){const r=T(n),s=r.qn.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Dt(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.qn=r.qn.remove(e),r.Kn.delete(s.target)})).apply(this,arguments)}function ws(n,e,t){const r=T(n);let s=N.min(),i=M();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,c,h){const l=T(a),d=l.Kn.get(h);return void 0!==d?y.resolve(l.qn.get(d)):l.He.getTargetData(c,h)}(r,o,Re(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.Un.getDocumentsMatchingQuery(o,e,t?s:N.min(),t?i:M())).next(a=>({documents:a,zn:i})))}function Zh(n,e){const t=T(n),r=T(t.He),s=t.qn.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.Et(i,e).next(o=>o?o.target:null))}function $h(n){const e=T(n);return e.persistence.runTransaction("Get new document changes","readonly",t=>function(r,s,i){const o=T(r);let a=Le(),c=to(i);const h=lt(s),l=IDBKeyRange.lowerBound(c,!0);return h.jt({index:Z.readTimeIndex,range:l},(d,m)=>{const p=eo(o.k,m);a=a.insert(p.key,p),c=m.readTime}).next(()=>({In:a,readTime:Eh(c)}))}(e.Qn,t,e.jn)).then(({In:t,readTime:r})=>(e.jn=r,t))}function fo(){return(fo=(0,g.Z)(function*(n){const e=T(n);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(r){const s=lt(r);let i=N.min();return s.jt({index:Z.readTimeIndex,reverse:!0},(o,a,c)=>{a.readTime&&(i=Eh(a.readTime)),c.done()}).next(()=>i)}(t)).then(t=>{e.jn=t})})).apply(this,arguments)}function mo(){return(mo=(0,g.Z)(function*(n,e,t,r){const s=T(n);let i=M(),o=Le(),a=Wc();for(const l of t){const d=e.Hn(l.metadata.name);l.document&&(i=i.add(d)),o=o.insert(d,e.Jn(l)),a=a.insert(d,e.Yn(l.metadata.readTime))}const c=s.Qn.newChangeBuffer({trackRemovals:!0}),h=yield mn(s,(l=r,Re(Xt(O.fromString(`__bundle__/docs/${l}`)))));var l;return s.persistence.runTransaction("Apply bundle documents","readwrite",l=>jh(l,c,o,N.min(),a).next(d=>(c.apply(l),d)).next(d=>s.He.removeMatchingKeysForTargetId(l,h.targetId).next(()=>s.He.addMatchingKeys(l,i,h.targetId)).next(()=>s.Wn.Vn(l,d)).next(()=>d)))})).apply(this,arguments)}function rg(n,e){return go.apply(this,arguments)}function go(){return(go=(0,g.Z)(function*(n,e,t=M()){const r=yield mn(n,Re(no(e.bundledQuery))),s=T(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=re(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ye.saveNamedQuery(i,e);const a=r.withResumeToken(ne.EMPTY_BYTE_STRING,o);return s.qn=s.qn.insert(a.targetId,a),s.He.updateTargetData(i,a).next(()=>s.He.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.He.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ye.saveNamedQuery(i,e))})})).apply(this,arguments)}class sg{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return y.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var r;return this.Xn.set(t.id,{id:(r=t).id,version:r.version,createTime:re(r.createTime)}),y.resolve()}getNamedQuery(e,t){return y.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,{name:(r=t).name,query:no(r.bundledQuery),readTime:re(r.readTime)}),y.resolve();var r}}class po{constructor(){this.ts=new j(se.es),this.ns=new j(se.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const r=new se(e,t);this.ts=this.ts.add(r),this.ns=this.ns.add(r)}rs(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.os(new se(e,t))}cs(e,t){e.forEach(r=>this.removeReference(r,t))}us(e){const t=new E(new O([])),r=new se(t,e),s=new se(t,e+1),i=[];return this.ns.forEachInRange([r,s],o=>{this.os(o),i.push(o.key)}),i}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new E(new O([])),r=new se(t,e),s=new se(t,e+1);let i=M();return this.ns.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new se(e,0),r=this.ts.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class se{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return E.comparator(e.key,t.key)||k(e.fs,t.fs)}static ss(e,t){return k(e.fs,t.fs)||E.comparator(e.key,t.key)}}class ig{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new j(se.es)}checkEmpty(e){return y.resolve(0===this.An.length)}addMutationBatch(e,t,r,s){const i=this.ds;this.ds++;const o=new Ji(i,t,r,s);this.An.push(o);for(const a of s)this.ws=this.ws.add(new se(a.key,i)),this.Jt.addToCollectionParentIndex(e,a.key.path.popLast());return y.resolve(o)}lookupMutationBatch(e,t){return y.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.gs(t+1),i=s<0?0:s;return y.resolve(this.An.length>i?this.An[i]:null)}getHighestUnacknowledgedBatchId(){return y.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return y.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new se(t,0),s=new se(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([r,s],o=>{const a=this._s(o.fs);i.push(a)}),y.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(k);return t.forEach(s=>{const i=new se(s,0),o=new se(s,Number.POSITIVE_INFINITY);this.ws.forEachInRange([i,o],a=>{r=r.add(a.fs)})}),y.resolve(this.ys(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;E.isDocumentKey(i)||(i=i.child(""));const o=new se(new E(i),0);let a=new j(k);return this.ws.forEachWhile(c=>{const h=c.key.path;return!!r.isPrefixOf(h)&&(h.length===s&&(a=a.add(c.fs)),!0)},o),y.resolve(this.ys(a))}ys(e){const t=[];return e.forEach(r=>{const s=this._s(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){A(0===this.ps(t.batchId,"removed")),this.An.shift();let r=this.ws;return y.forEach(t.mutations,s=>{const i=new se(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ws=r})}ee(e){}containsKey(e,t){const r=new se(t,0),s=this.ws.firstAfterOrEqual(r);return y.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return y.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class og{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new W(E.comparator),this.size=0}addEntry(e,t,r){const s=t.key,i=this.docs.get(s),o=i?i.size:0,a=this.Ts(t);return this.docs=this.docs.insert(s,{document:t.clone(),size:a,readTime:r}),this.size+=a-o,this.Jt.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return y.resolve(r?r.document.clone():V.newInvalidDocument(t))}getEntries(e,t){let r=Le();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.clone():V.newInvalidDocument(s))}),y.resolve(r)}getDocumentsMatchingQuery(e,t,r){let s=Le();const i=new E(t.path.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:c,readTime:h}}=o.getNext();if(!t.path.isPrefixOf(a.path))break;h.compareTo(r)<=0||tr(t,c)&&(s=s.insert(c.key,c.clone()))}return y.resolve(s)}Es(e,t){return y.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ag(this)}getSize(e){return y.resolve(this.size)}}class ag extends Fh{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.document.isValidDocument()?t.push(this.De.addEntry(e,s.document,this.getReadTime(r))):this.De.removeEntry(r)}),y.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class ug{constructor(e){this.persistence=e,this.Is=new fn(t=>Jn(t),ns),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.As=0,this.Rs=new po,this.targetCount=0,this.Ps=Rt.ie()}forEachTarget(e,t){return this.Is.forEach((r,s)=>t(s)),y.resolve()}getLastRemoteSnapshotVersion(e){return y.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return y.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.Ps.next(),y.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.As&&(this.As=t),y.resolve()}ce(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ps=new Rt(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ce(t),this.targetCount+=1,y.resolve()}updateTargetData(e,t){return this.ce(t),y.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,y.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Is.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Is.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),y.waitFor(i).next(()=>s)}getTargetCount(e){return y.resolve(this.targetCount)}getTargetData(e,t){const r=this.Is.get(t)||null;return y.resolve(r)}addMatchingKeys(e,t,r){return this.Rs.rs(t,r),y.resolve()}removeMatchingKeys(e,t,r){this.Rs.cs(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),y.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),y.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Rs.ls(t);return y.resolve(r)}containsKey(e,t){return y.resolve(this.Rs.containsKey(t))}}class cg{constructor(e,t){this.bs={},this.Be=new Ce(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new ug(this),this.Jt=new Vm,this.Je=new og(this.Jt,r=>this.referenceDelegate.vs(r)),this.k=new Th(t),this.Ye=new sg(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new ig(this.Jt,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,r){_("MemoryPersistence","Starting transaction:",e);const s=new hg(this.Be.next());return this.referenceDelegate.Vs(),r(s).next(i=>this.referenceDelegate.Ss(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ds(e,t){return y.or(Object.values(this.bs).map(r=>()=>r.containsKey(e,t)))}}class hg extends vh{constructor(e){super(),this.currentSequenceNumber=e}}class yo{constructor(e){this.persistence=e,this.Cs=new po,this.Ns=null}static ks(e){return new yo(e)}get xs(){if(this.Ns)return this.Ns;throw x()}addReference(e,t,r){return this.Cs.addReference(r,t),this.xs.delete(r.toString()),y.resolve()}removeReference(e,t,r){return this.Cs.removeReference(r,t),this.xs.add(r.toString()),y.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),y.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach(s=>this.xs.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.xs.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return y.forEach(this.xs,r=>{const s=E.fromPath(r);return this.$s(e,s).next(i=>{i||t.removeEntry(s)})}).next(()=>(this.Ns=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(r=>{r?this.xs.delete(t.toString()):this.xs.add(t.toString())})}vs(e){return 0}$s(e,t){return y.or([()=>y.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}function Kh(n,e){return`firestore_clients_${n}_${e}`}function Gh(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function vo(n,e){return`firestore_targets_${n}_${e}`}class _s{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Fs(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new v(s.error.code,s.error.message))),o?new _s(e,t,s.state,i):(G("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class fr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Fs(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new v(r.error.code,r.error.message))),i?new fr(e,r.state,s):(G("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ts{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Fs(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=ls();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Tc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ts(e,i):(G("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class wo{constructor(e,t){this.clientId=e,this.onlineState=t}static Fs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new wo(t.clientId,t.onlineState):(G("SharedClientState",`Failed to parse online state: ${e}`),null)}}class _o{constructor(){this.activeTargetIds=ls()}Ms(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class To{constructor(e,t,r,s,i){this.window=e,this.Oe=t,this.persistenceKey=r,this.Bs=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new W(k),this.started=!1,this.js=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=Kh(this.persistenceKey,this.Bs),this.Ws=`firestore_sequence_number_${this.persistenceKey}`,this.Ks=this.Ks.insert(this.Bs,new _o),this.Gs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Js=`firestore_online_state_${this.persistenceKey}`,this.Ys=function(a){return`firestore_bundle_loaded_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static bt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,g.Z)(function*(){const t=yield e.syncEngine.Tn();for(const s of t){if(s===e.Bs)continue;const i=e.getItem(Kh(e.persistenceKey,s));if(i){const o=Ts.Fs(s,i);o&&(e.Ks=e.Ks.insert(o.clientId,o))}}e.Xs();const r=e.storage.getItem(e.Js);if(r){const s=e.Zs(r);s&&e.ti(s)}for(const s of e.js)e.qs(s);e.js=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(e){let t=!1;return this.Ks.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ni(e,"pending")}updateMutationState(e,t,r){this.ni(e,t,r),this.si(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(vo(this.persistenceKey,e));if(r){const s=fr.Fs(e,r);s&&(t=s.state)}}return this.ii.Ms(e),this.Xs(),t}removeLocalQueryTarget(e){this.ii.Ls(e),this.Xs()}isLocalQueryTarget(e){return this.ii.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vo(this.persistenceKey,e))}updateQueryState(e,t,r){this.ri(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.si(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.oi(e)}notifyBundleLoaded(){this.ai()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return _("SharedClientState","READ",e,t),t}setItem(e,t){_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}qs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(_("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Qs)return void G("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,g.Z)(function*(){if(t.started){if(null!==r.key)if(t.Gs.test(r.key)){if(null==r.newValue){const s=t.ci(r.key);return t.ui(s,null)}{const s=t.hi(r.key,r.newValue);if(s)return t.ui(s.clientId,s)}}else if(t.zs.test(r.key)){if(null!==r.newValue){const s=t.li(r.key,r.newValue);if(s)return t.fi(s)}}else if(t.Hs.test(r.key)){if(null!==r.newValue){const s=t.di(r.key,r.newValue);if(s)return t.wi(s)}}else if(r.key===t.Js){if(null!==r.newValue){const s=t.Zs(r.newValue);if(s)return t.ti(s)}}else if(r.key===t.Ws){const s=function(i){let o=Ce.I;if(null!=i)try{const a=JSON.parse(i);A("number"==typeof a),o=a}catch(a){G("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==Ce.I&&t.sequenceNumberHandler(s)}else if(r.key===t.Ys)return t.syncEngine._i()}else t.js.push(r)}))}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Os())}ni(e,t,r){const s=new _s(this.currentUser,e,t,r),i=Gh(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Os())}si(e){const t=Gh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}oi(e){this.storage.setItem(this.Js,JSON.stringify({clientId:this.Bs,onlineState:e}))}ri(e,t,r){const s=vo(this.persistenceKey,e),i=new fr(e,t,r);this.setItem(s,i.Os())}ai(){this.setItem(this.Ys,"value-not-used")}ci(e){const t=this.Gs.exec(e);return t?t[1]:null}hi(e,t){const r=this.ci(e);return Ts.Fs(r,t)}li(e,t){const r=this.zs.exec(e),s=Number(r[1]);return _s.Fs(new ce(void 0!==r[2]?r[2]:null),s,t)}di(e,t){const r=this.Hs.exec(e),s=Number(r[1]);return fr.Fs(s,t)}Zs(e){return wo.Fs(e)}fi(e){var t=this;return(0,g.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.mi(e.batchId,e.state,e.error);_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}wi(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}ui(e,t){const r=t?this.Ks.insert(e,t):this.Ks.remove(e),s=this.ei(this.Ks),i=this.ei(r),o=[],a=[];return i.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{i.has(c)||a.push(c)}),this.syncEngine.yi(o,a).then(()=>{this.Ks=r})}ti(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ei(e){let t=ls();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Qh{constructor(){this.pi=new _o,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.pi.Ms(e),this.Ti[e]||"not-current"}updateQueryState(e,t,r){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new _o,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class lg{Ei(e){}shutdown(){}}class zh{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.Pi(),this.bi=[],this.vi()}Ei(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Pi(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const dg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class fg{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Fi(e){this.ki(e)}Oi(e){this.xi(e)}}class mg extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Mi=(e.ssl?"https":"http")+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,r,s,i){const o=this.Ui(e,t);_("RestConnection","Sending: ",o,r);const a={};return this.qi(a,s,i),this.Ki(e,o,a,r).then(c=>(_("RestConnection","Received: ",c),c),c=>{throw Qn("RestConnection",`${e} failed with error: `,c,"url: ",o,"request:",r),c})}ji(e,t,r,s,i){return this.Bi(e,t,r,s,i)}qi(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Qt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}Ui(e,t){return`${this.Mi}/v1/${t}:${dg[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,r,s){return new Promise((i,o)=>{const a=new Of;a.listenOnce(Rf.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Fi.NO_ERROR:const h=a.getResponseJson();_("Connection","XHR received:",JSON.stringify(h)),i(h);break;case Fi.TIMEOUT:_("Connection",'RPC "'+e+'" timed out'),o(new v(f.DEADLINE_EXCEEDED,"Request time out"));break;case Fi.HTTP_ERROR:const l=a.getStatus();if(_("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){const d=a.getResponseJson().error;if(d&&d.status&&d.message){const m=function(p){const w=p.toLowerCase().replace(/_/g,"-");return Object.values(f).indexOf(w)>=0?w:f.UNKNOWN}(d.status);o(new v(m,d.message))}else o(new v(f.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new v(f.UNAVAILABLE,"Connection failed."));break;default:x()}}finally{_("Connection",'RPC "'+e+'" completed.')}});const c=JSON.stringify(s);a.send(t,"POST",c,r,15)})}Qi(e,t,r){const s=[this.Mi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Df(),o=kf(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Ff({})),this.qi(a.initMessageHeaders,t,r),(0,F.uI)()||(0,F.b$)()||(0,F.d)()||(0,F.w1)()||(0,F.Mn)()||(0,F.ru)()||(a.httpHeadersOverwriteParam="$httpHeaders");const c=s.join("");_("Connection","Creating WebChannel: "+c,a);const h=i.createWebChannel(c,a);let l=!1,d=!1;const m=new fg({Vi:w=>{d?_("Connection","Not sending because WebChannel is closed:",w):(l||(_("Connection","Opening WebChannel transport."),h.open(),l=!0),_("Connection","WebChannel sending:",w),h.send(w))},Si:()=>h.close()}),p=(w,S,C)=>{w.listen(S,J=>{try{C(J)}catch(ye){setTimeout(()=>{throw ye},0)}})};return p(h,Jr.EventType.OPEN,()=>{d||_("Connection","WebChannel transport opened.")}),p(h,Jr.EventType.CLOSE,()=>{d||(d=!0,_("Connection","WebChannel transport closed"),m.Fi())}),p(h,Jr.EventType.ERROR,w=>{d||(d=!0,Qn("Connection","WebChannel transport errored:",w),m.Fi(new v(f.UNAVAILABLE,"The operation could not be completed")))}),p(h,Jr.EventType.MESSAGE,w=>{var S;if(!d){const C=w.data[0];A(!!C);const J=C,ye=J.error||(null===(S=J[0])||void 0===S?void 0:S.error);if(ye){_("Connection","WebChannel received error:",ye);const Xe=ye.status;let je=function($a){const Ps=H[$a];if(void 0!==Ps)return zc(Ps)}(Xe),Ze=ye.message;void 0===je&&(je=f.INTERNAL,Ze="Unknown error status: "+Xe+" with message "+ye.message),d=!0,m.Fi(new v(je,Ze)),h.close()}else _("Connection","WebChannel received:",C),m.Oi(C)}}),p(o,Lf.STAT_EVENT,w=>{w.stat===dc.PROXY?_("Connection","Detected buffering proxy"):w.stat===dc.NOPROXY&&_("Connection","Detected no buffering proxy")}),setTimeout(()=>{m.$i()},0),m}}function Hh(){return"undefined"!=typeof window?window:null}function Is(){return"undefined"!=typeof document?document:null}function mr(n){return new Tm(n,!0)}class Io{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Oe=e,this.timerId=t,this.Wi=r,this.Gi=s,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),r=Math.max(0,Date.now()-this.Yi),s=Math.max(0,t-r);s>0&&_("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,s,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class Wh{constructor(e,t,r,s,i,o,a,c){this.Oe=e,this.nr=r,this.sr=s,this.ir=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new Io(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}stop(){var e=this;return(0,g.Z)(function*(){e.hr()&&(yield e.close(0))})()}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.ar&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}mr(){var e=this;return(0,g.Z)(function*(){if(e.lr())return e.close(0)})()}yr(){this.ar&&(this.ar.cancel(),this.ar=null)}pr(){this.cr&&(this.cr.cancel(),this.cr=null)}close(e,t){var r=this;return(0,g.Z)(function*(){r.yr(),r.pr(),r.ur.cancel(),r.rr++,4!==e?r.ur.reset():t&&t.code===f.RESOURCE_EXHAUSTED?(G(t.toString()),G("Using maximum backoff delay to prevent overloading the backend."),r.ur.Xi()):t&&t.code===f.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Tr(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Ni(t)})()}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.rr===t&&this.Ir(r,s)},r=>{e(()=>{const s=new v(f.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Ar(s)})})}Ir(e,t){const r=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di(()=>{r(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(s=>{r(()=>this.Ar(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}dr(){var e=this;this.state=5,this.ur.Zi((0,g.Z)(function*(){e.state=0,e.start()}))}Ar(e){return _("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Oe.enqueueAndForget(()=>this.rr===e?t():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gg extends Wh{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:x(),s=e.targetChange.targetIds||[],i=function(c,h){return c.C?(A(void 0===h||"string"==typeof h),ne.fromBase64String(h||"")):(A(void 0===h||h instanceof Uint8Array),ne.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=void 0===c.code?f.UNKNOWN:zc(c.code);return new v(h,c.message||"")}(o);t=new Jc(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=qe(n,r.document.name),i=re(r.document.updateTime),o=new me({mapValue:{fields:r.document.fields}}),a=V.newFoundDocument(s,i,o);t=new ds(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=qe(n,r.document),i=r.readTime?re(r.readTime):N.min(),o=V.newNoDocument(s,i);t=new ds([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=qe(n,r.document);t=new ds([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return x();{const r=e.filter,i=new dm(r.count||0);t=new Yc(r.targetId,i)}}var c;return t}(this.k,e),r=function(s){if(!("targetChange"in s))return N.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?N.min():i.readTime?re(i.readTime):N.min()}(e);return this.listener.Pr(t,r)}br(e){const t={};t.database=cr(this.k),t.addTarget=function(s,i){let o;const a=i.target;return o=rs(a)?{documents:ch(s,a)}:{query:hh(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=nh(s,i.resumeToken):i.snapshotVersion.compareTo(N.min())>0&&(o.readTime=ar(s,i.snapshotVersion.toTimestamp())),o}(this.k,e);const r=function(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return x()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.gr(t)}vr(e){const t={};t.database=cr(this.k),t.removeTarget=e,this.gr(t)}}class pg extends Wh{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(A(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(n,e){return n&&n.length>0?(A(void 0!==e),n.map(t=>function(r,s){let i=re(r.updateTime?r.updateTime:s);return i.isEqual(N.min())&&(i=re(s)),new cm(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=re(e.commitTime);return this.listener.Cr(r,t)}return A(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=cr(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>fs(this.k,r))};this.gr(t)}}class yg extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=r,this.k=s,this.$r=!1}Fr(){if(this.$r)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,r){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.Bi(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(f.UNKNOWN,s.toString())})}ji(e,t,r){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.ir.ji(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===f.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(f.UNKNOWN,s.toString())})}terminate(){this.$r=!0}}class vg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}Br(){0===this.Or&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Mr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Or=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(G(t),this.Lr=!1):_("OnlineStateTracker",t)}jr(){null!==this.Mr&&(this.Mr.cancel(),this.Mr=null)}}class wg{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei(a=>{r.enqueueAndForget((0,g.Z)(function*(){var c;dt(o)&&(_("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,g.Z)(function*(h){const l=T(h);l.Gr.add(4),yield pn(l),l.Jr.set("Unknown"),l.Gr.delete(4),yield gr(l)}),function(h){return c.apply(this,arguments)})(o))}))}),this.Jr=new vg(r,s)}}function gr(n){return Eo.apply(this,arguments)}function Eo(){return(Eo=(0,g.Z)(function*(n){if(dt(n))for(const e of n.zr)yield e(!0)})).apply(this,arguments)}function pn(n){return xo.apply(this,arguments)}function xo(){return(xo=(0,g.Z)(function*(n){for(const e of n.zr)yield e(!1)})).apply(this,arguments)}function Es(n,e){const t=T(n);t.Wr.has(e.targetId)||(t.Wr.set(e.targetId,e),bo(t)?Ao(t):vn(t).lr()&&So(t,e))}function pr(n,e){const t=T(n),r=vn(t);t.Wr.delete(e),r.lr()&&Yh(t,e),0===t.Wr.size&&(r.lr()?r._r():dt(t)&&t.Jr.set("Unknown"))}function So(n,e){n.Yr.X(e.targetId),vn(n).br(e)}function Yh(n,e){n.Yr.X(e),vn(n).vr(e)}function Ao(n){n.Yr=new vm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Wr.get(e)||null}),vn(n).start(),n.Jr.Br()}function bo(n){return dt(n)&&!vn(n).hr()&&n.Wr.size>0}function dt(n){return 0===T(n).Gr.size}function Jh(n){n.Yr=void 0}function _g(n){return Co.apply(this,arguments)}function Co(){return(Co=(0,g.Z)(function*(n){n.Wr.forEach((e,t)=>{So(n,e)})})).apply(this,arguments)}function Tg(n,e){return No.apply(this,arguments)}function No(){return(No=(0,g.Z)(function*(n,e){Jh(n),bo(n)?(n.Jr.Kr(e),Ao(n)):n.Jr.set("Unknown")})).apply(this,arguments)}function Ig(n,e,t){return Do.apply(this,arguments)}function Do(){return(Do=(0,g.Z)(function*(n,e,t){if(n.Jr.set("Online"),e instanceof Jc&&2===e.state&&e.cause)try{yield(r=(0,g.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.Wr.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.Wr.delete(a),s.Yr.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield xs(n,r)}else if(e instanceof ds?n.Yr.ot(e):e instanceof Yc?n.Yr.dt(e):n.Yr.ut(e),!t.isEqual(N.min()))try{const r=yield Bh(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.Yr.gt(i);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){const h=s.Wr.get(c);h&&s.Wr.set(c,h.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const c=s.Wr.get(a);if(!c)return;s.Wr.set(a,c.withResumeToken(ne.EMPTY_BYTE_STRING,c.snapshotVersion)),Yh(s,a);const h=new ut(c.target,a,1,c.sequenceNumber);So(s,h)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){_("RemoteStore","Failed to raise snapshot:",r),yield xs(n,r)}var r})).apply(this,arguments)}function xs(n,e,t){return ko.apply(this,arguments)}function ko(){return(ko=(0,g.Z)(function*(n,e,t){if(!Dt(e))throw e;n.Gr.add(1),yield pn(n),n.Jr.set("Offline"),t||(t=()=>Bh(n.localStore)),n.asyncQueue.enqueueRetryable((0,g.Z)(function*(){_("RemoteStore","Retrying IndexedDB access"),yield t(),n.Gr.delete(1),yield gr(n)}))})).apply(this,arguments)}function Xh(n,e){return e().catch(t=>xs(n,t,e))}function yn(n){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,g.Z)(function*(n){const e=T(n),t=ft(e);let r=e.Qr.length>0?e.Qr[e.Qr.length-1].batchId:-1;for(;Eg(e);)try{const s=yield eg(e.localStore,r);if(null===s){0===e.Qr.length&&t._r();break}r=s.batchId,xg(e,s)}catch(s){yield xs(e,s)}el(e)&&tl(e)})).apply(this,arguments)}function Eg(n){return dt(n)&&n.Qr.length<10}function xg(n,e){n.Qr.push(e);const t=ft(n);t.lr()&&t.Sr&&t.Dr(e.mutations)}function el(n){return dt(n)&&!ft(n).hr()&&n.Qr.length>0}function tl(n){ft(n).start()}function Sg(n){return Lo.apply(this,arguments)}function Lo(){return(Lo=(0,g.Z)(function*(n){ft(n).kr()})).apply(this,arguments)}function Ag(n){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,g.Z)(function*(n){const e=ft(n);for(const t of n.Qr)e.Dr(t.mutations)})).apply(this,arguments)}function bg(n,e,t){return Oo.apply(this,arguments)}function Oo(){return(Oo=(0,g.Z)(function*(n,e,t){const r=n.Qr.shift(),s=Xi.from(r,e,t);yield Xh(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield yn(n)})).apply(this,arguments)}function Cg(n,e){return Mo.apply(this,arguments)}function Mo(){return(Mo=(0,g.Z)(function*(n,e){var t;e&&ft(n).Sr&&(yield(t=(0,g.Z)(function*(r,s){if(Qc(i=s.code)&&i!==f.ABORTED){const o=r.Qr.shift();ft(r).wr(),yield Xh(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield yn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),el(n)&&tl(n)})).apply(this,arguments)}function Po(n,e){return qo.apply(this,arguments)}function qo(){return(qo=(0,g.Z)(function*(n,e){const t=T(n);e?(t.Gr.delete(2),yield gr(t)):e||(t.Gr.add(2),yield pn(t),t.Jr.set("Unknown"))})).apply(this,arguments)}function vn(n){return n.Xr||(n.Xr=function(e,t,r){const s=T(e);return s.Fr(),new gg(t,s.ir,s.authCredentials,s.appCheckCredentials,s.k,r)}(n.datastore,n.asyncQueue,{Di:_g.bind(null,n),Ni:Tg.bind(null,n),Pr:Ig.bind(null,n)}),n.zr.push(function(){var e=(0,g.Z)(function*(t){t?(n.Xr.wr(),bo(n)?Ao(n):n.Jr.set("Unknown")):(yield n.Xr.stop(),Jh(n))});return function(t){return e.apply(this,arguments)}}())),n.Xr}function ft(n){return n.Zr||(n.Zr=function(e,t,r){const s=T(e);return s.Fr(),new pg(t,s.ir,s.authCredentials,s.appCheckCredentials,s.k,r)}(n.datastore,n.asyncQueue,{Di:Sg.bind(null,n),Ni:Cg.bind(null,n),Nr:Ag.bind(null,n),Cr:bg.bind(null,n)}),n.zr.push(function(){var e=(0,g.Z)(function*(t){t?(n.Zr.wr(),yield yn(n)):(yield n.Zr.stop(),n.Qr.length>0&&(_("RemoteStore",`Stopping write stream with ${n.Qr.length} pending writes`),n.Qr=[]))});return function(t){return e.apply(this,arguments)}}())),n.Zr}class Uo{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new ee,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Uo(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new v(f.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wn(n,e){if(G("AsyncQueue",`${e}: ${n}`),Dt(n))return new v(f.UNAVAILABLE,`${e}: ${n}`);throw n}class _n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||E.comparator(t.key,r.key):(t,r)=>E.comparator(t.key,r.key),this.keyedMap=zi(),this.sortedSet=new W(this.comparator)}static emptySet(e){return new _n(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _n)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new _n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class nl{constructor(){this.eo=new W(E.comparator)}track(e){const t=e.doc.key,r=this.eo.get(t);r?0!==e.type&&3===r.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==r.type?this.eo=this.eo.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.eo=this.eo.remove(t):1===e.type&&2===r.type?this.eo=this.eo.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):x():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal((t,r)=>{e.push(r)}),e}}class Tn{constructor(e,t,r,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c}static fromInitialDocuments(e,t,r,s){const i=[];return t.forEach(o=>{i.push({type:0,doc:o})}),new Tn(e,t,_n.emptySet(t),i,r,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&er(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Ng{constructor(){this.so=void 0,this.listeners=[]}}class Dg{constructor(){this.queries=new fn(e=>Rc(e),er),this.onlineState="Unknown",this.io=new Set}}function Vo(n,e){return Bo.apply(this,arguments)}function Bo(){return(Bo=(0,g.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new Ng),s)try{i.so=yield t.onListen(r)}catch(o){const a=wn(o,`Initialization of query '${Ki(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.ro(t.onlineState),i.so&&e.oo(i.so)&&$o(t)})).apply(this,arguments)}function jo(n,e){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,g.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)})).apply(this,arguments)}function kg(n,e){const t=T(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.oo(s)&&(r=!0);o.so=s}}r&&$o(t)}function Rg(n,e,t){const r=T(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function $o(n){n.io.forEach(e=>{e.next()})}class Ko{constructor(e,t,r){this.query=e,this.ao=t,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=r||{}}oo(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new Tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.co?this.ho(e)&&(this.ao.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.ao.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.co&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){return!e.fromCache||!(this.options.wo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}ho(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}fo(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.ao.next(e)}}class Lg{constructor(e,t){this.payload=e,this.byteLength=t}_o(){return"metadata"in this.payload}}class rl{constructor(e){this.k=e}Hn(e){return qe(this.k,e)}Jn(e){return e.metadata.exists?ah(this.k,e.document,!1):V.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}Yn(e){return re(e)}}class Fg{constructor(e,t,r){this.mo=e,this.localStore=t,this.k=r,this.queries=[],this.documents=[],this.progress=sl(e)}yo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}po(e){const t=new Map,r=new rl(this.k);for(const s of e)if(s.metadata.queries){const i=r.Hn(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||M()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,g.Z)(function*(){const t=yield function(n,e,t,r){return mo.apply(this,arguments)}(e.localStore,new rl(e.k),e.documents,e.mo.id),r=e.po(e.documents);for(const s of e.queries)yield rg(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",new Wm(Object.assign({},e.progress),t)})()}}function sl(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class il{constructor(e){this.key=e}}class ol{constructor(e){this.key=e}}class al{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=M(),this.mutatedKeys=M(),this.Ao=Lc(e),this.Ro=new _n(this.Ao)}get Po(){return this.To}bo(e,t){const r=t?t.vo:new nl,s=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=is(this.query)&&s.size===this.query.limit?s.last():null,h=os(this.query)&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,d)=>{const m=s.get(l),p=tr(this.query,d)?d:null,w=!!m&&this.mutatedKeys.has(m.key),S=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let C=!1;m&&p?m.data.isEqual(p.data)?w!==S&&(r.track({type:3,doc:p}),C=!0):this.Vo(m,p)||(r.track({type:2,doc:p}),C=!0,(c&&this.Ao(p,c)>0||h&&this.Ao(p,h)<0)&&(a=!0)):!m&&p?(r.track({type:0,doc:p}),C=!0):m&&!p&&(r.track({type:1,doc:m}),C=!0,(c||h)&&(a=!0)),C&&(p?(o=o.add(p),i=S?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),is(this.query)||os(this.query))for(;o.size>this.query.limit;){const l=is(this.query)?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Ro:o,vo:r,Bn:a,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort((h,l)=>function(d,m){const p=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x()}};return p(d)-p(m)}(h.type,l.type)||this.Ao(h.doc,l.doc)),this.So(r);const o=t?this.Do():[],a=0===this.Io.size&&this.current?1:0,c=a!==this.Eo;return this.Eo=a,0!==i.length||c?{snapshot:new Tn(this.query,e.Ro,s,i,e.mutatedKeys,0===a,c,!1),Co:o}:{Co:o}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new nl,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(t=>this.To=this.To.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.To=this.To.delete(t)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=M(),this.Ro.forEach(r=>{this.No(r.key)&&(this.Io=this.Io.add(r.key))});const t=[];return e.forEach(r=>{this.Io.has(r)||t.push(new ol(r))}),this.Io.forEach(r=>{e.has(r)||t.push(new il(r))}),t}ko(e){this.To=e.zn,this.Io=M();const t=this.bo(e.documents);return this.applyChanges(t,!0)}xo(){return Tn.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class Og{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Mg{constructor(e){this.key=e,this.$o=!1}}class Pg{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Fo={},this.Oo=new fn(a=>Rc(a),er),this.Mo=new Map,this.Lo=new Set,this.Bo=new W(E.comparator),this.Uo=new Map,this.qo=new po,this.Ko={},this.jo=new Map,this.Qo=Rt.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}function qg(n,e){return Go.apply(this,arguments)}function Go(){return(Go=(0,g.Z)(function*(n,e){const t=ga(n);let r,s;const i=t.Oo.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.xo();else{const o=yield mn(t.localStore,Re(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield Qo(t,e,r,"current"===a),t.isPrimaryClient&&Es(t.remoteStore,o)}return s})).apply(this,arguments)}function Qo(n,e,t,r){return zo.apply(this,arguments)}function zo(){return(zo=(0,g.Z)(function*(n,e,t,r){n.Go=(l,d,m)=>{return(p=(0,g.Z)(function*(w,S,C,J){let ye=S.view.bo(C);ye.Bn&&(ye=yield ws(w.localStore,S.query,!1).then(({documents:Ze})=>S.view.bo(Ze,ye)));const Xe=J&&J.targetChanges.get(S.targetId),je=S.view.applyChanges(ye,w.isPrimaryClient,Xe);return sa(w,S.targetId,je.Co),je.snapshot}),function(w,S,C,J){return p.apply(this,arguments)})(n,l,d,m);var p};const s=yield ws(n.localStore,e,!0),i=new al(e,s.zn),o=i.bo(s.documents),a=or.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=i.applyChanges(o,n.isPrimaryClient,a);sa(n,t,c.Co);const h=new Og(e,t,i);return n.Oo.set(e,h),n.Mo.has(t)?n.Mo.get(t).push(e):n.Mo.set(t,[e]),c.snapshot})).apply(this,arguments)}function Ug(n,e){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,g.Z)(function*(n,e){const t=T(n),r=t.Oo.get(e),s=t.Mo.get(r.targetId);if(s.length>1)return t.Mo.set(r.targetId,s.filter(i=>!er(i,e))),void t.Oo.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield gn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),pr(t.remoteStore,r.targetId),In(t,r.targetId)}).catch(Lt))):(In(t,r.targetId),yield gn(t.localStore,r.targetId,!0))})).apply(this,arguments)}function Wo(){return(Wo=(0,g.Z)(function*(n,e,t){const r=pa(n);try{const s=yield function(i,o){const a=T(i),c=te.now(),h=o.reduce((d,m)=>d.add(m.key),M());let l;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>a.Wn.vn(d,h).next(m=>{l=m;const p=[];for(const w of o){const S=lm(w,l.get(w.key));null!=S&&p.push(new ot(w.key,S,Sc(S.value.mapValue),z.exists(!0)))}return a.An.addMutationBatch(d,c,p,o)})).then(d=>(d.applyToLocalDocumentSet(l),{batchId:d.batchId,changes:l}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let c=i.Ko[i.currentUser.toKey()];c||(c=new W(k)),c=c.insert(o,a),i.Ko[i.currentUser.toKey()]=c}(r,s.batchId,t),yield We(r,s.changes),yield yn(r.remoteStore)}catch(s){const i=wn(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function ul(n,e){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,g.Z)(function*(n,e){const t=T(n);try{const r=yield Xm(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Uo.get(i);o&&(A(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.$o=!0:s.modifiedDocuments.size>0?A(o.$o):s.removedDocuments.size>0&&(A(o.$o),o.$o=!1))}),yield We(t,r,e)}catch(r){yield Lt(r)}})).apply(this,arguments)}function cl(n,e,t){const r=T(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.Oo.forEach((i,o)=>{const a=o.view.ro(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=T(i);a.onlineState=o;let c=!1;a.queries.forEach((h,l)=>{for(const d of l.listeners)d.ro(o)&&(c=!0)}),c&&$o(a)}(r.eventManager,e),s.length&&r.Fo.Pr(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Bg(n,e,t){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,g.Z)(function*(n,e,t){const r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Uo.get(e),i=s&&s.key;if(i){let o=new W(E.comparator);o=o.insert(i,V.newNoDocument(i,N.min()));const a=M().add(i),c=new ir(N.min(),new Map,new j(k),o,a);yield ul(r,c),r.Bo=r.Bo.remove(i),r.Uo.delete(e),ia(r)}else yield gn(r.localStore,e,!1).then(()=>In(r,e,t)).catch(Lt)})).apply(this,arguments)}function jg(n,e){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,g.Z)(function*(n,e){const t=T(n),r=e.batch.batchId;try{const s=yield Jm(t.localStore,e);ra(t,r,null),na(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield We(t,s)}catch(s){yield Lt(s)}})).apply(this,arguments)}function Zg(n,e,t){return ea.apply(this,arguments)}function ea(){return(ea=(0,g.Z)(function*(n,e,t){const r=T(n);try{const s=yield function(i,o){const a=T(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return a.An.lookupMutationBatch(c,o).next(l=>(A(null!==l),h=l.keys(),a.An.removeMutationBatch(c,l))).next(()=>a.An.performConsistencyCheck(c)).next(()=>a.Wn.vn(c,h))})}(r.localStore,e);ra(r,e,t),na(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield We(r,s)}catch(s){yield Lt(s)}})).apply(this,arguments)}function ta(){return(ta=(0,g.Z)(function*(n,e){const t=T(n);dt(t.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=T(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.An.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.jo.get(r)||[];s.push(e),t.jo.set(r,s)}catch(r){const s=wn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}})).apply(this,arguments)}function na(n,e){(n.jo.get(e)||[]).forEach(t=>{t.resolve()}),n.jo.delete(e)}function ra(n,e,t){const r=T(n);let s=r.Ko[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ko[r.currentUser.toKey()]=s}}function In(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Mo.get(e))n.Oo.delete(r),t&&n.Fo.zo(r,t);n.Mo.delete(e),n.isPrimaryClient&&n.qo.us(e).forEach(r=>{n.qo.containsKey(r)||hl(n,r)})}function hl(n,e){n.Lo.delete(e.path.canonicalString());const t=n.Bo.get(e);null!==t&&(pr(n.remoteStore,t),n.Bo=n.Bo.remove(e),n.Uo.delete(t),ia(n))}function sa(n,e,t){for(const r of t)r instanceof il?(n.qo.addReference(r.key,e),Kg(n,r)):r instanceof ol?(_("SyncEngine","Document no longer in limbo: "+r.key),n.qo.removeReference(r.key,e),n.qo.containsKey(r.key)||hl(n,r.key)):x()}function Kg(n,e){const t=e.key,r=t.path.canonicalString();n.Bo.get(t)||n.Lo.has(r)||(_("SyncEngine","New document in limbo: "+t),n.Lo.add(r),ia(n))}function ia(n){for(;n.Lo.size>0&&n.Bo.size<n.maxConcurrentLimboResolutions;){const e=n.Lo.values().next().value;n.Lo.delete(e);const t=new E(O.fromString(e)),r=n.Qo.next();n.Uo.set(r,new Mg(t)),n.Bo=n.Bo.insert(t,r),Es(n.remoteStore,new ut(Re(Xt(t.path)),r,2,Ce.I))}}function We(n,e,t){return oa.apply(this,arguments)}function oa(){return(oa=(0,g.Z)(function*(n,e,t){const r=T(n),s=[],i=[],o=[];var a;r.Oo.isEmpty()||(r.Oo.forEach((a,c)=>{o.push(r.Go(c,e,t).then(h=>{if(h){r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,h.fromCache?"not-current":"current"),s.push(h);const l=co.$n(c.targetId,h);i.push(l)}}))}),yield Promise.all(o),r.Fo.Pr(s),yield(a=(0,g.Z)(function*(c,h){const l=T(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>y.forEach(h,m=>y.forEach(m.kn,p=>l.persistence.referenceDelegate.addReference(d,m.targetId,p)).next(()=>y.forEach(m.xn,p=>l.persistence.referenceDelegate.removeReference(d,m.targetId,p)))))}catch(d){if(!Dt(d))throw d;_("LocalStore","Failed to update sequence numbers: "+d)}for(const d of h){const m=d.targetId;if(!d.fromCache){const p=l.qn.get(m),S=p.withLastLimboFreeSnapshotVersion(p.snapshotVersion);l.qn=l.qn.insert(m,S)}}}),function(c,h){return a.apply(this,arguments)})(r.localStore,i))})).apply(this,arguments)}function Gg(n,e){return aa.apply(this,arguments)}function aa(){return(aa=(0,g.Z)(function*(n,e){const t=T(n);if(!t.currentUser.isEqual(e)){_("SyncEngine","User change. New user:",e.toKey());const r=yield Vh(t.localStore,e);t.currentUser=e,(s=t).jo.forEach(o=>{o.forEach(a=>{a.reject(new v(f.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.jo.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield We(t,r.Gn)}var s})).apply(this,arguments)}function Qg(n,e){const t=T(n),r=t.Uo.get(e);if(r&&r.$o)return M().add(r.key);{let s=M();const i=t.Mo.get(e);if(!i)return s;for(const o of i){const a=t.Oo.get(o);s=s.unionWith(a.view.Po)}return s}}function zg(n,e){return ua.apply(this,arguments)}function ua(){return(ua=(0,g.Z)(function*(n,e){const t=T(n),r=yield ws(t.localStore,e.query,!0),s=e.view.ko(r);return t.isPrimaryClient&&sa(t,e.targetId,s.Co),s})).apply(this,arguments)}function Hg(n){return ca.apply(this,arguments)}function ca(){return(ca=(0,g.Z)(function*(n){const e=T(n);return $h(e.localStore).then(t=>We(e,t))})).apply(this,arguments)}function Wg(n,e,t,r){return ha.apply(this,arguments)}function ha(){return(ha=(0,g.Z)(function*(n,e,t,r){const s=T(n),i=yield function(o,a){const c=T(o),h=T(c.An);return c.persistence.runTransaction("Lookup mutation documents","readonly",l=>h.Zt(l,a).next(d=>d?c.Wn.vn(l,d):y.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield yn(s.remoteStore):"acknowledged"===t||"rejected"===t?(ra(s,e,r||null),na(s,e),a=e,T(T(s.localStore).An).ee(a)):x(),yield We(s,i)):_("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function la(){return(la=(0,g.Z)(function*(n,e){const t=T(n);if(ga(t),pa(t),!0===e&&!0!==t.Wo){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield ll(t,r.toArray());t.Wo=!0,yield Po(t.remoteStore,!0);for(const i of s)Es(t.remoteStore,i)}else if(!1===e&&!1!==t.Wo){const r=[];let s=Promise.resolve();t.Mo.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(In(t,o),gn(t.localStore,o,!0))),pr(t.remoteStore,o)}),yield s,yield ll(t,r),function(i){const o=T(i);o.Uo.forEach((a,c)=>{pr(o.remoteStore,c)}),o.qo.hs(),o.Uo=new Map,o.Bo=new W(E.comparator)}(t),t.Wo=!1,yield Po(t.remoteStore,!1)}})).apply(this,arguments)}function ll(n,e,t){return da.apply(this,arguments)}function da(){return(da=(0,g.Z)(function*(n,e,t){const r=T(n),s=[],i=[];for(const o of e){let a;const c=r.Mo.get(o);if(c&&0!==c.length){a=yield mn(r.localStore,Re(c[0]));for(const h of c){const l=r.Oo.get(h),d=yield zg(r,l);d.snapshot&&i.push(d.snapshot)}}else{const h=yield Zh(r.localStore,o);a=yield mn(r.localStore,h),yield Qo(r,dl(h),o,!1)}s.push(a)}return r.Fo.Pr(i),s})).apply(this,arguments)}function dl(n){return Dc(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Jg(n){const e=T(n);return T(T(e.localStore).persistence).Tn()}function Xg(n,e,t,r){return fa.apply(this,arguments)}function fa(){return(fa=(0,g.Z)(function*(n,e,t,r){const s=T(n);if(s.Wo)_("SyncEngine","Ignoring unexpected query state notification.");else if(s.Mo.has(e))switch(t){case"current":case"not-current":{const i=yield $h(s.localStore),o=ir.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield We(s,i,o);break}case"rejected":yield gn(s.localStore,e,!0),In(s,e,r);break;default:x()}})).apply(this,arguments)}function ep(n,e,t){return ma.apply(this,arguments)}function ma(){return(ma=(0,g.Z)(function*(n,e,t){const r=ga(n);if(r.Wo){for(const s of e){if(r.Mo.has(s)){_("SyncEngine","Adding an already active target "+s);continue}const i=yield Zh(r.localStore,s),o=yield mn(r.localStore,i);yield Qo(r,dl(i),o.targetId,!1),Es(r.remoteStore,o)}for(const s of t)r.Mo.has(s)&&(yield gn(r.localStore,s,!1).then(()=>{pr(r.remoteStore,s),In(r,s)}).catch(Lt))}})).apply(this,arguments)}function ga(n){const e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ul.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Bg.bind(null,e),e.Fo.Pr=kg.bind(null,e.eventManager),e.Fo.zo=Rg.bind(null,e.eventManager),e}function pa(n){const e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=jg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Zg.bind(null,e),e}class fl{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,g.Z)(function*(){t.k=mr(e.databaseInfo.databaseId),t.sharedClientState=t.Jo(e),t.persistence=t.Yo(e),yield t.persistence.start(),t.gcScheduler=t.Xo(e),t.localStore=t.Zo(e)})()}Xo(e){return null}Zo(e){return Uh(this.persistence,new qh,e.initialUser,this.k)}Yo(e){return new cg(yo.ks,this.k)}Jo(e){return new Qh}terminate(){var e=this;return(0,g.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class ml extends fl{constructor(e,t,r){super(),this.ta=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e),yield function(n){return fo.apply(this,arguments)}(r.localStore),yield r.ta.initialize(r,e),yield pa(r.ta.syncEngine),yield yn(r.ta.remoteStore),yield r.persistence.sn(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()))})()}Zo(e){return Uh(this.persistence,new qh,e.initialUser,this.k)}Xo(e){return new $m(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Yo(e){const t=uo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ae.withCacheSize(this.cacheSizeBytes):Ae.DEFAULT;return new ao(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Hh(),Is(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(e){return new Qh}}class np extends ml{constructor(e,t){super(e,t,!1),this.ta=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e);const s=r.ta.syncEngine;r.sharedClientState instanceof To&&(r.sharedClientState.syncEngine={mi:Wg.bind(null,s),gi:Xg.bind(null,s),yi:ep.bind(null,s),Tn:Jg.bind(null,s),_i:Hg.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.sn(function(){var i=(0,g.Z)(function*(o){yield function(n,e){return la.apply(this,arguments)}(r.ta.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start(r.localStore):o||r.gcScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}Jo(e){const t=Hh();if(!To.bt(t))throw new v(f.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=uo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new To(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ya{initialize(e,t){var r=this;return(0,g.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>cl(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=Gg.bind(null,r.syncEngine),yield Po(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Dg}createDatastore(e){const t=mr(e.databaseInfo.databaseId),r=new mg(e.databaseInfo);return new yg(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>cl(this.syncEngine,a,0),o=zh.bt()?new zh:new lg,new wg(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,c,h){const l=new Pg(r,s,i,o,a,c);return h&&(l.Wo=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,g.Z)(function*(t){const r=T(t);_("RemoteStore","RemoteStore shutting down."),r.Gr.add(5),yield pn(r),r.Hr.shutdown(),r.Jr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function gl(n,e=10240){let t=0;return{read:()=>(0,g.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,g.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Ss{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ea(this.observer.next,e)}error(e){this.observer.error?this.ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}na(){this.muted=!0}ea(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class rp{constructor(e,t){this.sa=e,this.k=t,this.metadata=new ee,this.buffer=new Uint8Array,this.ia=new TextDecoder("utf-8"),this.ra().then(r=>{r&&r._o()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.sa.cancel()}getMetadata(){var e=this;return(0,g.Z)(function*(){return e.metadata.promise})()}Ho(){var e=this;return(0,g.Z)(function*(){return yield e.getMetadata(),e.ra()})()}ra(){var e=this;return(0,g.Z)(function*(){const t=yield e.oa();if(null===t)return null;const r=e.ia.decode(t),s=Number(r);isNaN(s)&&e.aa(`length string (${r}) is not valid number`);const i=yield e.ca(s);return new Lg(JSON.parse(i),t.length+s)})()}ua(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}oa(){var e=this;return(0,g.Z)(function*(){for(;e.ua()<0&&!(yield e.ha()););if(0===e.buffer.length)return null;const t=e.ua();t<0&&e.aa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}ca(e){var t=this;return(0,g.Z)(function*(){for(;t.buffer.length<e;)(yield t.ha())&&t.aa("Reached the end of bundle when more is expected.");const r=t.ia.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}aa(e){throw this.sa.cancel(),new Error(`Invalid bundle format: ${e}`)}ha(){var e=this;return(0,g.Z)(function*(){const t=yield e.sa.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class sp{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,g.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new v(f.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,g.Z)(function*(i,o){const a=T(i),c=cr(a.k)+"/documents",h={documents:o.map(p=>ur(a.k,p))},l=yield a.ji("BatchGetDocuments",c,h),d=new Map;l.forEach(p=>{const w=function(n,e){return"found"in e?function(t,r){A(!!r.found);const s=qe(t,r.found.name),i=re(r.found.updateTime),o=new me({mapValue:{fields:r.found.fields}});return V.newFoundDocument(s,i,o)}(n,e):"missing"in e?function(t,r){A(!!r.missing),A(!!r.readTime);const s=qe(t,r.missing),i=re(r.readTime);return V.newNoDocument(s,i)}(n,e):x()}(a.k,p);d.set(w.key.toString(),w)});const m=[];return o.forEach(p=>{const w=d.get(p.toString());A(!!w),m.push(w)}),m}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new sr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,g.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=E.fromPath(s);e.mutations.push(new Qi(i,e.precondition(i)))}),yield(r=(0,g.Z)(function*(s,i){const o=T(s),a=cr(o.k)+"/documents",c={writes:i.map(h=>fs(o.k,h))};yield o.Bi("Commit",a,c)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw x();t=N.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new v(f.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?z.updateTime(t):z.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(N.min()))throw new v(f.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return z.updateTime(t)}return z.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ip{constructor(e,t,r,s){this.asyncQueue=e,this.datastore=t,this.updateFunction=r,this.deferred=s,this.la=5,this.ur=new Io(this.asyncQueue,"transaction_retry")}run(){this.la-=1,this.fa()}fa(){var e=this;this.ur.Zi((0,g.Z)(function*(){const t=new sp(e.datastore),r=e.da(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.wa(i)}))}).catch(s=>{e.wa(s)})}))}da(e){try{const t=this.updateFunction(e);return!St(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}wa(e){this.la>0&&this._a(e)?(this.la-=1,this.asyncQueue.enqueueAndForget(()=>(this.fa(),Promise.resolve()))):this.deferred.reject(e)}_a(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!Qc(t)}return!1}}class op{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ce.UNAUTHENTICATED,this.clientId=pc.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,g.Z)(function*(a){_("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,()=>Promise.resolve())}getConfiguration(){var e=this;return(0,g.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ee;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=wn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function pl(n,e){return va.apply(this,arguments)}function va(){return(va=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,g.Z)(function*(i){r.isEqual(i)||(yield Vh(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e})).apply(this,arguments)}function yl(n,e){return wa.apply(this,arguments)}function wa(){return(wa=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield _a(n);_("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>{return(i=(0,g.Z)(function*(o,a){const c=T(o);c.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");const h=dt(c);c.Gr.add(3),yield pn(c),h&&c.Jr.set("Unknown"),yield c.remoteSyncer.handleCredentialChange(a),c.Gr.delete(3),yield gr(c)}),function(o,a){return i.apply(this,arguments)})(e.remoteStore,s);var i}),n.onlineComponents=e})).apply(this,arguments)}function _a(n){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,g.Z)(function*(n){return n.offlineComponents||(_("FirestoreClient","Using default OfflineComponentProvider"),yield pl(n,new fl)),n.offlineComponents})).apply(this,arguments)}function As(n){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,g.Z)(function*(n){return n.onlineComponents||(_("FirestoreClient","Using default OnlineComponentProvider"),yield yl(n,new ya)),n.onlineComponents})).apply(this,arguments)}function vl(n){return _a(n).then(e=>e.persistence)}function Ea(n){return _a(n).then(e=>e.localStore)}function wl(n){return As(n).then(e=>e.remoteStore)}function xa(n){return As(n).then(e=>e.syncEngine)}function En(n){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,g.Z)(function*(n){const e=yield As(n),t=e.eventManager;return t.onListen=qg.bind(null,e.syncEngine),t.onUnlisten=Ug.bind(null,e.syncEngine),t})).apply(this,arguments)}function _l(n,e,t={}){const r=new ee;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,i,o,a,c){const h=new Ss({next:d=>{i.enqueueAndForget(()=>jo(s,l));const m=d.docs.has(o);!m&&d.fromCache?c.reject(new v(f.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&a&&"server"===a.source?c.reject(new v(f.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),l=new Ko(Xt(o.path),h,{includeMetadataChanges:!0,wo:!0});return Vo(s,l)}(yield En(n),n.asyncQueue,e,t,r)})),r.promise}function Tl(n,e,t={}){const r=new ee;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,i,o,a,c){const h=new Ss({next:d=>{i.enqueueAndForget(()=>jo(s,l)),d.fromCache&&"server"===a.source?c.reject(new v(f.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),l=new Ko(o,h,{includeMetadataChanges:!0,wo:!0});return Vo(s,l)}(yield En(n),n.asyncQueue,e,t,r)})),r.promise}class gp{constructor(e,t,r,s,i,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}}class xn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof xn&&e.projectId===this.projectId&&e.database===this.database}}const Il=new Map;function Aa(n,e,t){if(!t)throw new v(f.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function El(n,e,t,r){if(!0===e&&!0===r)throw new v(f.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xl(n){if(!E.isDocumentKey(n))throw new v(f.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Sl(n){if(E.isDocumentKey(n))throw new v(f.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bs(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":x()}function L(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new v(f.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bs(n);throw new v(f.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Al(n,e){if(e<=0)throw new v(f.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class bl{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new v(f.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new v(f.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,El("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class yr{constructor(e,t,r){this._authCredentials=t,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bl({}),this._settingsFrozen=!1,e instanceof xn?this._databaseId=e:(this._app=e,this._databaseId=function(s){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new v(f.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xn(s.options.projectId)}(e))}get app(){if(!this._app)throw new v(f.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new v(f.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bl(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new qf;switch(t.type){case"gapi":const r=t.client;return A(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new jf(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new v(f.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Il.get(e);t&&(_("ComponentProvider","Removing Datastore"),Il.delete(e),t.terminate())}(this),Promise.resolve()}}class q{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ve(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new q(this.firestore,e,this._key)}}class pe{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new pe(this.firestore,e,this._query)}}class Ve extends pe{constructor(e,t,r){super(e,t,Xt(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new q(this.firestore,null,new E(e))}withConverter(e){return new Ve(this.firestore,e,this._path)}}function Cl(n,e,...t){if(n=(0,F.m9)(n),Aa("collection","path",e),n instanceof yr){const r=O.fromString(e,...t);return Sl(r),new Ve(n,null,r)}{if(!(n instanceof q||n instanceof Ve))throw new v(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(O.fromString(e,...t));return Sl(r),new Ve(n.firestore,null,r)}}function Cs(n,e,...t){if(n=(0,F.m9)(n),1===arguments.length&&(e=pc.A()),Aa("doc","path",e),n instanceof yr){const r=O.fromString(e,...t);return xl(r),new q(n,null,new E(r))}{if(!(n instanceof q||n instanceof Ve))throw new v(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(O.fromString(e,...t));return xl(r),new q(n.firestore,n instanceof Ve?n.converter:null,new E(r))}}function Nl(n,e){return n=(0,F.m9)(n),e=(0,F.m9)(e),(n instanceof q||n instanceof Ve)&&(e instanceof q||e instanceof Ve)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Dl(n,e){return n=(0,F.m9)(n),e=(0,F.m9)(e),n instanceof pe&&e instanceof pe&&n.firestore===e.firestore&&er(n._query,e._query)&&n.converter===e.converter}class vp{constructor(){this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new Io(this,"async_queue_retry"),this.Ra=()=>{const t=Is();t&&_("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ur.er()};const e=Is();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ra)}get isShuttingDown(){return this.ya}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pa(),this.ba(e)}enterRestrictedMode(e){if(!this.ya){this.ya=!0,this.Ia=e||!1;const t=Is();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ra)}}enqueue(e){if(this.Pa(),this.ya)return new Promise(()=>{});const t=new ee;return this.ba(()=>this.ya&&this.Ia?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ga.push(e),this.va()))}va(){var e=this;return(0,g.Z)(function*(){if(0!==e.ga.length){try{yield e.ga[0](),e.ga.shift(),e.ur.reset()}catch(t){if(!Dt(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}e.ga.length>0&&e.ur.Zi(()=>e.va())}})()}ba(e){const t=this.ma.then(()=>(this.Ea=!0,e().catch(r=>{throw this.Ta=r,this.Ea=!1,G("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Ea=!1,r))));return this.ma=t,t}enqueueAfterDelay(e,t,r){this.Pa(),this.Aa.indexOf(e)>-1&&(t=0);const s=Uo.createAndSchedule(this,e,t,r,i=>this.Va(i));return this.pa.push(s),s}Pa(){this.Ta&&x()}verifyOperationInProgress(){}Sa(){var e=this;return(0,g.Z)(function*(){let t;do{t=e.ma,yield t}while(t!==e.ma)})()}Da(e){for(const t of this.pa)if(t.timerId===e)return!0;return!1}Ca(e){return this.Sa().then(()=>{this.pa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.pa)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Sa()})}Na(e){this.Aa.push(e)}Va(e){const t=this.pa.indexOf(e);this.pa.splice(t,1)}}function ba(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class wp{constructor(){this._progressObserver={},this._taskCompletionResolver=new ee,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class B extends yr{constructor(e,t,r){super(e,t,r),this.type="firestore",this._queue=new vp,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||kl(this),this._firestoreClient.terminate()}}function Y(n){return n._firestoreClient||kl(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function kl(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new gp(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new op(n._authCredentials,n._appCheckCredentials,n._queue,r)}function Rl(n,e,t){const r=new ee;return n.asyncQueue.enqueue((0,g.Z)(function*(){try{yield pl(n,t),yield yl(n,e),r.resolve()}catch(s){if(!("FirebaseError"===(i=s).name?i.code===f.FAILED_PRECONDITION||i.code===f.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw s;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var i})).then(()=>r.promise)}function Ll(n){if(n._initialized||n._terminated)throw new v(f.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ye{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new v(f.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new he(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Be{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Be(ne.fromBase64String(e))}catch(t){throw new v(f.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Be(ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ft{constructor(e){this._methodName=e}}class Ns{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new v(f.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new v(f.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k(this._lat,e._lat)||k(this._long,e._long)}}const Np=/^__.*__$/;class Dp{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ot(e,this.data,this.fieldMask,t,this.fieldTransforms):new rr(e,this.data,t,this.fieldTransforms)}}class Fl{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ot(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ol(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x()}}class Ds{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.k=r,this.ignoreUndefinedProperties=s,void 0===i&&this.ka(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get xa(){return this.settings.xa}$a(e){return new Ds(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Fa(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.$a({path:r,Oa:!1});return s.Ma(e),s}La(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.$a({path:r,Oa:!1});return s.ka(),s}Ba(e){return this.$a({path:void 0,Oa:!0})}Ua(e){return Rs(e,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ka(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ma(this.path.get(e))}Ma(e){if(0===e.length)throw this.Ua("Document fields must not be empty");if(Ol(this.xa)&&Np.test(e))throw this.Ua('Document fields cannot begin and end with "__"')}}class kp{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=r||mr(e)}ja(e,t,r,s=!1){return new Ds({xa:e,methodName:t,Ka:r,path:he.emptyPath(),Oa:!1,qa:s},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function Ot(n){const e=n._freezeSettings(),t=mr(n._databaseId);return new kp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ks(n,e,t,r,s,i={}){const o=n.ja(i.merge||i.mergeFields?2:0,e,t,s);ka("Data must be an object, but it was:",o,r);const a=ql(r,o);let c,h;if(i.merge)c=new Ht(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const d of i.mergeFields){const m=Ra(e,d,t);if(!o.contains(m))throw new v(f.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Vl(l,m)||l.push(m)}c=new Ht(l),h=o.fieldTransforms.filter(d=>c.covers(d.field))}else c=null,h=o.fieldTransforms;return new Dp(new me(a),c,h)}class vr extends Ft{_toFieldTransform(e){if(2!==e.xa)throw e.Ua(1===e.xa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof vr}}function Ml(n,e,t){return new Ds({xa:3,Ka:e.settings.Ka,methodName:n._methodName,Oa:t},e.databaseId,e.k,e.ignoreUndefinedProperties)}class Ca extends Ft{_toFieldTransform(e){return new nr(e.path,new tn)}isEqual(e){return e instanceof Ca}}class Rp extends Ft{constructor(e,t){super(e),this.Qa=t}_toFieldTransform(e){const t=Ml(this,e,!0),r=this.Qa.map(i=>Mt(i,t)),s=new bt(r);return new nr(e.path,s)}isEqual(e){return this===e}}class Lp extends Ft{constructor(e,t){super(e),this.Qa=t}_toFieldTransform(e){const t=Ml(this,e,!0),r=this.Qa.map(i=>Mt(i,t)),s=new Ct(r);return new nr(e.path,s)}isEqual(e){return this===e}}class Fp extends Ft{constructor(e,t){super(e),this.Wa=t}_toFieldTransform(e){const t=new nn(e.k,Mc(e.k,this.Wa));return new nr(e.path,t)}isEqual(e){return this===e}}function Na(n,e,t,r){const s=n.ja(1,e,t);ka("Data must be an object, but it was:",s,r);const i=[],o=me.empty();xt(r,(c,h)=>{const l=La(e,c,t);h=(0,F.m9)(h);const d=s.La(l);if(h instanceof vr)i.push(l);else{const m=Mt(h,d);null!=m&&(i.push(l),o.set(l,m))}});const a=new Ht(i);return new Fl(o,a,s.fieldTransforms)}function Da(n,e,t,r,s,i){const o=n.ja(1,e,t),a=[Ra(e,r,t)],c=[s];if(i.length%2!=0)throw new v(f.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Ra(e,i[m])),c.push(i[m+1]);const h=[],l=me.empty();for(let m=a.length-1;m>=0;--m)if(!Vl(h,a[m])){const p=a[m];let w=c[m];w=(0,F.m9)(w);const S=o.La(p);if(w instanceof vr)h.push(p);else{const C=Mt(w,S);null!=C&&(h.push(p),l.set(p,C))}}const d=new Ht(h);return new Fl(l,d,o.fieldTransforms)}function Pl(n,e,t,r=!1){return Mt(t,n.ja(r?4:3,e))}function Mt(n,e){if(Ul(n=(0,F.m9)(n)))return ka("Unsupported field value:",e,n),ql(n,e);if(n instanceof Ft)return function(t,r){if(!Ol(r.xa))throw r.Ua(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Ua(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Oa&&4!==e.xa)throw e.Ua("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=Mt(o,r.Ba(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,F.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Mc(r.k,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=te.fromDate(t);return{timestampValue:ar(r.k,s)}}if(t instanceof te){const s=new te(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ar(r.k,s)}}if(t instanceof Ns)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Be)return{bytesValue:nh(r.k,t._byteString)};if(t instanceof q){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.Ua(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Hi(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.Ua(`Unsupported field value: ${bs(t)}`)}(n,e)}function ql(n,e){const t={};return wc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xt(n,(r,s)=>{const i=Mt(s,e.Fa(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function Ul(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof te||n instanceof Ns||n instanceof Be||n instanceof q||n instanceof Ft)}function ka(n,e,t){if(!Ul(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=bs(t);throw e.Ua("an object"===r?n+" a custom object":n+" "+r)}var r}function Ra(n,e,t){if((e=(0,F.m9)(e))instanceof Ye)return e._internalPath;if("string"==typeof e)return La(n,e);throw Rs("Field path arguments must be of type string or FieldPath.",n,!1,void 0,t)}const Op=new RegExp("[~\\*/\\[\\]]");function La(n,e,t){if(e.search(Op)>=0)throw Rs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ye(...e.split("."))._internalPath}catch(r){throw Rs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rs(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new v(f.INVALID_ARGUMENT,a+n+c)}function Vl(n,e){return n.some(t=>t.isEqual(e))}class wr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new q(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Mp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ls("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Mp extends wr{data(){return super.data()}}function Ls(n,e){return"string"==typeof e?La(n,e):e instanceof Ye?e._internalPath:e._delegate._internalPath}class Pt{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Je extends wr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _r(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ls("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class _r extends Je{data(e={}){return super.data(e)}}class mt{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Pt(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new _r(this._firestore,this._userDataWriter,r.key,r,new Pt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new v(f.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new _r(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Pt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new _r(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Pt(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,h=-1;return 0!==o.type&&(c=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),h=i.indexOf(o.doc.key)),{type:Pp(o.type),doc:a,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Pp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x()}}function Bl(n,e){return n instanceof Je&&e instanceof Je?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof mt&&e instanceof mt&&n._firestore===e._firestore&&Dl(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function jl(n){if(os(n)&&0===n.explicitOrderBy.length)throw new v(f.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Tr{}function gt(n,...e){for(const t of e)n=t._apply(n);return n}class qp extends Tr{constructor(e,t,r){super(),this.Ga=e,this.za=t,this.Ha=r,this.type="where"}_apply(e){const t=Ot(e.firestore),r=function(s,i,o,a,c,h,l){let d;if(c.isKeyField()){if("array-contains"===h||"array-contains-any"===h)throw new v(f.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on FieldPath.documentId().`);if("in"===h||"not-in"===h){zl(l,h);const p=[];for(const w of l)p.push(Ql(a,s,w));d={arrayValue:{values:p}}}else d=Ql(a,s,l)}else"in"!==h&&"not-in"!==h&&"array-contains-any"!==h||zl(l,h),d=Pl(o,"where",l,"in"===h||"not-in"===h);const m=Te.create(c,h,d);return function(p,w){if(w.V()){const C=Zi(p);if(null!==C&&!C.isEqual(w.field))throw new v(f.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${C.toString()}' and '${w.field.toString()}'`);const J=ji(p);null!==J&&Hl(0,w.field,J)}const S=function(C,J){for(const ye of C.filters)if(J.indexOf(ye.op)>=0)return ye.op;return null}(p,function(C){switch(C){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(w.op));if(null!==S)throw new v(f.INVALID_ARGUMENT,S===w.op?`Invalid query. You cannot use more than one '${w.op.toString()}' filter.`:`Invalid query. You cannot use '${w.op.toString()}' filters with '${S.toString()}' filters.`)}(s,m),m}(e._query,0,t,e.firestore._databaseId,this.Ga,this.za,this.Ha);return new pe(e.firestore,e.converter,function(s,i){const o=s.filters.concat([i]);return new Qe(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,r))}}class Vp extends Tr{constructor(e,t){super(),this.Ga=e,this.Ja=t,this.type="orderBy"}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new v(f.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new v(f.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Jt(s,i);return function(a,c){if(null===ji(a)){const h=Zi(a);null!==h&&Hl(0,h,c.field)}}(r,o),o}(e._query,this.Ga,this.Ja);return new pe(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new Qe(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Zl extends Tr{constructor(e,t,r){super(),this.type=e,this.Ya=t,this.Xa=r}_apply(e){return new pe(e.firestore,e.converter,kc(e._query,this.Ya,this.Xa))}}class $l extends Tr{constructor(e,t,r){super(),this.type=e,this.Za=t,this.tc=r}_apply(e){const t=Gl(e,this.type,this.Za,this.tc);return new pe(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class Kl extends Tr{constructor(e,t,r){super(),this.type=e,this.Za=t,this.tc=r}_apply(e){const t=Gl(e,this.type,this.Za,this.tc);return new pe(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function Gl(n,e,t,r){if(t[0]=(0,F.m9)(t[0]),t[0]instanceof wr)return function(s,i,o,a,c){if(!a)throw new v(f.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const h=[];for(const l of en(s))if(l.field.isKeyField())h.push(es(i,a.key));else{const d=a.data.field(l.field);if(Pi(d))throw new v(f.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d){const m=l.field.canonicalString();throw new v(f.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}h.push(d)}return new Xn(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ot(n.firestore);return function(i,o,a,c,h,l){const d=i.explicitOrderBy;if(h.length>d.length)throw new v(f.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const m=[];for(let p=0;p<h.length;p++){const w=h[p];if(d[p].field.isKeyField()){if("string"!=typeof w)throw new v(f.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!$i(i)&&-1!==w.indexOf("/"))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);const S=i.path.child(O.fromString(w));if(!E.isDocumentKey(S))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${c}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);const C=new E(S);m.push(es(o,C))}else{const S=Pl(a,c,w);m.push(S)}}return new Xn(m,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Ql(n,e,t){if("string"==typeof(t=(0,F.m9)(t))){if(""===t)throw new v(f.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!$i(e)&&-1!==t.indexOf("/"))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(O.fromString(t));if(!E.isDocumentKey(r))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return es(n,new E(r))}if(t instanceof q)return es(n,t._key);throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${bs(t)}.`)}function zl(n,e){if(!Array.isArray(n)||0===n.length)throw new v(f.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new v(f.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Hl(n,e,t){if(!t.isEqual(e))throw new v(f.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Fa{convertValue(e,t="none"){switch(At(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Q(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Wt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw x()}}convertObject(e,t){const r={};return xt(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Ns(Q(e.latitude),Q(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=_c(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Hn(e));default:return null}}convertTimestamp(e){const t=it(e);return new te(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=O.fromString(e);A(gh(r));const s=new xn(r.get(1),r.get(3)),i=new E(r.popFirst(5));return s.isEqual(t)||G(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Fs(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class zp extends Fa{constructor(e){super(),this.firestore=e}convertBytes(e){return new Be(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}class Wl{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ot(e)}set(e,t,r){this._verifyNotCommitted();const s=pt(e,this._firestore),i=Fs(s.converter,t,r),o=ks(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,z.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=pt(e,this._firestore);let o;return o="string"==typeof(t=(0,F.m9)(t))||t instanceof Ye?Da(this._dataReader,"WriteBatch.update",i._key,t,r,s):Na(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,z.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=pt(e,this._firestore);return this._mutations=this._mutations.concat(new sr(t._key,z.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new v(f.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pt(n,e){if((n=(0,F.m9)(n)).firestore!==e)throw new v(f.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class qt extends Fa{constructor(e){super(),this.firestore=e}convertBytes(e){return new Be(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new q(this.firestore,null,t)}}function Yl(n,e,t){n=L(n,q);const r=L(n.firestore,B),s=Fs(n.converter,e,t);return Sn(r,[ks(Ot(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,z.none())])}function Jl(n,e,t,...r){n=L(n,q);const s=L(n.firestore,B),i=Ot(s);let o;return o="string"==typeof(e=(0,F.m9)(e))||e instanceof Ye?Da(i,"updateDoc",n._key,e,t,r):Na(i,"updateDoc",n._key,e),Sn(s,[o.toMutation(n._key,z.exists(!0))])}function Xl(n,...e){var t,r,s;n=(0,F.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||ba(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(ba(e[o])){const d=e[o];e[o]=null===(t=d.next)||void 0===t?void 0:t.bind(d),e[o+1]=null===(r=d.error)||void 0===r?void 0:r.bind(d),e[o+2]=null===(s=d.complete)||void 0===s?void 0:s.bind(d)}let c,h,l;if(n instanceof q)h=L(n.firestore,B),l=Xt(n._key.path),c={next:d=>{e[o]&&e[o](Oa(h,n,d))},error:e[o+1],complete:e[o+2]};else{const d=L(n,pe);h=L(d.firestore,B),l=d._query;const m=new qt(h);c={next:p=>{e[o]&&e[o](new mt(h,m,d,p))},error:e[o+1],complete:e[o+2]},jl(n._query)}return function(d,m,p,w){const S=new Ss(w),C=new Ko(m,S,p);return d.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return Vo(yield En(d),C)})),()=>{S.na(),d.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return jo(yield En(d),C)}))}}(Y(h),l,a,c)}function Sn(n,e){return function(t,r){const s=new ee;return t.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(n,e,t){return Wo.apply(this,arguments)}(yield xa(t),r,s)})),s.promise}(Y(n),e)}function Oa(n,e,t){const r=t.docs.get(e._key),s=new qt(n);return new Je(n,s,e._key,r,new Pt(t.hasPendingWrites,t.fromCache),e.converter)}class sy extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ot(e)}get(e){const t=pt(e,this._firestore),r=new zp(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return x();const i=s[0];if(i.isFoundDocument())return new wr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new wr(this._firestore,r,t._key,null,t.converter);throw x()})}set(e,t,r){const s=pt(e,this._firestore),i=Fs(s.converter,t,r),o=ks(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=pt(e,this._firestore);let o;return o="string"==typeof(t=(0,F.m9)(t))||t instanceof Ye?Da(this._dataReader,"Transaction.update",i._key,t,r,s):Na(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=pt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=pt(e,this._firestore),r=new qt(this._firestore);return super.get(e).then(s=>new Je(this._firestore,r,t._key,s._document,new Pt(!1,!1),t.converter))}}function Ma(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new v("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function ed(){if("undefined"==typeof Uint8Array)throw new v("unimplemented","Uint8Arrays are not available in this environment.")}function td(){if("undefined"==typeof atob)throw new v("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Qt=Ar.SDK_VERSION,(0,Ar._registerComponent)(new Ya.wA("firestore",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),i=new B(s,new Vf(t.getProvider("auth-internal")),new Zf(t.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i},"PUBLIC")),(0,Ar.registerVersion)(fc,"3.4.0",n),(0,Ar.registerVersion)(fc,"3.4.0","esm2017")}();class Ir{constructor(e){this._delegate=e}static fromBase64String(e){return td(),new Ir(Be.fromBase64String(e))}static fromUint8Array(e){return ed(),new Ir(Be.fromUint8Array(e))}toBase64(){return td(),this._delegate.toBase64()}toUint8Array(){return ed(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Pa(n){return function(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of["next","error","complete"])if(r in t&&"function"==typeof t[r])return!0;return!1}(n)}class my{enableIndexedDbPersistence(e,t){return function(n,e){Ll(n=L(n,B));const t=Y(n),r=n._freezeSettings(),s=new ya;return Rl(t,s,new ml(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(n){Ll(n=L(n,B));const e=Y(n),t=n._freezeSettings(),r=new ya;return Rl(e,r,new np(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(n){if(n._initialized&&!n._terminated)throw new v(f.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ee;return n._queue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{yield(t=(0,g.Z)(function*(r){if(!Me.bt())return Promise.resolve();const s=r+"main";yield Me.delete(s)}),function(r){return t.apply(this,arguments)})(uo(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class nd{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof xn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Qn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function(n,e,t,r={}){var s;const i=(n=L(n,yr))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Qn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=ce.MOCK_USER;else{o=(0,F.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new v(f.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new ce(c)}n._authCredentials=new Uf(new mc(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function(n){return function(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield vl(n),t=yield wl(n);return e.setNetworkEnabled(!0),function(r){const s=T(r);return s.Gr.delete(0),gr(s)}(t)}))}(Y(n=L(n,B)))}(this._delegate)}disableNetwork(){return function(n){return function(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield vl(n),t=yield wl(n);return e.setNetworkEnabled(!1),(r=(0,g.Z)(function*(s){const i=T(s);i.Gr.add(0),yield pn(i),i.Jr.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(Y(n=L(n,B)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,El("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(n){return function(e){const t=new ee;return e.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(n,e){return ta.apply(this,arguments)}(yield xa(e),t)})),t.promise}(Y(n=L(n,B)))}(this._delegate)}onSnapshotsInSync(e){return function(n,e){return function(n,e){const t=new Ss(e);return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return r=yield En(n),s=t,T(r).io.add(s),void s.next();var r,s})),()=>{t.na(),n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return r=yield En(n),s=t,void T(r).io.delete(s);var r,s}))}}(Y(n=L(n,B)),ba(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new v("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new An(this,Cl(this._delegate,e))}catch(t){throw Ie(t,"collection()","Firestore.collection()")}}doc(e){try{return new Fe(this,Cs(this._delegate,e))}catch(t){throw Ie(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ee(this,function(n,e){if(n=L(n,yr),Aa("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new v(f.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new pe(n,null,(t=e,new Qe(O.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Ie(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(n,e){return function(n,e){const t=new ee;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){const r=yield(s=n,As(s).then(i=>i.datastore));var s;new ip(n.asyncQueue,r,e,t).run()})),t.promise}(Y(n=L(n,B)),t=>e(new sy(n,t)))}(this._delegate,t=>e(new rd(this,t)))}batch(){return Y(this._delegate),new sd(new Wl(this._delegate,e=>Sn(this._delegate,e)))}loadBundle(e){return function(n,e){const t=Y(n=L(n,B)),r=new wp;return function(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,c=function(c,h){if(c instanceof Uint8Array)return gl(c,h);if(c instanceof ArrayBuffer)return gl(new Uint8Array(c),h);if(c instanceof ReadableStream)return c.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new rp(c,o);var c}(t,mr(e));n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){!function(n,e,t){const r=T(n);var s;(s=(0,g.Z)(function*(i,o,a){try{const c=yield o.getMetadata();if(yield function(m,p){const w=T(m),S=re(p.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",C=>w.Ye.getBundleMetadata(C,p.id)).then(C=>!!C&&C.createTime.compareTo(S)>=0)}(i.localStore,c))return yield o.close(),void a._completeWith((m=c,{taskState:"Success",documentsLoaded:m.totalDocuments,bytesLoaded:m.totalBytes,totalDocuments:m.totalDocuments,totalBytes:m.totalBytes}));a._updateProgress(sl(c));const h=new Fg(c,i.localStore,o.k);let l=yield o.Ho();for(;l;){const m=yield h.yo(l);m&&a._updateProgress(m),l=yield o.Ho()}const d=yield h.complete();yield We(i,d.In,void 0),yield function(m,p){const w=T(m);return w.persistence.runTransaction("Save bundle","readwrite",S=>w.Ye.saveBundleMetadata(S,p))}(i.localStore,c),a._completeWith(d.progress)}catch(c){Qn("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c)}var m}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(yield xa(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function(n,e){return function(n,e){return n.asyncQueue.enqueue((0,g.Z)(function*(){return function(t,r){const s=T(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Ye.getNamedQuery(i,r))}(yield Ea(n),e)}))}(Y(n=L(n,B)),e).then(t=>t?new pe(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Ee(this,t):null)}}class Os extends Fa{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ir(new Be(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Fe.forKey(t,this.firestore,null)}}class rd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Os(e)}get(e){const t=Vt(e);return this._delegate.get(t).then(r=>new Er(this._firestore,new Je(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=Vt(e);return r?(Ma("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Vt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Vt(e);return this._delegate.delete(t),this}}class sd{constructor(e){this._delegate=e}set(e,t,r){const s=Vt(e);return r?(Ma("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Vt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Vt(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Ut{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new _r(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new xr(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Ut.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new Ut(e,new Os(e),t),s.set(t,i)),i}}Ut.INSTANCES=new WeakMap;class Fe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Os(e)}static forPath(e,t,r){if(e.length%2!=0)throw new v("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Fe(t,new q(t._delegate,r,new E(e)))}static forKey(e,t,r){return new Fe(t,new q(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new An(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new An(this.firestore,Cl(this._delegate,e))}catch(t){throw Ie(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,F.m9)(e))instanceof q&&Nl(this._delegate,e)}set(e,t){t=Ma("DocumentReference.set",t);try{return t?Yl(this._delegate,e,t):Yl(this._delegate,e)}catch(r){throw Ie(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Jl(this._delegate,e):Jl(this._delegate,e,t,...r)}catch(s){throw Ie(s,"updateDoc()","DocumentReference.update()")}}delete(){return function(n){return Sn(L(n.firestore,B),[new sr(n._key,z.none())])}(this._delegate)}onSnapshot(...e){const t=id(e),r=od(e,s=>new Er(this.firestore,new Je(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Xl(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(n){n=L(n,q);const e=L(n.firestore,B),t=Y(e),r=new qt(e);return function(n,e){const t=new ee;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,i,o){try{const a=yield function(c,h){const l=T(c);return l.persistence.runTransaction("read document","readonly",d=>l.Wn.Rn(d,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new v(f.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const c=wn(a,`Failed to get document '${i} from cache`);o.reject(c)}}),function(s,i,o){return r.apply(this,arguments)})(yield Ea(n),e,t);var r})),t.promise}(t,n._key).then(s=>new Je(e,r,n._key,s,new Pt(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function(n){n=L(n,q);const e=L(n.firestore,B);return _l(Y(e),n._key,{source:"server"}).then(t=>Oa(e,n,t))}(this._delegate):function(n){n=L(n,q);const e=L(n.firestore,B);return _l(Y(e),n._key).then(t=>Oa(e,n,t))}(this._delegate),t.then(r=>new Er(this.firestore,new Je(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Fe(this.firestore,this._delegate.withConverter(e?Ut.getInstance(this.firestore,e):null))}}function Ie(n,e,t){return n.message=n.message.replace(e,t),n}function id(n){for(const e of n)if("object"==typeof e&&!Pa(e))return e;return{}}function od(n,e){var t,r;let s;return s=Pa(n[0])?n[0]:Pa(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Er{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Fe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Bl(this._delegate,e._delegate)}}class xr extends Er{data(e){const t=this._delegate.data(e);return function(n,e){n||x()}(void 0!==t),t}}class Ee{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Os(e)}where(e,t,r){try{return new Ee(this.firestore,gt(this._delegate,function(n,e,t){const r=e,s=Ls("where",n);return new qp(s,r,t)}(e,t,r)))}catch(s){throw Ie(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Ee(this.firestore,gt(this._delegate,function(n,e="asc"){const t=e,r=Ls("orderBy",n);return new Vp(r,t)}(e,t)))}catch(r){throw Ie(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Ee(this.firestore,gt(this._delegate,function(n){return Al("limit",n),new Zl("limit",n,"F")}(e)))}catch(t){throw Ie(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Ee(this.firestore,gt(this._delegate,function(n){return Al("limitToLast",n),new Zl("limitToLast",n,"L")}(e)))}catch(t){throw Ie(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Ee(this.firestore,gt(this._delegate,function(...n){return new $l("startAt",n,!0)}(...e)))}catch(t){throw Ie(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Ee(this.firestore,gt(this._delegate,function(...n){return new $l("startAfter",n,!1)}(...e)))}catch(t){throw Ie(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Ee(this.firestore,gt(this._delegate,function(...n){return new Kl("endBefore",n,!0)}(...e)))}catch(t){throw Ie(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Ee(this.firestore,gt(this._delegate,function(...n){return new Kl("endAt",n,!1)}(...e)))}catch(t){throw Ie(t,"endAt()","Query.endAt()")}}isEqual(e){return Dl(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(n){n=L(n,pe);const e=L(n.firestore,B),t=Y(e),r=new qt(e);return function(n,e){const t=new ee;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,i,o){try{const a=yield ws(s,i,!0),c=new al(i,a.zn),h=c.bo(a.documents),l=c.applyChanges(h,!1);o.resolve(l.snapshot)}catch(a){const c=wn(a,`Failed to execute query '${i} against cache`);o.reject(c)}}),function(s,i,o){return r.apply(this,arguments)})(yield Ea(n),e,t);var r})),t.promise}(t,n._query).then(s=>new mt(e,r,n,s))}(this._delegate):"server"===(null==e?void 0:e.source)?function(n){n=L(n,pe);const e=L(n.firestore,B),t=Y(e),r=new qt(e);return Tl(t,n._query,{source:"server"}).then(s=>new mt(e,r,n,s))}(this._delegate):function(n){n=L(n,pe);const e=L(n.firestore,B),t=Y(e),r=new qt(e);return jl(n._query),Tl(t,n._query).then(s=>new mt(e,r,n,s))}(this._delegate),t.then(r=>new qa(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=id(e),r=od(e,s=>new qa(this.firestore,new mt(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Xl(this._delegate,t,r)}withConverter(e){return new Ee(this.firestore,this._delegate.withConverter(e?Ut.getInstance(this.firestore,e):null))}}class py{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new xr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class qa{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ee(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new xr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new py(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new xr(this._firestore,r))})}isEqual(e){return Bl(this._delegate,e._delegate)}}class An extends Ee{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Fe(this.firestore,e):null}doc(e){try{return new Fe(this.firestore,void 0===e?Cs(this._delegate):Cs(this._delegate,e))}catch(t){throw Ie(t,"doc()","CollectionReference.doc()")}}add(e){return function(n,e){const t=L(n.firestore,B),r=Cs(n),s=Fs(n.converter,e);return Sn(t,[ks(Ot(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,z.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Fe(this.firestore,t))}isEqual(e){return Nl(this._delegate,e._delegate)}withConverter(e){return new An(this.firestore,this._delegate.withConverter(e?Ut.getInstance(this.firestore,e):null))}}function Vt(n){return L(n,q)}class Ua{constructor(...e){this._delegate=new Ye(...e)}static documentId(){return new Ua(he.keyField().canonicalString())}isEqual(e){return(e=(0,F.m9)(e))instanceof Ye&&this._delegate._internalPath.isEqual(e._internalPath)}}class Bt{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Ca("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Bt(e)}static delete(){const e=new vr("deleteField");return e._methodName="FieldValue.delete",new Bt(e)}static arrayUnion(...e){const t=function(...n){return new Rp("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Bt(t)}static arrayRemove(...e){const t=function(...n){return new Lp("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Bt(t)}static increment(e){const t=function(n){return new Fp("increment",n)}(e);return t._methodName="FieldValue.increment",new Bt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const yy={Firestore:nd,GeoPoint:Ns,Timestamp:te,Blob:Ir,Transaction:rd,WriteBatch:sd,DocumentReference:Fe,DocumentSnapshot:Er,Query:Ee,QueryDocumentSnapshot:xr,QuerySnapshot:qa,CollectionReference:An,FieldPath:Ua,FieldValue:Bt,setLogLevel:function(n){!function(n){st.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function(n){(function(n,e){n.INTERNAL.registerComponent(new Ya.wA("firestore-compat",t=>((e,t)=>new nd(e,t,new my))(t.getProvider("app-compat").getImmediate(),t.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},yy)))})(n),n.registerVersion("@firebase/firestore-compat","0.1.9")}(bd.Z);var yt=D(3820),_y=D(5553);function ad(n,e){return function(n,e=Td.z){return new Id.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function Va(n,e){return ad(n,e).pipe((0,ie.U)(t=>({payload:t,type:"query"})))}function Ms(n,e){return Va(n,e).pipe((0,Vs.O)(void 0),Bs(),(0,ie.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const c=s.find(l=>l.doc.ref.isEqual(o.ref)),h=null==t?void 0:t.payload.docs.find(l=>l.ref.isEqual(o.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(o.metadata)||!c&&h&&JSON.stringify(h.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function ud(n,e,t){return Ms(n,t).pipe((0,js.R)((r,s)=>function(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Ba(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Ba(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ba(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),(0,Ad.x)(),(0,ie.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function Ba(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function cd(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}D(7841);class hd{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Ms(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ie.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,Vs.O)(void 0),Bs(),(0,Zs.h)(([r,s])=>s.length>0||!r),(0,ie.U)(([r,s])=>s),ke.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,js.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=cd(e);return ud(this.query,t,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return Va(this.query,this.afs.schedulers.outsideAngular).pipe((0,ie.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),ke.iC)}get(e){return(0,Cn.D)(this.query.get(e)).pipe(ke.iC)}add(e){return this.ref.add(e)}doc(e){return new ld(this.ref.doc(e),this.afs)}}class ld{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=dd(r,t);return new hd(s,i,this.afs)}snapshotChanges(){return function(n,e){return ad(n,e).pipe((0,Vs.O)(void 0),Bs(),(0,ie.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ie.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Cn.D)(this.ref.get(e)).pipe(ke.iC)}}class Sy{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ms(this.query,this.afs.schedulers.outsideAngular).pipe((0,ie.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Zs.h)(t=>t.length>0),ke.iC):Ms(this.query,this.afs.schedulers.outsideAngular).pipe(ke.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,js.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=cd(e);return ud(this.query,t,this.afs.schedulers.outsideAngular).pipe(ke.iC)}valueChanges(e={}){return Va(this.query,this.afs.schedulers.outsideAngular).pipe((0,ie.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),ke.iC)}get(e){return(0,Cn.D)(this.query.get(e)).pipe(ke.iC)}}const Ay=new u.OlP("angularfire2.enableFirestorePersistence"),by=new u.OlP("angularfire2.firestore.persistenceSettings"),Cy=new u.OlP("angularfire2.firestore.settings"),Ny=new u.OlP("angularfire2.firestore.use-emulator");function dd(n,e=(t=>t)){return{query:e(n),ref:n}}let Dy=(()=>{class n{constructor(t,r,s,i,o,a,c,h,l,d,m,p,w,S,C,J,ye){this.schedulers=c;const Xe=(0,Sr.on)(t,a,r),je=l;d&&(0,yt.nw)(Xe,a,m,w,S,C,p,J),[this.firestore,this.persistenceEnabled$]=(0,Sr.cc)(`${Xe.name}.firestore`,"AngularFirestore",Xe.name,()=>{const Ze=a.runOutsideAngular(()=>Xe.firestore());if(i&&Ze.settings(i),je&&Ze.useEmulator(...je),s&&!(0,et.PM)(o)){const $a=()=>{try{return(0,Cn.D)(Ze.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(Ps){return"undefined"!=typeof console&&console.warn(Ps),(0,Wa.of)(!1)}};return[Ze,a.runOutsideAngular($a)]}return[Ze,(0,Wa.of)(!1)]},[i,je,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=dd(s,r),a=this.schedulers.ngZone.run(()=>i);return new hd(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new Sy(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new ld(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(u.LFG(Sr.Dh),u.LFG(Sr.xv,8),u.LFG(Ay,8),u.LFG(Cy,8),u.LFG(u.Lbi),u.LFG(u.R0b),u.LFG(ke.HU),u.LFG(by,8),u.LFG(Ny,8),u.LFG(yt.zQ,8),u.LFG(yt.Qv,8),u.LFG(yt.L6,8),u.LFG(yt._Q,8),u.LFG(yt.rT,8),u.LFG(yt.lh,8),u.LFG(yt.f7,8),u.LFG(_y.nm,8))},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var fd=D(7556);let ja=(()=>{class n{constructor(t,r){this.store=t,this.auth=r}AddAnime(t){return(0,Cn.D)(this.store.collection("content").add(t))}getAnime(){return this.store.collection("content",t=>t.where("uid","==",this.auth.uid)).get().pipe((0,ie.U)(t=>t.docs.map(r=>Object.assign(Object.assign({},r.data()),{id:r.id}))))}}return n.\u0275fac=function(t){return new(t||n)(u.LFG(Dy),u.LFG(fd.e))},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),md=(()=>{class n{constructor(){this.eventBus$=new qs.xQ,this.eventBus$=new qs.xQ}emit(t,r){this.eventBus$.next({key:t,data:r})}on(t){return this.eventBus$.asObservable().pipe((0,Zs.h)(r=>r.key===t),(0,ie.U)(r=>r.data))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),gd=(()=>{class n{constructor(t,r,s,i){this.AnimeApiService=t,this.storage=r,this.fireApiService=s,this.eventBus$=i}get lastReserches(){return this.storage.lastThreeSearchs}fetchQuote(t){return this.AnimeApiService.getQuotes(t).pipe((0,ie.U)(r=>r[0]),(0,ie.U)(r=>({Quote:r.quote,Character:r.character})))}fetchAnime(t){return this.AnimeApiService.getAnime(t).pipe((0,ie.U)(r=>r.results[0]),(0,ie.U)(r=>({Title:r.title,Episodes:r.episodes,Synopsis:r.synopsis,Img_url:r.image_url,mal_id:r.mal_id})),(0,vd.x)(()=>this.eventBus$.emit(Qa)))}addLastSearchs(t){this.storage.addLastSearchs(t)}restoreState(){this.storage.retoreState()}submit(t){this.fireApiService.AddAnime(t).subscribe(r=>console.log(r))}}return n.\u0275fac=function(t){return new(t||n)(u.LFG(Us),u.LFG(Ha),u.LFG(ja),u.LFG(md))},n.\u0275prov=u.Yz7({token:n,factory:n.\u0275fac}),n})();var Za=D(3740);function ky(n,e){if(1&n){const t=u.EpF();u.TgZ(0,"div",9),u.NdJ("click",function(){const i=u.CHM(t).$implicit;return u.oxw().searchFromBadge(i)}),u._uU(1),u.qZA()}if(2&n){const t=e.$implicit;u.xp6(1),u.hij(" ",t," ")}}function Ry(n,e){1&n&&(u.TgZ(0,"div",10),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&n&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"EMPTY.SEARCH.ERROR")," "))}function Ly(n,e){1&n&&(u.TgZ(0,"div",10),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&n&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"EMPTY.SEARCH.ERROR")," "))}function Fy(n,e){if(1&n&&(u.TgZ(0,"div"),u.TgZ(1,"h3"),u._uU(2),u.qZA(),u.TgZ(3,"p"),u._uU(4),u.qZA(),u.qZA()),2&n){const t=e.ngIf;u.xp6(2),u.Oqu(t.Character),u.xp6(2),u.Oqu(t.Quote)}}function Oy(n,e){if(1&n&&(u.TgZ(0,"span",38),u._UZ(1,"input",39),u.qZA()),2&n){const t=e.$implicit;u.xp6(1),u.Q6J("value",t)}}function My(n,e){if(1&n&&(u.TgZ(0,"div",35),u.TgZ(1,"label",36),u._uU(2),u.ALo(3,"translate"),u.qZA(),u.TgZ(4,"div"),u.YNc(5,Oy,2,1,"span",37),u.qZA(),u.qZA()),2&n){const t=u.oxw(2);u.xp6(2),u.hij(" ",u.lcZ(3,2,"RATING")," "),u.xp6(3),u.Q6J("ngForOf",t.ratings)}}function Py(n,e){1&n&&(u.TgZ(0,"div",41),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&n&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"FIELDS.REQUIRED.CHARACTERS")," "))}function qy(n,e){1&n&&(u.TgZ(0,"div",41),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&n&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"FIELDS.REQUIRED.OPTIONS")," "))}function Uy(n,e){if(1&n&&(u.ynx(0),u.YNc(1,Py,3,3,"div",40),u.YNc(2,qy,3,3,"div",40),u.BQk()),2&n){const t=u.oxw(2);u.xp6(1),u.Q6J("ngIf",null==t.form.controls.rewiew||null==t.form.controls.rewiew.errors?null:t.form.controls.rewiew.errors.required),u.xp6(1),u.Q6J("ngIf",null==t.form.controls.option||null==t.form.controls.option.errors?null:t.form.controls.option.errors.required)}}function Vy(n,e){if(1&n){const t=u.EpF();u.TgZ(0,"div"),u.TgZ(1,"h2",11),u._uU(2),u.qZA(),u.TgZ(3,"div",12),u.TgZ(4,"div",13),u._UZ(5,"img",14),u.qZA(),u.TgZ(6,"div",15),u.TgZ(7,"h2",16),u._uU(8),u.ALo(9,"translate"),u.qZA(),u.TgZ(10,"div",17),u._uU(11),u.qZA(),u.TgZ(12,"div",18),u.TgZ(13,"h3"),u._uU(14),u.ALo(15,"translate"),u.qZA(),u._uU(16),u.qZA(),u.TgZ(17,"div",19),u.TgZ(18,"h4",20),u._uU(19),u.ALo(20,"translate"),u.qZA(),u.TgZ(21,"div",21),u.TgZ(22,"input",22),u.NdJ("ngModelChange",function(s){return u.CHM(t),u.oxw().quoteSearchInput=s}),u.ALo(23,"translate"),u.qZA(),u.qZA(),u.TgZ(24,"button",23),u.NdJ("click",function(){return u.CHM(t),u.oxw().quoteSearch()}),u._uU(25),u.ALo(26,"translate"),u.qZA(),u.YNc(27,Ly,3,3,"div",5),u.qZA(),u.YNc(28,Fy,5,2,"div",8),u.ALo(29,"async"),u.qZA(),u.qZA(),u.TgZ(30,"div",19),u.TgZ(31,"form",24),u.NdJ("submit",function(){const i=u.CHM(t).ngIf;return u.oxw().submit(i)}),u.TgZ(32,"div",25),u.TgZ(33,"label",26),u._uU(34),u.ALo(35,"translate"),u.qZA(),u.TgZ(36,"textarea",27),u._uU(37,"          "),u.qZA(),u.TgZ(38,"span"),u._uU(39),u.ALo(40,"translate"),u.qZA(),u.qZA(),u.TgZ(41,"div",28),u.TgZ(42,"label",29),u._uU(43),u.ALo(44,"translate"),u.qZA(),u.TgZ(45,"select",30),u.TgZ(46,"option",31),u._uU(47),u.ALo(48,"translate"),u.qZA(),u.TgZ(49,"option",31),u._uU(50),u.ALo(51,"translate"),u.qZA(),u.TgZ(52,"option",31),u._uU(53),u.ALo(54,"translate"),u.qZA(),u.qZA(),u.qZA(),u.YNc(55,My,6,4,"div",32),u.TgZ(56,"div",33),u.TgZ(57,"button",34),u._uU(58),u.ALo(59,"translate"),u.qZA(),u.qZA(),u.YNc(60,Uy,3,2,"ng-container",8),u.qZA(),u.qZA(),u.qZA()}if(2&n){const t=e.ngIf,r=u.oxw();u.xp6(2),u.Oqu(t.Title),u.xp6(3),u.Q6J("src",t.Img_url,u.LSH),u.xp6(3),u.Oqu(u.lcZ(9,26,"SYNOPSIS")),u.xp6(3),u.Oqu(t.Synopsis),u.xp6(3),u.Oqu(u.lcZ(15,28,"EPISODES")),u.xp6(2),u.hij(" ",t.Episodes," "),u.xp6(3),u.hij(" ",u.lcZ(20,30,"SEARCH.CHARACTER")," "),u.xp6(3),u.s9C("placeholder",u.lcZ(23,32,"SEARCH")),u.Q6J("ngModel",r.quoteSearchInput),u.xp6(3),u.hij(" ",u.lcZ(26,34,"SEARCH")," "),u.xp6(2),u.Q6J("ngIf",r.emptyQuoteSearchError),u.xp6(1),u.Q6J("ngIf",u.lcZ(29,36,r.searchQuote$)),u.xp6(3),u.Q6J("formGroup",r.form),u.xp6(3),u.Oqu(u.lcZ(35,38,"REWIEW")),u.xp6(5),u.AsE(" ",u.lcZ(40,40,"SYMBOLS.LENGTH")," ",null==r.form.controls.rewiew||null==r.form.controls.rewiew.value?null:r.form.controls.rewiew.value.length," "),u.xp6(4),u.hij(" ",u.lcZ(44,42,"STATUS")," "),u.xp6(3),u.Q6J("value",r.status.WatchLater),u.xp6(1),u.hij(" ",u.lcZ(48,44,"WATCH.LATER")," "),u.xp6(2),u.Q6J("value",r.status.Watched),u.xp6(1),u.hij(" ",u.lcZ(51,46,"WATHCED")," "),u.xp6(2),u.Q6J("value",r.status.Inprogress),u.xp6(1),u.hij(" ",u.lcZ(54,48,"WATCH.INPROGRESS")," "),u.xp6(2),u.Q6J("ngIf",r.rating),u.xp6(3),u.hij(" ",u.lcZ(59,50,"ADD")," "),u.xp6(2),u.Q6J("ngIf",r.subbmit&&!r.formInvalid)}}let By=(()=>{class n{constructor(t,r,s,i){this.facade=t,this.fb=r,this.auth=s,this.eventBus=i,this.form=new $.cw({}),this.formInvalid=!0,this.searchInput="",this.emptySearchError=!1,this.selectedAnime$=null,this.unsubscribe$=new qs.xQ,this.quoteSearchInput="",this.searchQuote$=null,this.emptyQuoteSearchError=!1,this.subbmit=!1,this.status=tt}get lastReserches(){return this.facade.lastReserches}get rating(){return!!this.form.get("rating")}get ratings(){return yd}formReset(){var t,r;this.form.reset(),this.form.updateValueAndValidity(),this.subbmit=!1,null===(t=this.form.get("rewiew"))||void 0===t||t.setValue(""),null===(r=this.form.get("status"))||void 0===r||r.setValue(tt.WatchLater)}searchFromBadge(t){this.selectedAnime$=this.facade.fetchAnime(t)}search(){this.searchInput?(this.emptySearchError=!1,this.facade.addLastSearchs(this.searchInput),this.selectedAnime$=this.facade.fetchAnime(this.searchInput)):this.emptySearchError=!0}quoteSearch(){this.quoteSearchInput?(this.emptyQuoteSearchError=!1,this.searchQuote$=this.facade.fetchQuote(this.quoteSearchInput)):this.emptyQuoteSearchError=!0}submit(t){if(this.formInvalid=!this.form.invalid,this.subbmit=!0,this.form.invalid)return;const r=this.form.value;this.facade.submit({uid:this.auth.uid,rate:r.rating||"",rewiew:r.rewiew,status:r.status,mal_id:t.mal_id})}createNewForm(){this.form=this.fb.group({rewiew:["",[$.kI.required,$.kI.minLength(16)]],status:""})}statusOnChange(t){switch(t){case tt.Inprogress:case tt.Watched:this.form.addControl("rating",new $.NI([1],$.kI.required));break;case tt.WatchLater:this.form.removeControl("rating")}}ngOnInit(){var t;this.createNewForm(),this.facade.restoreState(),null===(t=this.form.get("status"))||void 0===t||t.valueChanges.pipe((0,Ga.R)(this.unsubscribe$)).subscribe(r=>this.statusOnChange(r)),this.eventBus.on(Qa).pipe((0,Ga.R)(this.unsubscribe$)).subscribe(()=>this.formReset())}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}return n.\u0275fac=function(t){return new(t||n)(u.Y36(gd),u.Y36($.qu),u.Y36(fd.e),u.Y36(md))},n.\u0275cmp=u.Xpm({type:n,selectors:[["app-add"]],features:[u._Bn([gd,Ha])],decls:16,vars:15,consts:[[1,"header"],[1,"search","pt-3","pb-3"],["type","search","aria-label","Search",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["class","badge bg-warning ms-1 mt-2",3,"click",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-md","btn-danger","mt-3",3,"click"],["class","alert alert-warning",4,"ngIf"],["routerLink","",1,"btn","btn-md","btn-danger"],[1,"justify-content-center","flex-column","row","d-flex","w-100","container"],[4,"ngIf"],[1,"badge","bg-warning","ms-1","mt-2",3,"click"],[1,"alert","alert-warning"],[1,"align-center","mb-3","mt-3"],[1,"row","mt-2"],[1,"col-3","mt-3"],["alt","",3,"src"],[1,"feature","col"],["for","synopsis"],["id","synopsis"],[1,"mt-4"],[1,"row","mt-3"],[1,"form=label"],[1,"quotes"],["type","search","id","quoteseracch","aria-label","Search",1,"form-control","col","mt-2",3,"ngModel","placeholder","ngModelChange"],["type","submit",1,"btn","btn-sm","btn-danger","col-2","mt-2",3,"click"],[3,"formGroup","submit"],[1,"mb-3","mt-2"],["for","rewiew",1,"form-label"],["formControlName","rewiew","id","rewiew","rows","3",1,"form-control"],[1,"mb-2","options"],["for","exampleDataList",1,"form-label"],["formControlName","status",1,"form-select"],[3,"value"],["class","col-sm-10 mb-3 mt-3",4,"ngIf"],[1,"mb-3"],["type","submit","routerLink","",1,"btn","btn-success"],[1,"col-sm-10","mb-3","mt-3"],["for","rating",1,"form-label"],["class","ms-2","id","rating",4,"ngFor","ngForOf"],["id","rating",1,"ms-2"],["type","radio","formControlName","rating",1,"form-check-input",3,"value"],["class","alert alert-warning w-20",4,"ngIf"],[1,"alert","alert-warning","w-20"]],template:function(t,r){1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.TgZ(2,"input",2),u.NdJ("ngModelChange",function(i){return r.searchInput=i}),u.ALo(3,"translate"),u.qZA(),u.YNc(4,ky,2,1,"div",3),u._UZ(5,"br"),u.TgZ(6,"button",4),u.NdJ("click",function(){return r.search()}),u._uU(7),u.ALo(8,"translate"),u.qZA(),u.YNc(9,Ry,3,3,"div",5),u.qZA(),u.TgZ(10,"button",6),u._uU(11),u.ALo(12,"translate"),u.qZA(),u.qZA(),u.TgZ(13,"div",7),u.YNc(14,Vy,61,52,"div",8),u.ALo(15,"async"),u.qZA()),2&t&&(u.xp6(2),u.s9C("placeholder",u.lcZ(3,7,"SEARCH")),u.Q6J("ngModel",r.searchInput),u.xp6(2),u.Q6J("ngForOf",r.lastReserches),u.xp6(3),u.hij(" ",u.lcZ(8,9,"SEARCH")," "),u.xp6(2),u.Q6J("ngIf",r.emptySearchError),u.xp6(2),u.hij(" ",u.lcZ(12,11,"GO.TO.LIST")," "),u.xp6(3),u.Q6J("ngIf",u.lcZ(15,13,r.selectedAnime$)))},directives:[$.Fj,$.JJ,$.On,et.sg,et.O5,bn.rH,$._Y,$.JL,$.sg,$.u,$.EJ,$.YN,$.Kr,$._],pipes:[Za.X$,et.Ov],styles:[".badge[_ngcontent-%COMP%]{cursor:pointer}.options[_ngcontent-%COMP%]{width:20%}.search[_ngcontent-%COMP%]{width:20%;margin-left:40%;align-items:center;text-align:center}.quotes[_ngcontent-%COMP%]{width:50%;position:relative}.header[_ngcontent-%COMP%]{background-color:#8a2be2;margin-top:0}.badge[_ngcontent-%COMP%]{border-radius:20px}"]}),n})();var jy=D(5758),Zy=D(3190);function $y(n,e){if(1&n&&(u.ynx(0),u.TgZ(1,"li",8),u._uU(2),u.qZA(),u.TgZ(3,"li",8),u._uU(4),u.qZA(),u.BQk()),2&n){const t=u.oxw(2);u.xp6(2),u.Oqu(null==t.item.data?null:t.item.data.status),u.xp6(2),u.Oqu(null==t.item.data?null:t.item.data.rewiew)}}function Ky(n,e){if(1&n){const t=u.EpF();u.TgZ(0,"div",2),u._UZ(1,"img",3),u.TgZ(2,"div",4),u.TgZ(3,"h3",5),u.TgZ(4,"b"),u._uU(5),u.qZA(),u.qZA(),u.TgZ(6,"h4"),u._uU(7),u.ALo(8,"translate"),u.qZA(),u.TgZ(9,"p",6),u._uU(10),u.qZA(),u.qZA(),u.TgZ(11,"ul",7),u.TgZ(12,"li",8),u._uU(13),u.ALo(14,"translate"),u.qZA(),u.YNc(15,$y,5,2,"ng-container",9),u.qZA(),u.TgZ(16,"div",4),u.TgZ(17,"button",10),u.NdJ("click",function(){return u.CHM(t),u.oxw().goToDetails()}),u._uU(18),u.ALo(19,"translate"),u.qZA(),u.qZA(),u.qZA()}if(2&n){const t=u.oxw();u.xp6(1),u.Q6J("src",null==t.item.anime?null:t.item.anime.image_url,u.LSH),u.xp6(4),u.hij("",null==t.item.anime?null:t.item.anime.title," "),u.xp6(2),u.Oqu(u.lcZ(8,8,"SYNOPSIS")),u.xp6(3),u.hij(" ",null==t.item.anime?null:t.item.anime.synopsis," "),u.xp6(3),u.AsE(" ",u.lcZ(14,10,"RATING")," : ",(null==t.item.data?null:t.item.data.rate)||"NaN"," "),u.xp6(2),u.Q6J("ngIf",t.details),u.xp6(3),u.hij(" ",u.lcZ(19,12,"DETAILS")," ")}}let Gy=(()=>{class n{constructor(t,r){this.fireApiService=t,this.router=r,this.details=!1}goToDetails(){this.details=!0}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(u.Y36(ja),u.Y36(bn.F0))},n.\u0275cmp=u.Xpm({type:n,selectors:[["app-list-item"]],inputs:{item:"item"},decls:2,vars:1,consts:[[1,"row"],["class","card w-20 col","style","width: 30rem",4,"ngIf"],[1,"card","w-20","col",2,"width","30rem"],["alt","...",1,"card-img-top","mt-2","w-70",3,"src"],[1,"card-body"],[1,"card-title","mb-3"],[1,"card-text"],[1,"list-group","list-group-flush"],[1,"list-group-item"],[4,"ngIf"],[1,"btn","btn-md","btn-warning",3,"click"]],template:function(t,r){1&t&&(u.TgZ(0,"div",0),u.YNc(1,Ky,20,14,"div",1),u.qZA()),2&t&&(u.xp6(1),u.Q6J("ngIf",r.item))},directives:[et.O5],pipes:[Za.X$],styles:[".row[_ngcontent-%COMP%]{display:inline}"]}),n})();function Qy(n,e){if(1&n&&(u.ynx(0),u._UZ(1,"app-list-item",8),u.BQk()),2&n){const t=e.$implicit;u.xp6(1),u.Q6J("item",t)}}let pd=(()=>{class n{constructor(t,r){this.fireApiService=t,this.animeApiService=r}mapAnimeData(t){return t.map(r=>this.animeApiService.getAnimeByMal_id(r.mal_id).pipe((0,ie.U)(s=>({data:r,anime:s}))))}ngOnInit(){this.anime$=this.fireApiService.getAnime().pipe((0,Zy.w)(t=>(0,jy.D)(this.mapAnimeData(t))))}}return n.\u0275fac=function(t){return new(t||n)(u.Y36(ja),u.Y36(Us))},n.\u0275cmp=u.Xpm({type:n,selectors:[["app-lists"]],decls:18,vars:12,consts:[[1,"main"],[1,"head","justify-content"],[1,"d-flex","justify-content-center"],["routerLink","add",1,"btn","btn-lg","btn-danger","d-flex","justify-content-center"],[1,"album","py-5","bg-light"],[1,"container"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],[4,"ngFor","ngForOf"],[3,"item"]],template:function(t,r){1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"main"),u.TgZ(2,"section",1),u.TgZ(3,"div"),u.TgZ(4,"h1",2),u._uU(5),u.ALo(6,"translate"),u.qZA(),u.TgZ(7,"p",2),u._uU(8),u.ALo(9,"translate"),u.qZA(),u.TgZ(10,"button",3),u._uU(11),u.ALo(12,"translate"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(13,"div",4),u.TgZ(14,"div",5),u.TgZ(15,"div",6),u.YNc(16,Qy,2,1,"ng-container",7),u.ALo(17,"async"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t&&(u.xp6(5),u.hij(" ",u.lcZ(6,4,"ANIME.COLECTION")," "),u.xp6(3),u.hij(" ",u.lcZ(9,6,"FOR.ADD.TXT")," "),u.xp6(3),u.hij(" ",u.lcZ(12,8,"GO.TO.ADD")," "),u.xp6(5),u.Q6J("ngForOf",u.lcZ(17,10,r.anime$)))},directives:[bn.rH,et.sg,Gy],pipes:[Za.X$,et.Ov],styles:["p[_ngcontent-%COMP%], h1[_ngcontent-%COMP%]{align-items:center}.btn[_ngcontent-%COMP%]{align-items:center;display:flex!important;justify-content:center!important;margin-left:44%}main[_ngcontent-%COMP%]{width:100%;height:80vh;background-image:url(blich.7c41105c11853a7efcac.jpg);background-repeat:no-repeat;margin:0}"]}),n})();const zy=[{path:"",component:pd},{path:"lists",component:pd},{path:"add",component:By}];let Hy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=u.oAB({type:n}),n.\u0275inj=u.cJS({imports:[[bn.Bz.forChild(zy)],bn.Bz]}),n})();var Wy=D(4466);let Yy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=u.oAB({type:n}),n.\u0275inj=u.cJS({providers:[Us],imports:[[et.ez,$.u5,Hy,Wy.m,$.UX]]}),n})()}}]);